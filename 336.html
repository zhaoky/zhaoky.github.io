<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#3eaf7c">




  
  
    
    
  
  















  
  
  







  






  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">


  <link rel="mask-icon" href="/images/apple-touch-icon.png" color="#3eaf7c">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="大纲 对知识体系进行一次预评级 为什么说知识体系如此重要？ 梳理主干流程 从浏览器接收 url 到开启网络请求线程 多进程的浏览器 多线程的浏览器内核 解析 URL 网络请求都是单独的线程 更多   开启网络线程到发出一个完整的 http 请求 DNS 查询得到 IP tcp/ip 请求 五层因特网协议栈   从服务器接收到请求到对应后台接收到请求 负载均衡 后台的处理   后台和前台的 http">
<meta name="keywords" content="前端,前端开发,css,html,js,css3,前端开发博客,fe,技术文档">
<meta property="og:type" content="article">
<meta property="og:title" content="（转载）从输入URL到页面加载的过程">
<meta property="og:url" content="https://blog.flqin.com/336.html">
<meta property="og:site_name" content="前端轻语">
<meta property="og:description" content="大纲 对知识体系进行一次预评级 为什么说知识体系如此重要？ 梳理主干流程 从浏览器接收 url 到开启网络请求线程 多进程的浏览器 多线程的浏览器内核 解析 URL 网络请求都是单独的线程 更多   开启网络线程到发出一个完整的 http 请求 DNS 查询得到 IP tcp/ip 请求 五层因特网协议栈   从服务器接收到请求到对应后台接收到请求 负载均衡 后台的处理   后台和前台的 http">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://cdn.flqin.com/p336-1.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-2.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-17.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-16.jpeg">
<meta property="og:image" content="http://cdn.flqin.com/p336-3.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-4.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-5.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-6.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-7.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-8.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-9.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-10.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-11.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-12.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-13.jpg">
<meta property="og:image" content="http://cdn.flqin.com/p336-18.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-14.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-19.jpg">
<meta property="og:image" content="http://cdn.flqin.com/p336-20.jpg">
<meta property="og:image" content="http://cdn.flqin.com/p336-15.png">
<meta property="og:image" content="http://cdn.flqin.com/p336-21.png">
<meta property="og:updated_time" content="2020-09-11T10:11:51.065Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="（转载）从输入URL到页面加载的过程">
<meta name="twitter:description" content="大纲 对知识体系进行一次预评级 为什么说知识体系如此重要？ 梳理主干流程 从浏览器接收 url 到开启网络请求线程 多进程的浏览器 多线程的浏览器内核 解析 URL 网络请求都是单独的线程 更多   开启网络线程到发出一个完整的 http 请求 DNS 查询得到 IP tcp/ip 请求 五层因特网协议栈   从服务器接收到请求到对应后台接收到请求 负载均衡 后台的处理   后台和前台的 http">
<meta name="twitter:image" content="http://cdn.flqin.com/p336-1.png">





  
  
  <link rel="canonical" href="https://blog.flqin.com/336">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>（转载）从输入URL到页面加载的过程 | 前端轻语</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c8dec20f0d0449c8ece3c0dbab4e8f31";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <style>/* normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
html {
  line-height: 1.15; /* 1 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
main {
  display: block;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
hr {
  box-sizing: content-box; /* 1 */
  height: 0; /* 1 */
  overflow: visible; /* 2 */
}
pre {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
a {
  background-color: transparent;
}
abbr[title] {
  border-bottom: none; /* 1 */
  text-decoration: underline; /* 2 */
  text-decoration: underline dotted; /* 2 */
}
b,
strong {
  font-weight: bolder;
}
code,
kbd,
samp {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
button,
input,
optgroup,
select,
textarea {
  font-family: inherit; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}
button,
input {
/* 1 */
  overflow: visible;
}
button,
select {
/* 1 */
  text-transform: none;
}
button,
[type="button"],
[type="reset"],
[type="submit"] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type="button"]::-moz-focus-inner,
[type="reset"]::-moz-focus-inner,
[type="submit"]::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
button:-moz-focusring,
[type="button"]:-moz-focusring,
[type="reset"]:-moz-focusring,
[type="submit"]:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  padding: 0.35em 0.75em 0.625em;
}
legend {
  box-sizing: border-box; /* 1 */
  color: inherit; /* 2 */
  display: table; /* 1 */
  max-width: 100%; /* 1 */
  padding: 0; /* 3 */
  white-space: normal; /* 1 */
}
progress {
  vertical-align: baseline;
}
textarea {
  overflow: auto;
}
[type="checkbox"],
[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
[type="number"]::-webkit-inner-spin-button,
[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  outline-offset: -2px; /* 2 */
}
[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  -webkit-appearance: button; /* 1 */
  font: inherit; /* 2 */
}
details {
  display: block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none;
}
::selection {
  background: #262a30;
  color: #fff;
}
body {
  position: relative;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 14px;
  line-height: 2;
  color: #555;
  background: #f5f7f9;
}
@media (max-width: 991px) {
  body {
    padding-right: 0 !important;
  }
}
@media (min-width: 1200px) {
  body {
    font-size: 16px;
  }
}
h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 20px 0 15px;
  padding: 0;
  font-weight: bold;
  line-height: 1.5;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
}
h1 {
  font-size: 22px;
}
h1 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h1 {
    font-size: 18px;
  }
  h1 code {
    font-size: 1em;
  }
}
h2 {
  font-size: 20px;
}
h2 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h2 {
    font-size: 16px;
  }
  h2 code {
    font-size: 1em;
  }
}
h3 {
  font-size: 18px;
}
h3 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h3 {
    font-size: 14px;
  }
  h3 code {
    font-size: 1em;
  }
}
h4 {
  font-size: 16px;
}
h4 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h4 {
    font-size: 12px;
  }
  h4 code {
    font-size: 1em;
  }
}
h5 {
  font-size: 14px;
}
h5 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h5 {
    font-size: 10px;
  }
  h5 code {
    font-size: 1em;
  }
}
h6 {
  font-size: 12px;
}
h6 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h6 {
    font-size: 8px;
  }
  h6 code {
    font-size: 1em;
  }
}
p {
  margin: 0 0 20px 0;
}
a,
span.exturl {
  overflow-wrap: break-word;
  word-wrap: break-word;
  background-color: transparent;
  color: #555;
  text-decoration: none;
  outline: none;
  border-bottom: 1px solid #999;
  cursor: pointer;
}
a:hover,
span.exturl:hover {
  color: #3eaf7c;
  border-bottom-color: #3eaf7c;
}
video {
  max-width: 100%;
  display: block;
  margin-left: auto;
  margin-right: auto;
}
img {
  display: block;
  margin: auto;
  max-width: 100%;
  height: auto;
}
hr {
  margin: 40px 0;
  height: 3px;
  border: none;
  background-color: #ddd;
  background-image: repeating-linear-gradient(-45deg, #fff, #fff 4px, transparent 4px, transparent 8px);
}
blockquote {
  margin: 0;
  padding: 0 15px;
  color: #666;
  border-left: 4px solid #ddd;
}
blockquote cite::before {
  content: "-";
  padding: 0 5px;
}
dt {
  font-weight: 700;
}
dd {
  margin: 0;
  padding: 0;
}
kbd {
  border: 1px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  background-color: #f9f9f9;
  font-family: inherit;
  background-image: linear-gradient(top, #eee, #fff, #eee);
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
.text-left {
  text-align: left;
}
.text-center {
  text-align: center;
}
.text-right {
  text-align: right;
}
.text-justify {
  text-align: justify;
}
.text-nowrap {
  white-space: nowrap;
}
.text-lowercase {
  text-transform: lowercase;
}
.text-uppercase {
  text-transform: uppercase;
}
.text-capitalize {
  text-transform: capitalize;
}
.center-block {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
.clearfix:before,
.clearfix:after {
  content: " ";
  display: table;
}
.clearfix:after {
  clear: both;
}
.pullquote {
  width: 45%;
}
.pullquote.left {
  float: left;
  margin-left: 5px;
  margin-right: 10px;
}
.pullquote.right {
  float: right;
  margin-left: 10px;
  margin-right: 5px;
}
.affix {
  position: fixed;
}
.translation {
  margin-top: -20px;
  font-size: 14px;
  color: #999;
}
.scrollbar-measure {
  width: 100px;
  height: 100px;
  overflow: scroll;
  position: absolute;
  top: -9999px;
}
.use-motion .motion-element {
  opacity: 0;
}
.table-container {
  margin: 20px 0;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}
.highlight .table-container {
  margin: 0px;
}
table {
  width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  font-size: 14px;
}
table > tbody > tr:nth-of-type(odd) {
  background-color: #f9f9f9;
}
table > tbody > tr:hover {
  background-color: #f5f5f5;
}
caption,
th,
td {
  padding: 8px;
  text-align: left;
  vertical-align: middle;
  font-weight: normal;
}
th,
td {
  border: 1px solid #ddd;
  border-bottom: 3px solid #ddd;
}
th {
  padding-bottom: 10px;
  font-weight: 700;
}
td {
  border-bottom-width: 1px;
}
html,
body {
  height: 100%;
}
.container {
  position: relative;
}
.header-inner {
  margin: 0 auto;
  padding: 100px 0 70px;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .container .header-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .container .header-inner {
    width: 73%;
  }
}
.main-inner {
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .container .main-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .container .main-inner {
    width: 73%;
  }
}
.footer {
  padding: 20px 0;
}
.footer-inner {
  box-sizing: border-box;
  margin: 0px auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .container .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .container .footer-inner {
    width: 73%;
  }
}
pre,
.highlight {
  overflow: auto;
  margin: 20px 0;
  padding: 0;
  font-size: 14px;
  color: #4d4d4c;
  background: #f7f7f7;
  line-height: 1.6;
}
pre,
code {
  font-family: consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace;
}
code {
  overflow-wrap: break-word;
  word-wrap: break-word;
  padding: 2px 4px;
  color: #555;
  background: #eee;
  border-radius: 3px;
  font-size: 14px;
}
pre {
  padding: 10px;
}
pre code {
  padding: 0;
  color: #4d4d4c;
  background: none;
  text-shadow: none;
}
.highlight {
  border-radius: 1px;
}
.highlight pre {
  border: none;
  margin: 0;
  padding: 10px 0;
}
.highlight table {
  margin: 0;
  width: auto;
  border: none;
}
.highlight td {
  border: none;
  padding: 0;
}
.highlight figcaption {
  font-size: 1em;
  color: #4d4d4c;
  line-height: 1em;
  margin-bottom: 1em;
  margin: 0em;
  padding: 0.5em;
  background: #eee;
  border-bottom: 1px solid #e9e9e9;
}
.highlight figcaption:before,
.highlight figcaption:after {
  content: " ";
  display: table;
}
.highlight figcaption:after {
  clear: both;
}
.highlight figcaption a {
  float: right;
  color: #4d4d4c;
}
.highlight figcaption a:hover {
  border-bottom-color: #4d4d4c;
}
.highlight .gutter pre {
  padding-left: 10px;
  padding-right: 10px;
  color: #869194;
  text-align: right;
  background-color: #eff2f3;
}
.highlight .code pre {
  width: 100%;
  padding-left: 10px;
  padding-right: 10px;
  background-color: #f7f7f7;
}
.highlight .line {
  height: 20px;
}
.gutter {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.gist table {
  width: auto;
}
.gist table td {
  border: none;
}
pre .deletion {
  background: #fdd;
}
pre .addition {
  background: #dfd;
}
pre .meta {
  color: #8959a8;
}
pre .comment {
  color: #8e908c;
}
pre .variable,
pre .attribute,
pre .tag,
pre .name,
pre .regexp,
pre .ruby .constant,
pre .xml .tag .title,
pre .xml .pi,
pre .xml .doctype,
pre .html .doctype,
pre .css .id,
pre .css .class,
pre .css .pseudo {
  color: #c82829;
}
pre .number,
pre .preprocessor,
pre .built_in,
pre .builtin-name,
pre .literal,
pre .params,
pre .constant,
pre .command {
  color: #f5871f;
}
pre .ruby .class .title,
pre .css .rules .attribute,
pre .string,
pre .symbol,
pre .value,
pre .inheritance,
pre .header,
pre .ruby .symbol,
pre .xml .cdata,
pre .special,
pre .formula {
  color: #718c00;
}
pre .title,
pre .css .hexcolor {
  color: #3e999f;
}
pre .function,
pre .python .decorator,
pre .python .title,
pre .ruby .function .title,
pre .ruby .title .keyword,
pre .perl .sub,
pre .javascript .title,
pre .coffeescript .title {
  color: #4271ae;
}
pre .keyword,
pre .javascript .function {
  color: #8959a8;
}
.posts-expand .post-body img.full-image {
  border: none;
}
.blockquote-center,
.page-home .post-type-quote blockquote,
.page-post-detail .post-type-quote blockquote {
  position: relative;
  margin: 40px 0;
  padding: 0;
  border-left: none;
  text-align: center;
}
.blockquote-center::before,
.page-home .post-type-quote blockquote::before,
.page-post-detail .post-type-quote blockquote::before,
.blockquote-center::after,
.page-home .post-type-quote blockquote::after,
.page-post-detail .post-type-quote blockquote::after {
  position: absolute;
  content: ' ';
  display: block;
  width: 100%;
  height: 24px;
  opacity: 0.2;
  background-repeat: no-repeat;
  background-position: 0 -6px;
  background-size: 22px 22px;
}
.blockquote-center::before,
.page-home .post-type-quote blockquote::before,
.page-post-detail .post-type-quote blockquote::before {
  top: -20px;
  background-image: url("../images/quote-l.svg");
  border-top: 1px solid #ccc;
}
.blockquote-center::after,
.page-home .post-type-quote blockquote::after,
.page-post-detail .post-type-quote blockquote::after {
  bottom: -20px;
  background-image: url("../images/quote-r.svg");
  border-bottom: 1px solid #ccc;
  background-position: 100% 8px;
}
.blockquote-center p,
.page-home .post-type-quote blockquote p,
.page-post-detail .post-type-quote blockquote p,
.blockquote-center div,
.page-home .post-type-quote blockquote div,
.page-post-detail .post-type-quote blockquote div {
  text-align: center;
}
.post .post-body .group-picture img {
  box-sizing: border-box;
  padding: 0 3px;
  border: none;
}
.post .group-picture-row {
  overflow: hidden;
  margin-top: 6px;
}
.post .group-picture-row:first-child {
  margin-top: 0;
}
.post .group-picture-column {
  float: left;
}
.page-post-detail .post-body .group-picture-column {
  float: none;
  margin-top: 10px;
  width: auto !important;
}
.page-post-detail .post-body .group-picture-column img {
  margin: 0 auto;
}
.page-archive .group-picture-container {
  overflow: hidden;
}
.page-archive .group-picture-row {
  float: left;
}
.page-archive .group-picture-row:first-child {
  margin-top: 6px;
}
.page-archive .group-picture-column {
  max-width: 150px;
  max-height: 150px;
}
.post-body .label {
  display: inline;
  padding: 0 2px;
}
.post-body .label.default {
  background-color: #f0f0f0;
}
.post-body .label.primary {
  background-color: #efe6f7;
}
.post-body .label.info {
  background-color: #e5f2f8;
}
.post-body .label.success {
  background-color: #e7f4e9;
}
.post-body .label.warning {
  background-color: #fcf6e1;
}
.post-body .label.danger {
  background-color: #fae8eb;
}
.post-body .note {
  position: relative;
  padding: 15px;
  margin-bottom: 20px;
  border: 1px solid #eee;
  border-left-width: 5px;
  border-radius: 3px;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  margin-top: 0;
  margin-bottom: 0;
  border-bottom: initial;
  padding-top: 0 !important;
}
.post-body .note p:first-child,
.post-body .note ul:first-child,
.post-body .note ol:first-child,
.post-body .note table:first-child,
.post-body .note pre:first-child,
.post-body .note blockquote:first-child {
  margin-top: 0;
}
.post-body .note p:last-child,
.post-body .note ul:last-child,
.post-body .note ol:last-child,
.post-body .note table:last-child,
.post-body .note pre:last-child,
.post-body .note blockquote:last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  border-left-color: #777;
}
.post-body .note.default h2,
.post-body .note.default h3,
.post-body .note.default h4,
.post-body .note.default h5,
.post-body .note.default h6 {
  color: #777;
}
.post-body .note.primary {
  border-left-color: #6f42c1;
}
.post-body .note.primary h2,
.post-body .note.primary h3,
.post-body .note.primary h4,
.post-body .note.primary h5,
.post-body .note.primary h6 {
  color: #6f42c1;
}
.post-body .note.info {
  border-left-color: #428bca;
}
.post-body .note.info h2,
.post-body .note.info h3,
.post-body .note.info h4,
.post-body .note.info h5,
.post-body .note.info h6 {
  color: #428bca;
}
.post-body .note.success {
  border-left-color: #5cb85c;
}
.post-body .note.success h2,
.post-body .note.success h3,
.post-body .note.success h4,
.post-body .note.success h5,
.post-body .note.success h6 {
  color: #5cb85c;
}
.post-body .note.warning {
  border-left-color: #f0ad4e;
}
.post-body .note.warning h2,
.post-body .note.warning h3,
.post-body .note.warning h4,
.post-body .note.warning h5,
.post-body .note.warning h6 {
  color: #f0ad4e;
}
.post-body .note.danger {
  border-left-color: #d9534f;
}
.post-body .note.danger h2,
.post-body .note.danger h3,
.post-body .note.danger h4,
.post-body .note.danger h5,
.post-body .note.danger h6 {
  color: #d9534f;
}
.post-body .tabs {
  position: relative;
  display: block;
  margin-bottom: 20px;
  padding-top: 10px;
}
.post-body .tabs ul.nav-tabs {
  margin: 0;
  padding: 0;
  display: flex;
  flex-wrap: wrap;
  margin-bottom: -1px;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab {
  flex-grow: 1;
  list-style-type: none;
  border-top: 3px solid transparent;
  border-right: 1px solid transparent;
  border-bottom: 1px solid #ddd;
  border-left: 1px solid transparent;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab {
    border-top: 1px solid transparent;
    border-right: 1px solid transparent;
    border-bottom: 1px solid transparent;
    border-left: 3px solid transparent;
  }
}
.post-body .tabs ul.nav-tabs li.tab a {
  text-align: center;
  outline: 0;
  border-bottom: initial;
  display: block;
  line-height: 1.8em;
  padding: 0.25em 0.75em;
  transition-duration: 0.2s;
  transition-timing-function: ease-out;
  transition-delay: 0s;
}
.post-body .tabs ul.nav-tabs li.tab a i {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active {
  border-top: 3px solid #fc6423;
  border-right: 1px solid #ddd;
  border-bottom: 1px solid transparent;
  border-left: 1px solid #ddd;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active {
    border-top: 1px solid #ddd;
    border-right: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    border-left: 3px solid #fc6423;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a {
  cursor: default;
  color: #555;
}
.post-body .tabs .tab-content .tab-pane {
  border: 1px solid #ddd;
  padding: 20px 20px 0 20px;
}
.post-body .tabs .tab-content .tab-pane:not(.active) {
  display: none;
}
.post-body .tabs .tab-content .tab-pane.active {
  display: block;
}
.btn {
  display: inline-block;
  padding: 0 20px;
  font-size: 14px;
  color: #555;
  background: #fff;
  border: 2px solid #555;
  text-decoration: none;
  border-radius: 2px;
  transition-property: background-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  line-height: 2;
}
.btn:hover {
  border-color: #3eaf7c;
  color: #fff;
  background: #3eaf7c;
}
.btn +.btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  width: 1.285714285714286em;
  text-align: left;
}
.btn-bar {
  display: block;
  width: 22px;
  height: 2px;
  background: #555;
  border-radius: 1px;
}
.btn-bar+.btn-bar {
  margin-top: 4px;
}
.pagination {
  margin: 120px 0 40px;
  text-align: center;
  border-top: 1px solid #eee;
}
.page-number-basic,
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  position: relative;
  top: -1px;
  margin: 0 10px;
  padding: 0 11px;
}
@media (max-width: 767px) {
  .page-number-basic,
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition-property: border-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: #3eaf7c;
}
.pagination .space {
  padding: 0;
  margin: 0;
}
.pagination .prev {
  margin-left: 0;
}
.pagination .next {
  margin-right: 0;
}
.pagination .page-number.current {
  color: #fff;
  background: #ccc;
  border-top-color: #ccc;
}
@media (max-width: 767px) {
  .pagination {
    border-top: none;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    margin-bottom: 10px;
    border-top: 0;
    border-bottom: 1px solid #eee;
    padding: 0 10px;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: #3eaf7c;
  }
}
.comments {
  margin: 60px 20px 0;
}
.back-to-top {
  box-sizing: border-box;
  position: fixed;
  bottom: -100px;
  right: 30px;
  z-index: 1050;
  padding: 0 6px;
  width: 24px;
  background: #3eaf7c;
  font-size: 12px;
  opacity: 0.6;
  color: #fff;
  cursor: pointer;
  text-align: center;
  transition-property: bottom;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.back-to-top.back-to-top-on {
  bottom: 30px;
}
@media (max-width: 991px) {
  .back-to-top {
    opacity: 0.8;
    right: 20px;
  }
}
.header {
  background: transparent;
}
.header-inner {
  position: relative;
}
.headband {
  height: 3px;
  background: #3eaf7c;
}
.site-meta {
  margin: 0;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.brand {
  position: relative;
  display: inline-block;
  padding: 0 40px;
  color: #fff;
  background: #3eaf7c;
  border-bottom: none;
}
.brand:hover {
  color: #fff;
}
.logo {
  display: inline-block;
  margin-right: 5px;
  line-height: 36px;
  vertical-align: top;
}
.site-title {
  display: inline-block;
  vertical-align: top;
  line-height: 36px;
  font-size: 20px;
  font-weight: normal;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
}
.site-subtitle {
  margin-top: 10px;
  font-size: 13px;
  color: #ddd;
}
.use-motion .brand {
  opacity: 0;
}
.use-motion .logo,
.use-motion .site-title,
.use-motion .site-subtitle,
.use-motion .custom-logo-image {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle {
  display: none;
  position: absolute;
  top: 10px;
  left: 10px;
}
@media (max-width: 767px) {
  .site-nav-toggle {
    display: block;
  }
}
.site-nav-toggle button {
  margin-top: 2px;
  padding: 9px 10px;
  background: transparent;
  border: none;
}
@media (max-width: 767px) {
  .site-nav {
    display: none;
    margin: 0 -10px;
    padding: 0 10px;
    clear: both;
    border-top: 1px solid #ddd;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: block !important;
  }
}
@media (min-width: 992px) {
  .site-nav {
    display: block !important;
  }
}
.menu {
  margin-top: 20px;
  padding-left: 0;
  text-align: center;
}
.menu .menu-item {
  display: inline-block;
  margin: 0 10px;
  list-style: none;
}
@media (max-width: 767px) {
  .menu .menu-item {
    margin-top: 10px;
  }
}
.menu .menu-item a,
.menu .menu-item span.exturl {
  display: block;
  font-size: 13px;
  line-height: inherit;
  border-bottom: 1px solid transparent;
  transition-property: border-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.menu .menu-item a:hover,
.menu .menu-item span.exturl:hover {
  border-bottom-color: #3eaf7c;
}
.menu .menu-item .fa {
  margin-right: 5px;
}
.use-motion .menu-item {
  opacity: 0;
}
.github-corner :hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out;
}
.github-corner > svg {
  fill: #3eaf7c;
  color: #fff;
  position: absolute;
  top: 0;
  border: 0;
  right: 0;
}
@media (max-width: 991px) {
  .github-corner > svg {
    fill: #fff;
    color: #3eaf7c;
  }
  .github-corner .github-corner:hover .octo-arm {
    animation: none;
  }
  .github-corner .github-corner .octo-arm {
    animation: octocat-wave 560ms ease-in-out;
  }
}
@-moz-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@-webkit-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@-o-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
.post-body {
  overflow-wrap: break-word;
  word-wrap: break-word;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
}
.post-body span.exturl .fa {
  font-size: 14px;
  margin-left: 4px;
}
.post-body .fancybox img {
  display: block !important;
  margin: 0 auto;
  cursor: pointer;
  cursor: zoom-in;
}
.post-body .image-caption,
.post-body .figure .caption {
  margin: -20px auto 15px;
  text-align: center;
  font-size: 14px;
  color: #999;
  font-weight: bold;
  line-height: 1;
}
.post-sticky-flag {
  display: inline-block;
  font-size: 16px;
  transform: rotate(30deg);
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  opacity: 0;
}
.use-motion .post-header {
  opacity: 0;
}
.use-motion .post-body {
  opacity: 0;
}
.use-motion .collection-title {
  opacity: 0;
}
.posts-expand {
  padding-top: 40px;
}
@media (max-width: 767px) {
  .posts-expand {
    margin: 0 20px;
  }
  .post-body pre .gutter pre {
    padding-right: 10px;
  }
  .post-body .highlight {
    margin-left: 0px;
    margin-right: 0px;
    padding: 0;
  }
  .post-body .highlight .gutter pre {
    padding-right: 10px;
  }
}
@media (min-width: 992px) {
  .posts-expand .post-body {
    text-align: justify;
  }
}
@media (max-width: 991px) {
  .posts-expand .post-body {
    text-align: justify;
  }
}
.posts-expand .post-body h2,
.posts-expand .post-body h3,
.posts-expand .post-body h4,
.posts-expand .post-body h5,
.posts-expand .post-body h6 {
  padding-top: 10px;
}
.posts-expand .post-body h2 .header-anchor,
.posts-expand .post-body h3 .header-anchor,
.posts-expand .post-body h4 .header-anchor,
.posts-expand .post-body h5 .header-anchor,
.posts-expand .post-body h6 .header-anchor {
  float: right;
  margin-left: 10px;
  color: #ccc;
  border-bottom-style: none;
  visibility: hidden;
}
.posts-expand .post-body h2 .header-anchor:hover,
.posts-expand .post-body h3 .header-anchor:hover,
.posts-expand .post-body h4 .header-anchor:hover,
.posts-expand .post-body h5 .header-anchor:hover,
.posts-expand .post-body h6 .header-anchor:hover {
  color: inherit;
}
.posts-expand .post-body h2:hover .header-anchor,
.posts-expand .post-body h3:hover .header-anchor,
.posts-expand .post-body h4:hover .header-anchor,
.posts-expand .post-body h5:hover .header-anchor,
.posts-expand .post-body h6:hover .header-anchor {
  visibility: visible;
}
.posts-expand .post-body img {
  box-sizing: border-box;
  margin: 0 auto 25px;
  padding: 3px;
  border: 1px solid #ddd;
}
@media (max-width: 767px) {
  .posts-collapse {
    margin: 0 20px;
  }
  .posts-collapse .post-title,
  .posts-collapse .post-meta {
    display: block;
    width: auto;
    text-align: left;
  }
}
.posts-collapse {
  position: relative;
  z-index: 1010;
  margin-left: 55px;
}
.posts-collapse::after {
  content: " ";
  position: absolute;
  top: 20px;
  left: 0;
  margin-left: -2px;
  width: 4px;
  height: 100%;
  background: #f5f5f5;
  z-index: -1;
}
@media (max-width: 767px) {
  .posts-collapse {
    margin: 0 20px;
  }
}
.posts-collapse .collection-title {
  position: relative;
  margin: 60px 0;
}
.posts-collapse .collection-title h1,
.posts-collapse .collection-title h2 {
  margin-left: 20px;
}
.posts-collapse .collection-title small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .collection-title::before {
  content: " ";
  position: absolute;
  left: 0;
  top: 50%;
  margin-left: -4px;
  margin-top: -4px;
  width: 8px;
  height: 8px;
  background: #bbb;
  border-radius: 50%;
}
.posts-collapse .post {
  margin: 10px 0;
}
.posts-collapse h3 {
  margin: 10px 0 15px;
}
.posts-collapse .post-header {
  position: relative;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  transition-property: border;
  border-bottom: 1px dashed #ccc;
}
.posts-collapse .post-header::before {
  content: " ";
  position: absolute;
  left: 0;
  top: 12px;
  width: 6px;
  height: 6px;
  margin-left: -4px;
  background: #bbb;
  border-radius: 50%;
  border: 1px solid #fff;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  transition-property: background;
}
.posts-collapse .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-header:hover::before {
  background: #3eaf7c;
}
.posts-collapse .post-meta {
  position: absolute;
  font-size: 12px;
  left: 20px;
  top: 5px;
}
.posts-collapse .post-comments-count {
  display: none;
}
.posts-collapse .post-title {
  margin-left: 60px;
  font-size: 16px;
  font-weight: normal;
  line-height: inherit;
}
.posts-collapse .post-title::after {
  margin-left: 3px;
  opacity: 0.6;
}
.posts-collapse .post-title a,
.posts-collapse .post-title span.exturl {
  color: #666;
  border-bottom: none;
}
.page-home .post-type-quote .post-header,
.page-post-detail .post-type-quote .post-header,
.page-home .post-type-quote .post-tags,
.page-post-detail .post-type-quote .post-tags {
  display: none;
}
.posts-expand .post-title {
  overflow-wrap: break-word;
  word-wrap: break-word;
  text-align: center;
  font-weight: 400;
}
.posts-expand .post-title-link {
  display: inline-block;
  position: relative;
  color: #555;
  border-bottom: none;
  line-height: 1.2;
  vertical-align: top;
}
.posts-expand .post-title-link::before {
  content: "";
  position: absolute;
  width: 100%;
  height: 2px;
  bottom: 0;
  left: 0;
  background-color: #000;
  visibility: hidden;
  transform: scaleX(0);
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.posts-expand .post-title-link:hover::before {
  visibility: visible;
  transform: scaleX(1);
}
.posts-expand .post-title-link .fa {
  font-size: 20px;
  margin-left: 5px;
}
.posts-expand .post-meta {
  margin: 3px 0 60px 0;
  color: #999;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 12px;
  text-align: center;
}
.posts-expand .post-meta .post-category-list {
  display: inline-block;
  margin: 0;
  padding: 3px;
}
.posts-expand .post-meta .post-category-list-link {
  color: #999;
}
.posts-expand .post-meta .post-description {
  font-size: 14px;
  margin-top: 2px;
}
.posts-expand .post-meta time {
  border-bottom: 1px dashed #999;
  cursor: help;
}
.post-meta-divider {
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .post-meta-item-icon {
    display: inline-block;
  }
}
@media (max-width: 767px) {
  .post-meta-item-icon {
    display: inline-block;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
@media (max-width: 767px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-button {
  margin-top: 40px;
}
.posts-expand .post-tags {
  margin-top: 40px;
  text-align: center;
}
.posts-expand .post-tags a {
  display: inline-block;
  margin-right: 10px;
  font-size: 13px;
}
.post-nav {
  display: table;
  margin-top: 15px;
  width: 100%;
  border-top: 1px solid #eee;
}
.post-nav-divider {
  display: table-cell;
  width: 10%;
}
.post-nav-item {
  display: table-cell;
  padding: 10px 0 0 0;
  width: 45%;
  vertical-align: top;
}
.post-nav-item a {
  position: relative;
  display: block;
  line-height: 25px;
  font-size: 14px;
  color: #555;
  border-bottom: none;
}
.post-nav-item a:hover {
  color: #3eaf7c;
  border-bottom: none;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  font-size: 12px;
  margin-right: 5px;
}
.post-nav-next a {
  padding-left: 5px;
}
.post-nav-prev {
  text-align: right;
}
.post-nav-prev a {
  padding-right: 5px;
}
.post-nav-prev .fa {
  margin-left: 5px;
}
.posts-expand .post-eof {
  margin: 80px auto 60px;
  width: 8%;
  height: 1px;
  background: #ccc;
  text-align: center;
}
.post:last-child .post-eof {
  display: none;
}
.post-gallery {
  display: table;
  table-layout: fixed;
  width: 100%;
  border-collapse: separate;
}
.post-gallery-row {
  display: table-row;
}
.post-gallery .post-gallery-img {
  display: table-cell;
  text-align: center;
  vertical-align: middle;
  border: none;
}
.post-gallery .post-gallery-img img {
  max-width: 100%;
  max-height: 100%;
  border: none;
}
.fancybox-close,
.fancybox-close:hover {
  border: none;
}
#reward-container {
  padding: 10px 0;
  margin: 20px auto;
  width: 90%;
  text-align: center;
}
#reward-button {
  cursor: pointer;
  border: 0;
  outline: 0;
  display: inline-block;
  vertical-align: text-top;
  margin: 0;
  padding: 0 15px;
  border-radius: 5px;
  height: 32px;
  line-height: 32px;
  font-size: 16px;
  color: #fff;
  background: #f44336;
  letter-spacing: normal;
  text-transform: none;
  text-indent: 0px;
  text-shadow: none;
}
#reward-button span:hover {
  background: #f7877f;
}
#qr {
  padding-top: 20px;
}
#qr a {
  border: 0;
}
#qr img {
  width: 180px;
  max-width: 100%;
  display: inline-block;
  margin: 0.8em 2em 0 2em;
}
#qr p {
  text-align: center;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.reading-progress-bar {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 9999;
  display: block;
  width: 0;
  height: 2px;
  background: #37c6c0;
}
.sidebar {
  position: fixed;
  right: 0;
  top: 0;
  bottom: 0;
  width: 0;
  z-index: 1040;
  box-shadow: inset 0 2px 6px #000;
  background: #3eaf7c;
}
.sidebar a,
.sidebar span.exturl {
  color: #999;
  border-bottom-color: #555;
}
.sidebar a:hover,
.sidebar span.exturl:hover {
  color: #eee;
  border-bottom-color: #eee;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-inner {
  position: relative;
  padding: 20px 10px;
  color: #999;
  text-align: center;
}
.cc-license {
  margin-top: 10px;
  text-align: center;
}
.cc-license .cc-opacity {
  opacity: 0.7;
  border-bottom: none;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
.sidebar-toggle {
  position: fixed;
  right: 30px;
  bottom: 45px;
  width: 14px;
  height: 14px;
  padding: 5px;
  background: #3eaf7c;
  line-height: 0;
  z-index: 1050;
  cursor: pointer;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    opacity: 0.8;
    right: 20px;
    display: none;
  }
}
.sidebar-toggle-line {
  position: relative;
  display: inline-block;
  vertical-align: top;
  height: 2px;
  width: 100%;
  background: #fff;
  margin-top: 3px;
}
.sidebar-toggle-line:first-child {
  margin-top: 0;
}
.site-author-image {
  display: block;
  margin: 0 auto;
  padding: 2px;
  max-width: 120px;
  height: auto;
  border: 1px solid #eee;
  opacity: 0.9;
  transition: box-shadow 0.5s linear;
}
.site-author-image:hover {
  box-shadow: 0 0 0.46875rem #1faeff;
}
.site-author-image {
  border-radius: 100%;
}
.site-author-name {
  margin: 0;
  text-align: center;
  color: #3eaf7c;
  font-weight: 600;
}
.site-description {
  margin-top: 0;
  text-align: center;
  font-size: 13px;
  color: #999;
}
.links-of-author {
  margin-top: 20px;
}
.links-of-author a,
.links-of-author span.exturl {
  display: inline-block;
  vertical-align: middle;
  margin-right: 10px;
  margin-bottom: 10px;
  border-bottom-color: #555;
  font-size: 13px;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.links-of-author a:before,
.links-of-author span.exturl:before {
  display: inline-block;
  vertical-align: middle;
  margin-right: 3px;
  content: " ";
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: #b8d6b8;
}
.feed-link,
.chat {
  margin-top: 10px;
}
.feed-link a,
.chat a {
  display: inline-block;
  padding: 0 15px;
  color: #fc6423;
  border: 1px solid #fc6423 !important;
  border-radius: 4px;
}
.feed-link a i,
.chat a i {
  color: #fc6423;
  font-size: 14px;
}
.feed-link a:hover,
.chat a:hover {
  color: #fff;
  background: #fc6423;
}
.feed-link a:hover i,
.chat a:hover i {
  color: #fff;
}
.links-of-blogroll {
  margin-top: 10px;
  font-size: 13px;
}
.links-of-blogroll-title {
  margin-top: 0;
  font-size: 14px;
  font-weight: 600;
}
.links-of-blogroll-list {
  margin: 0;
  padding: 0;
  list-style: none;
}
.links-of-blogroll-item {
  padding: 2px 10px;
}
.links-of-blogroll-item a,
.links-of-blogroll-item span.exturl {
  max-width: 280px;
  box-sizing: border-box;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.sidebar-nav {
  margin: 0 0 20px;
  padding-left: 0;
}
.sidebar-nav li {
  display: inline-block;
  cursor: pointer;
  border-bottom: 1px solid transparent;
  font-size: 14px;
  color: #555;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.page-post-detail .sidebar-nav-toc {
  padding: 0 5px;
}
.page-post-detail .sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav .sidebar-nav-active {
  color: #fc6423;
  border-bottom-color: #fc6423;
}
.sidebar-nav .sidebar-nav-active:hover {
  color: #fc6423;
}
.sidebar-panel {
  display: none;
}
.sidebar-panel-active {
  display: block;
}
.site-state {
  display: flex;
  justify-content: center;
  overflow: hidden;
  line-height: 1.4;
  white-space: nowrap;
  text-align: center;
  margin-top: 10px;
}
.site-state-item {
  padding: 0 15px;
  border-left: 1px solid #eee;
}
.site-state-item:first-child {
  border-left: none;
}
.site-state-item a {
  border-bottom: none;
}
.site-state-item-count {
  display: block;
  text-align: center;
  color: inherit;
  font-weight: 600;
  font-size: 16px;
}
.site-state-item-name {
  font-size: 13px;
  color: #999;
}
.post-toc-empty {
  font-size: 14px;
  color: #666;
}
.post-toc-wrap {
  overflow: hidden;
}
.post-toc {
  overflow: auto;
}
.post-toc ol {
  margin: 0;
  padding: 0 2px 5px 10px;
  text-align: left;
  list-style: none;
  font-size: 14px;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  transition-property: all;
  color: #666;
  border-bottom-color: #ccc;
}
.post-toc ol a:hover {
  color: #000;
  border-bottom-color: #000;
}
.post-toc .nav-item {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  line-height: 1.8;
}
.post-toc .nav .nav-child {
  display: none;
}
.post-toc .nav .active > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child > .nav-item {
  display: block;
}
.post-toc .nav .active > a {
  color: #fc6423;
  border-bottom-color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.footer {
  font-size: 14px;
  color: #999;
}
.footer img {
  border: none;
}
.footer-inner {
  text-align: center;
}
.with-love {
  display: inline-block;
  margin: 0 5px;
  color: #808080;
}
.powered-by,
.theme-info {
  display: inline-block;
}
@-moz-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-webkit-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-o-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
.local-search-pop-overlay {
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 2080;
  background-color: rgba(0,0,0,0.3);
}
.local-search-popup {
  display: none;
  position: fixed;
  top: 10%;
  left: 50%;
  margin-left: -350px;
  width: 700px;
  height: 80%;
  padding: 0;
  background: #fff;
  color: #333;
  z-index: 9999;
  border-radius: 5px;
}
@media (max-width: 767px) {
  .local-search-popup {
    padding: 0;
    top: 0;
    left: 0;
    margin: 0;
    width: 100%;
    height: 100%;
    border-radius: 0;
  }
}
.local-search-popup ul.search-result-list {
  padding: 0;
  margin: 0 5px;
}
.local-search-popup p.search-result {
  border-bottom: 1px dashed #ccc;
  padding: 5px 0;
}
.local-search-popup a.search-result-title {
  font-weight: bold;
  font-size: 16px;
}
.local-search-popup .search-keyword {
  border-bottom: 1px dashed #f00;
  font-weight: bold;
  color: #f00;
}
.local-search-popup .local-search-header {
  padding: 5px;
  height: 36px;
  background: #f5f5f5;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
}
.local-search-popup #local-search-result {
  overflow: auto;
  position: relative;
  padding: 5px 25px;
  height: calc(100% - 55px);
}
.local-search-popup .local-search-input-wrapper {
  display: inline-block;
  width: calc(100% - 90px);
  height: 36px;
  line-height: 36px;
  padding: 0 5px;
}
.local-search-popup .local-search-input-wrapper input {
  padding: 8px 0;
  height: 20px;
  display: block;
  width: 100%;
  outline: none;
  border: none;
  background: transparent;
  vertical-align: middle;
}
.local-search-popup .search-icon,
.local-search-popup .popup-btn-close {
  display: inline-block;
  font-size: 18px;
  color: #999;
  height: 36px;
  width: 18px;
  padding-left: 10px;
  padding-right: 10px;
}
.local-search-popup .search-icon {
  float: left;
}
.local-search-popup .popup-btn-close {
  border-left: 1px solid #eee;
  float: right;
  cursor: pointer;
}
.local-search-popup #no-result {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  color: #ccc;
}
.page-archive .archive-page-counter {
  position: relative;
  top: 3px;
  left: 20px;
}
@media (max-width: 767px) {
  .page-archive .archive-page-counter {
    top: 5px;
  }
}
.page-archive .posts-collapse .archive-move-on {
  position: absolute;
  top: 11px;
  left: 0;
  margin-left: -6px;
  width: 10px;
  height: 10px;
  opacity: 0.5;
  background: #555;
  border: 1px solid #fff;
  border-radius: 50%;
}
.page-archive .fa-external-link {
  font-size: 15px;
  margin-left: 5px;
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  margin: 0;
  padding: 0;
  list-style: none;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  color: #bbb;
}
.category-all-page .category-list-count:before {
  display: inline;
  content: " (";
}
.category-all-page .category-list-count:after {
  display: inline;
  content: ") ";
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
#event-list {
  padding-left: 30px;
}
#event-list hr {
  margin: 20px 0 45px 0 !important;
  background: #222;
}
#event-list hr:after {
  display: inline-block;
  content: 'NOW';
  background: #222;
  color: #fff;
  font-weight: bold;
  text-align: right;
  padding: 0 5px;
}
#event-list li.event {
  margin: 20px 0px;
  background: #f9f9f9;
  padding-left: 10px;
  min-height: 40px;
}
#event-list li.event h2.event-summary {
  margin: 0;
  padding-bottom: 3px;
}
#event-list li.event h2.event-summary:before {
  display: inline-block;
  font-family: FontAwesome;
  font-size: 8px;
  content: '\f111';
  vertical-align: middle;
  margin-right: 25px;
  color: #bbb;
}
#event-list li.event span.event-relative-time {
  display: inline-block;
  font-size: 12px;
  font-weight: 400;
  padding-left: 12px;
  color: #bbb;
}
#event-list li.event span.event-details {
  display: block;
  color: #bbb;
  margin-left: 56px;
  padding-top: 3px;
  padding-bottom: 6px;
  text-indent: -24px;
  line-height: 18px;
}
#event-list li.event span.event-details:before {
  text-indent: 0;
  display: inline-block;
  width: 14px;
  font-family: FontAwesome;
  text-align: center;
  margin-right: 9px;
  color: #bbb;
}
#event-list li.event span.event-details.event-location:before {
  content: '\f041';
}
#event-list li.event span.event-details.event-duration:before {
  content: '\f017';
}
#event-list li.event-past {
  background: #fcfcfc;
  padding: 15px 0 15px 10px;
}
#event-list li.event-past > * {
  opacity: 0.9;
}
#event-list li.event-past h2.event-summary {
  color: #bbb;
}
#event-list li.event-past h2.event-summary:before {
  color: #dfdfdf;
}
#event-list li.event-now {
  background: #222;
  color: #fff;
  padding: 15px 0 15px 10px;
}
#event-list li.event-now h2.event-summary:before {
  transform: scale(1.2);
  color: #fff;
  animation: dot-flash 1s alternate infinite ease-in-out;
}
#event-list li.event-now * {
  color: #fff !important;
}
#event-list li.event-future {
  background: #222;
  color: #fff;
  padding: 15px 0 15px 10px;
}
#event-list li.event-future h2.event-summary:before {
  transform: scale(1.2);
  color: #fff;
  animation: dot-flash 1s alternate infinite ease-in-out;
}
#event-list li.event-future * {
  color: #fff !important;
}
@-moz-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    transform: scale(1);
  }
}
@-webkit-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    transform: scale(1);
  }
}
@-o-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    transform: scale(1);
  }
}
@keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    transform: scale(1);
  }
}
.page-post-detail .sidebar-toggle-line {
  background: #fc6423;
}
.page-post-detail .comments {
  overflow: hidden;
}
ul.breadcrumb {
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
  font-size: 12px;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li+li:before {
  padding: 0.5em;
  font-weight: normal;
  content: "/\00a0";
}
ul.breadcrumb li+li:last-child {
  font-weight: bold;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.tag-cloud a:hover {
  color: #3eaf7c !important;
}
.header {
  position: relative;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header {
    width: 73%;
  }
}
@media (max-width: 991px) {
  .header {
    width: auto;
  }
}
.header-inner {
  position: absolute;
  top: 0;
  overflow: hidden;
  padding: 0;
  width: 240px;
  background: #fff;
  box-shadow: initial;
  border-radius: initial;
}
@media (min-width: 1200px) {
  .container .header-inner {
    width: 240px;
  }
}
@media (max-width: 991px) {
  .header-inner {
    position: relative;
    width: auto;
    border-radius: initial;
  }
}
.main:before,
.main:after {
  content: " ";
  display: table;
}
.main:after {
  clear: both;
}
@media (max-width: 991px) {
  .container .main-inner {
    width: auto;
  }
}
.content-wrap {
  float: right;
  box-sizing: border-box;
  padding: 40px;
  width: calc(100% - 252px);
  background: #fff;
  min-height: 700px;
  box-shadow: initial;
  border-radius: initial;
}
@media (min-width: 768px) and (max-width: 991px) {
  .content-wrap {
    width: 100%;
    padding: 20px;
    border-radius: initial;
  }
}
@media (max-width: 767px) {
  .content-wrap {
    width: 100%;
    padding: 20px;
    min-height: auto;
    border-radius: initial;
  }
}
.sidebar {
  position: static;
  float: left;
  margin-left: -100%;
  width: 240px;
  background: #f5f7f9;
  box-shadow: none;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-toggle {
  display: none;
}
.footer-inner {
  padding-left: 260px;
}
@media (max-width: 991px) {
  .footer-inner {
    width: auto;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}
.sidebar-position-right .header-inner {
  right: 0;
}
.sidebar-position-right .content-wrap {
  float: left;
}
.sidebar-position-right .sidebar {
  float: right;
}
.sidebar-position-right .footer-inner {
  padding-left: 0;
  padding-right: 260px;
}
.site-brand-wrapper {
  position: relative;
}
.site-meta {
  padding: 20px 0;
  color: #fff;
  background: #3eaf7c;
}
@media (max-width: 991px) {
  .site-meta {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.brand {
  padding: 0;
  background: none;
}
.brand:hover {
  color: #fff;
}
.site-subtitle {
  margin: 10px 10px 0;
  font-weight: initial;
}
.custom-logo-image {
  margin-top: 20px;
}
@media (max-width: 991px) {
  .custom-logo-image {
    display: none;
  }
}
.site-search form {
  display: none;
}
.site-nav {
  border-top: none;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: none !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-on {
    display: block !important;
  }
}
.menu-item-active a,
.menu .menu-item a:hover,
.menu .menu-item span.exturl:hover {
  background: #f9f9f9;
  border-bottom-color: #fff;
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a,
.menu .menu-item span.exturl {
  position: relative;
  box-sizing: border-box;
  padding: 5px 20px;
  text-align: left;
  line-height: inherit;
  transition-property: background-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
@media (hover: none) {
  .menu .menu-item a:hover,
  .menu .menu-item span.exturl:hover {
    background: none;
  }
}
.menu .menu-item .badge {
  display: inline-block;
  padding: 2px 5px;
  font-weight: 700;
  line-height: 1;
  color: #fff;
  text-align: center;
  white-space: nowrap;
  vertical-align: middle;
  background-color: #ccc;
  border-radius: 10px;
  float: right;
  margin: 0.35em 0 0 0;
  text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
}
.menu .menu-item br {
  display: none;
}
.btn-bar {
  background-color: #fff;
}
.site-nav-toggle {
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle {
    display: block;
  }
}
.sub-menu {
  margin: 0;
  padding: 6px 0;
  background: #fff !important;
  border-bottom: 1px solid #ddd;
}
.sub-menu .menu-item {
  display: inline-block !important;
}
.sub-menu .menu-item a,
.sub-menu .menu-item span.exturl {
  padding: initial !important;
  margin: 5px 10px;
}
.sub-menu .menu-item a:hover,
.sub-menu .menu-item span.exturl:hover {
  background: initial !important;
  color: #fc6423;
}
.sub-menu .menu-item-active a {
  background: #fff !important;
  color: #fc6423;
  border-bottom-color: #fc6423;
}
.sub-menu .menu-item-active a:hover {
  background: #fff !important;
  border-bottom-color: #fc6423;
}
.use-motion .sidebar .motion-element {
  opacity: 1;
}
.sidebar {
  right: auto;
  bottom: auto;
  -webkit-transform: none;
}
.sidebar a,
.sidebar span.exturl {
  color: #555;
}
.sidebar a:hover,
.sidebar span.exturl:hover {
  color: #3eaf7c;
  border-bottom-color: #3eaf7c;
}
.sidebar-inner {
  box-sizing: border-box;
  width: 240px;
  color: #555;
  background: #fff;
  box-shadow: initial;
  border-radius: initial;
  opacity: 0;
}
.sidebar-inner.affix {
  position: fixed;
  top: 12px;
}
.sidebar-inner.affix-bottom {
  position: absolute;
}
.site-overview {
  text-align: left;
}
.site-author:before,
.site-author:after {
  content: " ";
  display: table;
}
.site-author:after {
  clear: both;
}
.site-state-item {
  padding: 0 10px;
}
.feed-link,
.chat {
  border-top: 1px dotted #ccc;
  border-bottom: 1px dotted #ccc;
  text-align: center;
}
.feed-link a,
.chat a {
  display: block;
  color: #fc6423;
  border: none !important;
}
.feed-link a:hover,
.chat a:hover {
  background: none;
  color: #e34603;
}
.feed-link a:hover i,
.chat a:hover i {
  color: #e34603;
}
.links-of-author {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.links-of-author span.exturl {
  font-size: 13px;
}
.links-of-author-item {
  margin: 5px 0 0;
  width: 50%;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  max-width: 216px;
  box-sizing: border-box;
  display: inline-block;
  margin-right: 0;
  margin-bottom: 0;
  padding: 0 5px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.links-of-author-item a:before,
.links-of-author-item span.exturl:before {
  display: none;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  border-bottom: none;
  text-decoration: underline;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  display: block;
  text-decoration: none;
}
.links-of-author-item a:hover,
.links-of-author-item span.exturl:hover {
  border-radius: 4px;
  background: #eee;
}
.links-of-author-item .fa {
  margin-right: 2px;
  font-size: 16px;
}
.links-of-author-item .fa-globe {
  font-size: 15px;
}
.links-of-blogroll {
  text-align: center;
  padding: 3px 0 0;
}
.links-of-blogroll-item {
  padding: 0;
}
.links-of-blogroll-inline:before,
.links-of-blogroll-inline:after {
  content: " ";
  display: table;
}
.links-of-blogroll-inline:after {
  clear: both;
}
.links-of-blogroll-inline .links-of-blogroll-item {
  margin: 5px 0 0;
  width: 50%;
  display: inline-block;
  width: unset;
}
.links-of-blogroll-inline .links-of-blogroll-item a,
.links-of-blogroll-inline .links-of-blogroll-item span.exturl {
  max-width: 216px;
  box-sizing: border-box;
  display: inline-block;
  margin-right: 0;
  margin-bottom: 0;
  padding: 0 5px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
</style><noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">前端轻语</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">奋力搬砖中 ٩(•̤̀ᵕ•̤́๑)ᵒᵏᵎᵎᵎᵎ</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-list-ol"></i> <br>分类<span class="badge">5</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">94</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-map">

    
    
    
      
    

    
      
    

    <a href="/map/" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>前端知识图谱</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/zhaoky" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.flqin.com/336.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Korey">
      <meta itemprop="description" content="热衷于记录、分享前端开发技术">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端轻语">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">（转载）从输入URL到页面加载的过程

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-10 14:09:02" itemprop="dateCreated datePublished" datetime="2018-07-10T14:09:02+00:00">2018-07-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-11 10:11:51" itemprop="dateModified" datetime="2020-09-11T10:11:51+00:00">2020-09-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Computer-base-algorithm-GoF-fundamentals-of-compiling-network/" itemprop="url" rel="index"><span itemprop="name">Computer base (algorithm, GoF, fundamentals of compiling, network...)</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">34k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 ≈</span>
                
                <span title="阅读时长">31 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul>
<li>对知识体系进行一次预评级</li>
<li>为什么说知识体系如此重要？</li>
<li>梳理主干流程</li>
<li>从浏览器接收 url 到开启网络请求线程<ul>
<li>多进程的浏览器</li>
<li>多线程的浏览器内核</li>
<li>解析 URL</li>
<li>网络请求都是单独的线程</li>
<li>更多</li>
</ul>
</li>
<li>开启网络线程到发出一个完整的 http 请求<ul>
<li>DNS 查询得到 IP</li>
<li>tcp/ip 请求</li>
<li>五层因特网协议栈</li>
</ul>
</li>
<li>从服务器接收到请求到对应后台接收到请求<ul>
<li>负载均衡</li>
<li>后台的处理</li>
</ul>
</li>
<li>后台和前台的 http 交互<ul>
<li>http 报文结构</li>
<li>cookie 以及优化</li>
<li>gzip 压缩</li>
<li>长连接与短连接</li>
<li>http 2.0</li>
<li>https</li>
</ul>
</li>
<li>单独拎出来的缓存问题，http 的缓存<ul>
<li>强缓存与弱缓存</li>
<li>缓存头部简述</li>
<li>头部的区别</li>
</ul>
</li>
<li>解析页面流程<ul>
<li>流程简述</li>
<li>HTML 解析，构建 DOM</li>
<li>生成 CSS 规则</li>
<li>构建渲染树</li>
<li>渲染</li>
<li>了解层</li>
<li>Chrome 中的调试</li>
<li>资源外链的下载</li>
<li>loaded 和 domcontentloaded</li>
</ul>
</li>
<li>CSS 的可视化格式模型<ul>
<li>包含块（Containing Block）</li>
<li>控制框（Controlling Box）</li>
<li>盒模型</li>
<li>BFC（Block Formatting Context）</li>
<li>IFC（Inline Formatting Context）</li>
<li>其它</li>
</ul>
</li>
<li>JS 引擎解析过程<ul>
<li>JS 的解释阶段</li>
<li>JS 的预处理阶段</li>
<li>JS 的执行阶段</li>
<li>回收机制</li>
</ul>
</li>
<li>其它</li>
<li>总结</li>
</ul>
<h2 id="对知识体系进行一次预评级"><a href="#对知识体系进行一次预评级" class="headerlink" title="对知识体系进行一次预评级"></a>对知识体系进行一次预评级</h2><p>看到这道题目，不借助搜索引擎，自己的心里是否有一个答案？</p>
<p>这里，以目前的经验（了解过一些处于不同阶段的相关前端人员的情况），大概有以下几种情况：（以下都是以点见面，实际上不同阶段人员一般都会有其它的隐藏知识点的）</p>
<h3 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h3><p>完全没什么概念的，支支吾吾的回答，一般就是这种水平（大致形象点描述）：</p>
<ul>
<li>浏览器发起请求，服务端返回数据，然后前端解析成网页，执行脚本。。。</li>
</ul>
<p>这类人员一般都是：</p>
<ul>
<li>萌新（刚接触前端的，包括 0-6 个月都有可能有这种回答）</li>
<li>沉淀人员（就是那种可能已经接触了前端几年，但是仍然处于初级阶段的那种。。。）</li>
</ul>
<p>当然了，后者一般还会偶尔提下<code>http、后台、浏览器渲染，js引擎</code>等等关键字，但基本都是一详细的问就不知道了。。。</p>
<h3 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h3><p>已经有初步概念，但是可能没有完整梳理过，导致无法形成一个完整的体系，或者是很多细节都不会展开，大概是这样子的：（可能符合若干条）</p>
<ul>
<li>知道浏览器输入 url 后会有 http 请求这个概念</li>
<li>有后台这个概念，大致知道前后端的交互，知道前后端靠 http 报文通信</li>
<li>知道浏览器接收到数据后会进行解析，有一定概念，但是具体流程不熟悉（如 render 树构建流程，layout、paint，复合层与简单层，常用优化方案等不是很熟悉）</li>
<li>对于 js 引擎的解析流程有一定概念，但是细节不熟悉（如具体的形参，函数，变量提升，执行上下文以及 VO、AO、作用域链，回收机制等概念不是很熟悉）</li>
<li>如可能知道一些 http 规范初步概念，但是不熟悉（如 http 报文结构，常用头部，缓存机制，http2.0，https 等特性，跨域与 web 安全等不是很熟悉）</li>
</ul>
<p>到这里，看到这上面一大堆的概念后，心里应该也会有点底了。。。</p>
<p><strong>实际上，大部分的前端人员可能都处于 level2</strong>，但是，跳出这个阶段并不容易，一般需要积累，不断学习，才能水到渠成。</p>
<p>这类人员一般都是：</p>
<ul>
<li>工作 1-3 年左右的普通人员（占大多数，而且大多数人员工作 3 年左右并没有实质上的提升）</li>
<li>工作 3 年以上的老人（这部分人大多都业务十分娴熟，一个当好几个用，但是，基础比较薄弱，可能没有尝试写过框架、组件、脚手架等）</li>
</ul>
<p>大部分的初中级都陷在这个阶段，如果要突破，不断学习，积累，自然能水到渠成，打通任督二脉。</p>
<h3 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h3><p>基本能到这一步的，不是高阶就是接近高阶，因为很多概念并不是靠背就能理解的，而要理解这么多，需形成体系，一般都需要积累，非一日之功。</p>
<p>一般包括什么样的回答呢？（这里就以自己的简略回答进行举例），一般这个阶段的人员都会符合若干条（不一定全部，当然可能还有些是这里遗漏的）:</p>
<ul>
<li>首先略去那些键盘输入、和操作系统交互、以及屏幕显示原理、网卡等硬件交互之类的（前端向中，很多硬件原理暂时略去。。。）</li>
<li>对浏览器模型有整体概念，知道浏览器是多进程的，浏览器内核是多线程的，清楚进程与线程之间得区别，以及输入 url 后会开一个新的网络线程</li>
<li>对从开启网络线程到发出一个完整的 http 请求中间的过程有所了解（如 dns 查询，tcp/ip 链接，五层因特网协议栈等等，以及一些优化方案，如 dns-prefetch）</li>
<li>对从服务器接收到请求到对应后台接收到请求有一定了解（如负载均衡，安全拦截以及后台代码处理等）</li>
<li>对后台和前台的 http 交互熟悉（包括 http 报文结构，场景头部，cookie，跨域，web 安全，http 缓存，http2.0，https 等）</li>
<li>对浏览器接收到 http 数据包后的解析流程熟悉（包括解析 html，词法分析然后解析成 dom 树、解析 css 生成 css 规则树、合并成 render 树，然后 layout、painting 渲染、里面可能还包括复合图层的合成、GPU 绘制、外链处理、加载顺序等）</li>
<li>对 JS 引擎解析过程熟悉（包括 JS 的解释，预处理，执行上下文，VO，作用域链，this，回收机制等）</li>
</ul>
<p>可以看到，上述包括了一大堆的概念，仅仅是偏前端向，而且没有详细展开，就已经如此之多的概念了，所以，个人认为如果没有自己的见解，没有形成自己的知识体系，仅仅是看看，背背是没用的，过一段时间就会忘光了。</p>
<p>再说下一般这个阶段的都可能是什么样的人吧。（不一定准确，这里主要是靠少部分现实以及大部分推测得出）</p>
<ul>
<li>工作 2 年以上的前端（基本上如果按正常进度的话，至少接触前端两年左右才会开始走向高阶，当然，现在很多都是上学时就开始学了的，还有部分是天赋异禀，不好预估。。。）</li>
<li>或者是已经十分熟悉其它某门语言，再转前端的人（基本上是很快就可以将前端水准提升上去）</li>
</ul>
<p>一般符合这个条件的都会有各种隐藏属性（如看过各大框架、组件的源码，写过自己的组件、框架、脚手架，做过大型项目，整理过若干精品博文等）</p>
<h3 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h3><p>由于本人层次尚未达到，所以大致说下自己的见解吧。</p>
<p>一般这个层次，很多大佬都并不仅仅是某个技术栈了，而是成为了技术专家，技术 leader 之类的角色。所以仅仅是回答某个技术问题已经无法看出水准了， 可能更多的要看架构，整体把控，大型工程构建能力等等</p>
<p>不过，对于某些执着于技术的大佬，大概会有一些回答吧：（猜的）</p>
<ul>
<li>从键盘谈起到系统交互，从浏览器到 CPU，从调度机制到系统内核，从数据请求到二进制、汇编，从 GPU 绘图到 LCD 显示，然后再分析系统底层的进程、内存等等</li>
</ul>
<p>总之，从软件到硬件，到材料，到分子，原子，量子，薛定谔的猫，人类起源，宇宙大爆炸，平行宇宙？感觉都毫无违和感。。。</p>
<p>这点可以参考下本题的原始出处：<a href="http://fex.baidu.com/blog/2014/05/what-happen/" target="_blank" rel="noopener">查阅</a></p>
<h2 id="为什么说知识体系如此重要"><a href="#为什么说知识体系如此重要" class="headerlink" title="为什么说知识体系如此重要"></a>为什么说知识体系如此重要</h2><p>为什么说知识体系如此重要呢？这里举几个例子</p>
<p>假设有被问到这样一道题目（随意想到的一个）：</p>
<ul>
<li>如何理解<code>getComputedStyle</code></li>
</ul>
<p>在尚未梳理知识体系前，大概会这样回答：</p>
<ul>
<li>普通版本：<code>getComputedStyle</code>会获取当前元素所有最终使用的 CSS 属性值（最终计算后的结果），通过<code>window.getComputedStyle</code>等价于<code>document.defaultView.getComputedStyle</code>调用</li>
<li>详细版本：<code>window.getComputedStyle(elem, null).getPropertyValue("height")</code>可能的值为<code>100px</code>，而且，就算是 css 上写的是<code>inherit</code>，<code>getComputedStyle</code>也会把它最终计算出来的。不过注意，如果元素的背景色透明，那么<code>getComputedStyle</code>获取出来的就是透明的这个背景（因为透明本身也是有效的），而不会是父节点的背景。所以它不一定是最终显示的颜色。</li>
</ul>
<p>就这个 API 来说，上述的回答已经比较全面了。</p>
<p>但是，其实它是可以继续延伸的。</p>
<p>譬如现在会这样回答：</p>
<ul>
<li><code>getComputedStyle</code>会获取当前元素所有最终使用的 CSS 属性值，<code>window.</code>和<code>document.defaultView.</code>等价</li>
<li><code>getComputedStyle</code>会引起回流，因为它需要获取祖先节点的一些信息进行计算（譬如宽高等），所以用的时候慎用，回流会引起性能问题。然后合适的话会将话题引导回流，重绘，浏览器渲染原理等等。当然也可以列举一些其它会引发回流的操作，如<code>offsetXXX，scrollXXX，clientXXX，currentStyle</code>等等</li>
</ul>
<p>再举一个例子：</p>
<ul>
<li><code>visibility: hidden</code>和<code>display: none</code>的区别</li>
</ul>
<p>可以如下回答：</p>
<ul>
<li>普通回答，一个隐藏，但占据位置，一个隐藏，不占据位置</li>
<li>进一步，display 由于隐藏后不占据位置，所以造成了 dom 树的改变，会引发<code>回流</code>，代价较大</li>
<li>再进一步，当一个页面某个元素经常需要切换<code>display</code>时如何优化，一般会用复合层优化，或者要求低一点用<code>absolute</code>让其脱离普通文档流也行。然后可以将话题引到普通文档流，<code>absolute</code>文档流，复合图层的区别，</li>
<li>再进一步可以描述下浏览器渲染原理以及复合图层和普通图层的绘制区别（复合图层单独分配资源，独立绘制，性能提升，但是不能过多，还有隐式合成等等）</li>
</ul>
<p>上面这些大概就是知识系统化后的回答，会更全面，容易由浅入深，而且一有机会就可以往更底层挖</p>
<h3 id="前端向知识的重点"><a href="#前端向知识的重点" class="headerlink" title="前端向知识的重点"></a>前端向知识的重点</h3><p>此部分的内容是站在个人视角分析的，并不是说就一定是正确答案</p>
<p>首先明确，计算机方面的知识是可以无穷无尽的挖的，而本文的重点是梳理<code>前端向</code>的重点知识</p>
<p>对于<code>前端向</code>（这里可能没有提到<code>node.js</code>之类的，更多的是指客户端前端），这里将知识点按重要程度划分成以下几大类：</p>
<ul>
<li>核心知识，必须掌握的，也是最基础的，譬如浏览器模型，渲染原理，JS 解析过程，JS 运行机制等，作为骨架来承载知识体系</li>
<li>重点知识，往往每一块都是一个知识点，而且这些知识点都很重要，譬如 http 相关，web 安全相关，跨域处理等</li>
<li>拓展知识，这一块可能更多的是了解，稍微实践过，但是认识上可能没有上面那么深刻，譬如五层因特网协议栈，hybrid 模式，移动原生开发，后台相关等等（当然，在不同领域，可能有某些知识就上升到重点知识层次了，譬如 hybrid 开发时，懂原生开发是很重要的）</li>
</ul>
<p>为什么要按上面这种方式划分？</p>
<p>这大概与个人的技术成长有关。</p>
<p>记得最开始学前端知识时，是一点一点的积累，一个知识点一个知识点的攻克。</p>
<p>就这样，虽然在很长一段时间内积累了不少的知识，但是，总是无法将它串联到一起。每次梳理时都是很分散的，无法保持思路连贯性。</p>
<p>直到后来，在将<code>浏览器渲染原理</code>、<code>JS运行机制</code>、<code>JS引擎解析流程</code>梳理一遍后，感觉就跟打通了任督二脉一样，有了一个整体的架构，以前的知识点都连贯起来了。</p>
<p>梳理出了一个知识体系，以后就算再学新的知识，也会尽量往这个体系上靠拢，环环相扣，更容易理解，也更不容易遗忘。</p>
<h2 id="梳理主干流程"><a href="#梳理主干流程" class="headerlink" title="梳理主干流程"></a>梳理主干流程</h2><p>回到这道题上，如何回答呢？先梳理一个骨架</p>
<p>知识体系中，最重要的是骨架，脉络。有了骨架后，才方便填充细节。所以，先梳理下<code>主干流程</code>：</p>
<ol>
<li>从浏览器接收 url 到开启网络请求线程（这一部分可以展开浏览器的机制以及进程与线程之间的关系）</li>
<li>开启网络线程到发出一个完整的 http 请求（这一部分涉及到 dns 查询，tcp/ip 请求，五层因特网协议栈等知识）</li>
<li>从服务器接收到请求到对应后台接收到请求（这一部分可能涉及到负载均衡，安全拦截以及后台内部的处理等等）</li>
<li>后台和前台的 http 交互（这一部分包括 http 头部、响应码、报文结构、cookie 等知识，可以提下静态资源的 cookie 优化，以及编码解码，如 gzip 压缩等）</li>
<li>单独拎出来的缓存问题，http 的缓存（这部分包括 http 缓存头部，etag，catch-control 等）</li>
<li>浏览器接收到 http 数据包后的解析流程（解析 html-词法分析然后解析成 dom 树、解析 css 生成 css 规则树、合并成 render 树，然后 layout、painting 渲染、复合图层的合成、GPU 绘制、外链资源的处理、loaded 和 domcontentloaded 等）</li>
<li>CSS 的可视化格式模型（元素的渲染规则，如包含块，控制框，BFC，IFC 等概念）</li>
<li>JS 引擎解析过程（JS 的解释阶段，预处理阶段，执行阶段生成执行上下文，VO，作用域链、回收机制等等）</li>
<li>其它（可以拓展不同的知识模块，如跨域，web 安全，hybrid 模式等等内容）</li>
</ol>
<p>梳理出主干骨架，然后就需要往骨架上填充细节内容。</p>
<h2 id="从浏览器接收-url-到开启网络请求线程"><a href="#从浏览器接收-url-到开启网络请求线程" class="headerlink" title="从浏览器接收 url 到开启网络请求线程"></a>从浏览器接收 url 到开启网络请求线程</h2><p>这一部分展开的内容是：<code>浏览器进程/线程模型</code>，<code>JS引擎的运行机制</code></p>
<h3 id="多进程的浏览器"><a href="#多进程的浏览器" class="headerlink" title="多进程的浏览器"></a>多进程的浏览器</h3><p>浏览器是多进程的，有一个主控进程，以及每一个 tab 页面都会新开一个进程（某些情况下多个 tab 会合并进程）</p>
<p>进程可能包括主控进程，插件进程，GPU，tab 页（浏览器内核）等等</p>
<ul>
<li>Browser 进程：浏览器的主进程（负责协调、主控），只有一个</li>
<li>第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建</li>
<li>GPU 进程：最多一个，用于 3D 绘制</li>
<li>浏览器渲染进程（内核）：默认每个 Tab 页面一个进程，互不影响，控制页面渲染，脚本执行，事件处理等（有时候会优化，如多个空白 tab 会合并成一个进程）</li>
</ul>
<p><img src="http://cdn.flqin.com/p336-1.png" alt="多进程的浏览器"></p>
<h3 id="多线程的浏览器内核"><a href="#多线程的浏览器内核" class="headerlink" title="多线程的浏览器内核"></a>多线程的浏览器内核</h3><p>每一个 tab 页面可以看作是浏览器内核进程，然后这个进程是多线程的，它有几大类子线程</p>
<ul>
<li>GUI 线程</li>
<li>JS 引擎线程</li>
<li>事件触发线程</li>
<li>定时器线程</li>
<li>网络请求线程</li>
</ul>
<p><img src="http://cdn.flqin.com/p336-2.png" alt="多线程的浏览器内核"></p>
<p>可以看到，里面的 JS 引擎是内核进程中的一个线程，这也是为什么常说 JS 引擎是单线程的，<a href="https://blog.flqin.com/359.html">JS 引擎的运行机制查阅</a></p>
<h3 id="解析-URL"><a href="#解析-URL" class="headerlink" title="解析 URL"></a>解析 URL</h3><p>输入 URL 后，会进行解析（URL 的本质就是统一资源定位符）</p>
<p>URL 一般包括几大部分：</p>
<ul>
<li><code>protocol</code>，协议头，譬如有 http，ftp 等</li>
<li><code>host</code>，主机域名或 IP 地址</li>
<li><code>port</code>，端口号</li>
<li><code>path</code>，目录路径</li>
<li><code>query</code>，即查询参数</li>
<li><code>fragment</code>，即<code>#</code>后的 hash 值，一般用来定位到某个位置</li>
</ul>
<h3 id="网络请求都是单独的线程"><a href="#网络请求都是单独的线程" class="headerlink" title="网络请求都是单独的线程"></a>网络请求都是单独的线程</h3><p>每次网络请求时都需要开辟单独的线程进行，譬如如果 URL 解析到 http 协议，就会新建一个网络线程去处理资源下载</p>
<p>因此浏览器会根据解析出得协议，开辟一个网络线程，前往请求资源（这里，暂时理解为是浏览器内核开辟的，如有错误，后续修复）</p>
<h2 id="开启网络线程到发出一个完整的-http-请求"><a href="#开启网络线程到发出一个完整的-http-请求" class="headerlink" title="开启网络线程到发出一个完整的 http 请求"></a>开启网络线程到发出一个完整的 http 请求</h2><p>这一部分主要内容包括：<code>dns查询</code>，<code>tcp/ip请求构建</code>，<code>七层因特网协议栈（ISO）</code>等等</p>
<p>仍然是先梳理主干，有些详细的过程不展开（因为展开的话内容过多）</p>
<h3 id="DNS-查询得到-IP"><a href="#DNS-查询得到-IP" class="headerlink" title="DNS 查询得到 IP"></a>DNS 查询得到 IP</h3><p>如果输入的是域名，需要进行 dns 解析成 IP，大致流程：</p>
<ul>
<li>如果浏览器有缓存，直接使用浏览器缓存，否则使用本机缓存，再没有的话就是用<code>host</code></li>
<li>如果本地没有，就向 dns 域名服务器查询（当然，中间可能还会经过路由，也有缓存等），查询到对应的 IP</li>
</ul>
<p>注意，域名查询时有可能是经过了 CDN 调度器的（如果有 cdn 存储功能的话）</p>
<p>而且，需要知道 dns 解析是很耗时的，因此如果解析域名过多，会让首屏加载变得过慢，可以考虑<code>dns-prefetch</code>优化</p>
<p>这一块可以深入展开，具体请去网上搜索，这里就不占篇幅了（网上可以看到很详细的解答）</p>
<h3 id="tcp-ip-请求"><a href="#tcp-ip-请求" class="headerlink" title="tcp/ip 请求"></a>tcp/ip 请求</h3><p><code>http</code>的本质就是<code>tcp/ip</code>请求，<code>tcp</code>将<code>http</code>长报文划分为短报文，通过<code>三次握手</code>与服务端建立连接，进行可靠传输。</p>
<p>然后，待到断开连接时，由于 TCP 连接是<code>全双工</code>的，因此每个方向都必须单独进行关闭。这原则是当一方完成它的数据发送任务后就能发送一个<code>FIN</code>来终止这个方向的连接。收到一个<code>FIN</code>只意味着这一方向上没有数据流动，一个 TCP 连接在收到一个<code>FIN</code>后仍能发送数据。首先进行关闭的一方将执行<code>主动关闭</code>，而另一方执行<code>被动关闭</code>。</p>
<h4 id="HTTP-与-TCP-IP-区别"><a href="#HTTP-与-TCP-IP-区别" class="headerlink" title="HTTP 与 TCP/IP 区别"></a>HTTP 与 TCP/IP 区别</h4><ul>
<li><code>TPC/IP</code> 协议是传输层协议，主要解决数据如何在网络中传输</li>
<li><code>HTTP</code> 是应用层协议，主要解决如何包装数据</li>
<li><code>WEB</code> 使用 <code>HTTP</code> 协议作应用层协议，以封装 <code>HTTP</code> 文本信息，然后使用 <code>TCP/IP</code> 做传输层协议将它发到网络上。</li>
</ul>
<h4 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h4><ul>
<li>SYN(synchronous 建立联机)同步序列号</li>
<li>ACK(acknowledgement 确认)应答码</li>
<li>PSH(push 传送)</li>
<li>FIN(finish 结束)</li>
<li>RST(reset 重置)</li>
<li>URG(urgent 紧急)</li>
<li>Sequence number(seq 顺序号码) 对方上次的 ack（首次发送时 seq 为系统随机生成）</li>
<li>Acknowledge number(ack 确认号码)对方的 seq+1（无数据传输时） 或者 seq+L（报文数据的长度 L）</li>
</ul>
<p><img src="http://cdn.flqin.com/p336-17.png" alt="TCP通信握手图解"></p>
<h4 id="三次握手的步骤"><a href="#三次握手的步骤" class="headerlink" title="三次握手的步骤"></a>三次握手的步骤</h4><ol>
<li>客户端发送<code>SYN包</code>（SYN=1,seq=x,x 为随机数）的数据包到服务器，并进入<code>SYN_SEND</code>状态，等待服务器确认</li>
<li>服务器收到<code>SYN包</code>，发现 SYN=1 知客户端想请求连接，然后需要确认客户的<code>SYN包</code>（ACK number=x+1,ACK 位码=1），同时自己也发送一个<code>SYN包</code>（seq=y），即<code>SYN+ACK包</code>，此时服务器进入<code>SYN_RECV</code>状态</li>
<li>客户端收到服务器的<code>SYN＋ACK包</code>，发现<code>ACK number=x+1，ACK位码=1</code>的话， 就向服务器发送<code>确认包ACK</code>(ACK number=y+1，ACK 位码=1)，此包发送完毕，客户端和服务器进入<code>ESTABLISHED</code>状态，完成三次握手</li>
</ol>
<p>建立连接成功后，接下来就正式传输数据。</p>
<h4 id="四次挥手的步骤"><a href="#四次挥手的步骤" class="headerlink" title="四次挥手的步骤"></a>四次挥手的步骤</h4><ol>
<li>主动关闭方发送一个<code>FIN包</code>，用来关闭主动方到被动方的数据传送</li>
<li>被动方收到<code>FIN包</code>后，发送一个<code>ACK</code>给对方，确认序号为收到序号+1</li>
<li>被动方发送一个<code>FIN包</code>，用来关闭被动方到主动方的数据传送</li>
<li>主动方收到<code>FIN包</code>后，发送一个<code>ACK</code>给被动关闭方，确认序号为收到序号+1</li>
</ol>
<p>注：2，3 次挥手不会一起发送，当<code>Server端</code>收到<code>FIN</code>报文时，很可能并不会立即关闭 <code>SOCKET</code>，所以只能先回复一个<code>ACK</code>报文，告诉<code>Client端</code>，”你发的<code>FIN报文</code>我收到了”。只有等到我<code>Server端</code>所有的报文都发送完了，我才能发送<code>FIN报文</code>，因此不能一起发送。</p>
<h4 id="tcp-ip-的并发限制"><a href="#tcp-ip-的并发限制" class="headerlink" title="tcp/ip 的并发限制"></a>tcp/ip 的并发限制</h4><p>在 <code>HTTP/1.0</code> 中，一个服务器在发送完一个 <code>HTTP</code> 响应后，会断开 <code>TCP</code> 链接。但是这样每次请求都会重新建立和断开 <code>TCP</code> 连接，代价过大。</p>
<p>所以 <code>HTTP/1.1</code> 就把 Connection 头写进标准(<code>Connection: keep-alive</code>)，并且默认开启<code>持久连接</code>，除非请求中写明 <code>Connection: close</code>，那么浏览器和服务器之间是会维持一段时间的 <code>TCP</code> 连接，不会一个请求结束就断掉，这样 <code>SSL</code> 的开销也可以避免。 在 <code>chrome</code> 浏览器里通过 <code>network</code> 标签 -&gt; <code>connection ID</code>表示<code>TCP连接</code>的重用</p>
<p>在<code>HTTP/1.1</code>中，单个 <code>TCP连接</code> 在同一时刻只能处理一个请求，顺序处理多个请求； 在 <code>HTTP2</code> 中由于 <code>Multiplexing</code> 特点的存在，多个 <code>HTTP 请求</code> 可以在同一个 <code>TCP 连接</code> 中并行进行。</p>
<p>浏览器对同一域名下并发的 tcp 连接是有限制的（2-10 个不等），Chrome 最多允许对同一个 Host 建立六个 TCP 连接。</p>
<h4 id="get-和-post-的区别"><a href="#get-和-post-的区别" class="headerlink" title="get 和 post 的区别"></a>get 和 post 的区别</h4><p><code>get</code> 方法的含义是请求从服务器获取资源，这个资源可以是静态的文本、页面、图片视频等。</p>
<p>而 <code>post</code> 方法则是相反操作，它向 <code>URI</code> 指定的资源提交数据，数据就放在报文的 <code>body</code> 里。</p>
<p><code>get</code> 方法就是安全且幂等，<code>post</code> 则不是.</p>
<p><code>get</code>和<code>post</code>虽然本质都是<code>tcp/ip</code>，但两者除了在<code>http</code>层面外，在<code>tcp/ip</code>层面也有区别，<code>get</code>会产生一个<code>tcp</code>数据包，<code>post</code>两个。</p>
<p>具体就是：</p>
<ul>
<li><code>get</code>请求时，浏览器会把<code>headers</code>和<code>data</code>一起发送出去，服务器响应 200（返回数据），</li>
<li><code>post</code>请求时，浏览器先发送<code>headers</code>，服务器响应<code>100 continue</code>， 浏览器再发送<code>data</code>，服务器响应 200（返回数据）。</li>
</ul>
<p>再说一点，这里的区别是<code>specification</code>（规范）层面，而不是<code>implementation</code>（对规范的实现）</p>
<h4 id="TCP-UDP-的区别"><a href="#TCP-UDP-的区别" class="headerlink" title="TCP/UDP 的区别"></a>TCP/UDP 的区别</h4><ul>
<li>TCP 是面向连接的，UDP 是面向无连接的。TCP 在通信之前必须通过三次握手机制与对方建立连接，而 UDP 通信不必与对方建立连接，不管对方的状态就直接把数据发送给对方</li>
<li>TCP 连接过程耗时，UDP 不耗时</li>
<li>TCP 连接过程中出现的延时增加了被攻击的可能，安全性不高，而 UDP 不需要连接，安全性较高</li>
<li>TCP 是可靠的，保证数据传输的正确性，不易丢包;UDP 是不可靠的，易丢包</li>
<li>TCP 传输速率较慢，实时性差，udp 传输速率较快。tcp 建立连接需要耗时，并且 tcp 首部信息太多，每次传输的有用信息较少，实时性差</li>
<li>TCP 是流模式，udp 是数据包模式。tcp 只要不超过缓冲区的大小就可以连续发送数据到缓冲区上，接收端只要缓冲区上有数据就可以读取，可以一次读取多个数据包，而 udp 一次只能读取一个数据包，数据包之间独立</li>
</ul>
<h4 id="TCP-可靠性的六大手段"><a href="#TCP-可靠性的六大手段" class="headerlink" title="TCP 可靠性的六大手段"></a>TCP 可靠性的六大手段</h4><ul>
<li><strong>顺序编号</strong>：tcp 在传输文件的时候，会将文件拆分为多个 tcp 数据包，每个装满的数据包大小大约在 1k 左右，tcp 协议为保证可靠传输，会将这些数据包顺序编号</li>
<li><strong>确认机制</strong>：当数据包成功的被发送方发送给接收方，接收方会根据 tcp 协议反馈给发送方一个成功接收的 ACK 信号，信号中包含了当前包的序号</li>
<li><strong>超时重传</strong>：当发送方发送数据包给接收方时，会为每一个数据包设置一个定时器，当在设定的时间内，发送方仍没有收到接收方的 ACK 信号，会再次发送该数据包，直到收到接收方的 ACK 信号或者连接已断开</li>
<li><strong>校验信息</strong>：tcp 首部校验信息较多，udp 首部校验信息较少</li>
<li><strong>流量控制</strong>：如果发送者发送数据过快，接收者来不及接收，那么就会有分组丢失。为了避免分组丢失，控制发送者的发送速度，使得接收者来得及接收，这就是流量控制。由滑动窗口协议（连续 ARQ 协议）实现。滑动窗口协议既保证了分组无差错、有序接收，也实现了流量控制。主要的方式就是接收方返回的 ACK 中会包含自己的接收窗口的大小，并且利用大小来控制发送方的数据发送。（）</li>
<li><strong>拥塞控制</strong>：拥塞控制是作用于网络的，它是防止过多的数据注入到网络中，避免出现网络负载过大的情况；常用的方法就是：（ 1 ）慢开始、拥塞避免（ 2 ）快重传、快恢复。</li>
</ul>
<h3 id="七层因特网协议栈（ISO）"><a href="#七层因特网协议栈（ISO）" class="headerlink" title="七层因特网协议栈（ISO）"></a>七层因特网协议栈（ISO）</h3><p><img src="http://cdn.flqin.com/p336-16.jpeg" alt="五层因特网协议栈"></p>
<p><strong>从客户端发出 http 请求到服务器接收，中间会经过一系列的流程。</strong></p>
<p>简括就是：<strong>从应用层的发送 http 请求，到传输层通过三次握手建立 tcp/ip 连接，再到网络层的 ip 寻址，再到数据链路层的封装成帧，最后到物理层的利用物理介质传输。</strong></p>
<p>当然，服务端的接收就是反过来的步骤。</p>
<p>七层因特网协议栈其实就是：</p>
<ol>
<li>应用层(http,ftp) 这一层为操作系统或网络应用程序提供访问网络服务的接口,如 DNS 解析成 IP 并发送 http 请求</li>
<li>表示层(Telnet,SNMP) 主要处理两个通信系统中交换信息的表示方式，包括数据格式交换，数据加密与解密，数据压缩与终端类型转换等</li>
<li>会话层(dns,SMTP) 这一层管理主机之间的会话进程，即负责建立、管理、终止进程之间的会话，如控制登陆和注销过程。 (QoS)</li>
<li>传输层(tcp,udp) 建立 tcp 连接（三次握手）,数据的单位称为数据段（segment）（四层交换机）</li>
<li>网络层(IP,ARP) IP 寻址，数据的单位称为数据包（packet）（路由器、三层交换机）</li>
<li>数据链路层(PPP) 将 bit 流封装成 frame 帧（网桥、二层交换机）</li>
<li>物理层(传输 bit 流) 物理传输（然后传输的时候通过双绞线、电磁波、光纤、中继器和集线器 &amp; RJ-45(网线接口)等各种介质）</li>
</ol>
<h2 id="从服务器接收到请求到对应后台接收到请求"><a href="#从服务器接收到请求到对应后台接收到请求" class="headerlink" title="从服务器接收到请求到对应后台接收到请求"></a>从服务器接收到请求到对应后台接收到请求</h2><p>服务端在接收到请求时，内部会进行很多的处理</p>
<p>这里由于不是专业的后端分析，所以只是简单的介绍下，不深入</p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>对于大型的项目，由于并发访问量很大，所以往往一台服务器是吃不消的，所以一般会有若干台服务器组成一个集群，然后配合反向代理实现负载均衡</p>
<p>当然了，负载均衡不止这一种实现方式，这里不深入…</p>
<p>简单的说：<strong>用户发起的请求都指向调度服务器（反向代理服务器，譬如安装了 nginx 控制负载均衡），然后调度服务器根据实际的调度算法，分配不同的请求给对应集群中的服务器执行，然后调度器等待实际服务器的 HTTP 响应，并将它反馈给用户</strong></p>
<h3 id="后台的处理"><a href="#后台的处理" class="headerlink" title="后台的处理"></a>后台的处理</h3><p>一般后台都是部署到容器中的，所以一般为：</p>
<ul>
<li>先是容器接受到请求（如 tomcat 容器）</li>
<li>然后对应容器中的后台程序接收到请求（如 java 程序）</li>
<li>然后就是后台会有自己的统一处理，处理完后响应响应结果</li>
</ul>
<p>概括下：</p>
<ul>
<li>一般有的后端是有统一的验证的，如安全拦截，跨域验证</li>
<li>如果这一步不符合规则，就直接返回了相应的 http 报文（如拒绝请求等）</li>
<li>然后当验证通过后，才会进入实际的后台代码，此时是程序接收到请求，然后执行（譬如查询数据库，大量计算等等）</li>
<li>等程序执行完毕后，就会返回一个 http 响应包（一般这一步也会经过多层封装）</li>
<li>然后就是将这个包从后端发送到前端，完成交互</li>
</ul>
<h2 id="后台和前台的-http-交互"><a href="#后台和前台的-http-交互" class="headerlink" title="后台和前台的 http 交互"></a>后台和前台的 http 交互</h2><p>前后端交互时，http（超文本传输协议，HyperText Transfer Protocol） 报文作为信息的载体，所以 http 是一块很重要的内容，这一部分重点介绍它。</p>
<p>HTTP 是一个在计算机世界里专门在「两点」之间「传输」文字、图片、音频、视频等「超文本」数据的「约定和规范」。</p>
<h3 id="http-特性"><a href="#http-特性" class="headerlink" title="http 特性"></a>http 特性</h3><p>HTTP 最凸出的优点是 <strong>简单、灵活和易于扩展、应用广泛和跨平台</strong>。</p>
<p>HTTP 最大双刃剑是 <strong>无状态、明文传输</strong>。</p>
<p>HTTP 最大缺点是 <strong>不安全</strong>。</p>
<h3 id="http-工作流程"><a href="#http-工作流程" class="headerlink" title="http 工作流程"></a>http 工作流程</h3><ol>
<li>地址解析</li>
<li>封装 HTTP 请求数据包</li>
<li>封装成 TCP 包，建立 TCP 连接（TCP 的三次握手）</li>
<li>客户机发送请求命令</li>
<li>服务器响应</li>
<li>服务器关闭 TCP 连接</li>
</ol>
<p>客户机发起一次请求的时候：</p>
<p>客户机会将请求封装成 http 数据包–&gt;封装成 Tcp 数据包–&gt;封装成 Ip 数据包—&gt;封装成数据帧—&gt;硬件将帧数据转换成 bit 流（二进制数据）–&gt;最后通过物理硬件（网卡芯片）发送到指定地点。</p>
<p>服务器硬件首先收到 bit 流……. 然后转换成 ip 数据包。于是通过 ip 协议解析 Ip 数据包，然后又发现里面是 tcp 数据包，就通过 tcp 协议解析 Tcp 数据包，接着发现是 http 数据包通过 http 协议再解析 http 数据包得到数据。</p>
<h3 id="http-报文结构"><a href="#http-报文结构" class="headerlink" title="http 报文结构"></a>http 报文结构</h3><p>报文一般包括了：<code>通用头部(General)</code>，<code>请求/响应头部</code>，<code>请求/响应体</code></p>
<h4 id="通用头部"><a href="#通用头部" class="headerlink" title="通用头部"></a>通用头部</h4><p>这也是开发人员见过的最多的信息，包括如下：</p>
<ul>
<li><code>Request Url</code>: 请求的 web 服务器地址</li>
<li><code>Request Method</code>: 请求方式（Get、POST、OPTIONS、PUT、HEAD、DELETE、CONNECT、TRACE）</li>
<li><code>Status Code</code>: 请求的返回状态码，如 200 代表成功</li>
<li><code>Remote Address</code>: 请求的远程服务器地址（会转为 IP）</li>
<li><code>Referrer-Policy</code>: 控制请求头中 referrer 的内容<a href="https://juejin.im/post/5cd81b59518825686a06fd05" target="_blank" rel="noopener">查阅</a></li>
</ul>
<p>譬如，在跨域拒绝时，可能是<code>method</code>为<code>options</code>，状态码为<code>404/405</code>等（当然，实际上可能的组合有很多）</p>
<p>其中，<code>Method</code>的话一般分为两批次：</p>
<ul>
<li><code>HTTP1.0</code>定义了三种请求方法：<code>GET, POST 和 HEAD方法</code>。以及几种<code>Additional Request Methods：PUT、DELETE、LINK、UNLINK</code></li>
<li><code>HTTP1.1</code>定义了八种请求方法：<code>GET、POST、HEAD、OPTIONS, PUT, DELETE, TRACE 和 CONNECT 方法。</code></li>
</ul>
<p>这里面最常用到的就是状态码，很多时候都是通过状态码来判断，如（列举几个最常见的）：</p>
<ul>
<li><code>200</code>——表明该请求被成功地完成，所请求的资源发送回客户端</li>
<li><code>304</code>——自从上次请求后，请求的网页未修改过，请客户端使用本地缓存</li>
<li><code>400</code>——客户端请求有错（譬如可以是安全模块拦截）</li>
<li><code>401</code>——请求未经授权</li>
<li><code>403</code>——禁止访问（譬如可以是未登录时禁止）</li>
<li><code>404</code>——资源未找到</li>
<li><code>500</code>——服务器内部错误</li>
<li><code>503</code>——服务不可用</li>
</ul>
<p>再列举下大致不同范围状态的意义</p>
<ul>
<li><code>1xx</code>——指示信息，表示请求已接收，继续处理</li>
<li><code>2xx</code>——成功，表示请求已被成功接收、理解、接受</li>
<li><code>3xx</code>——重定向，要完成请求必须进行更进一步的操作</li>
<li><code>4xx</code>——客户端错误，请求有语法错误或请求无法实现</li>
<li><code>5xx</code>——服务器端错误，服务器未能实现合法的请求</li>
</ul>
<p><img src="http://cdn.flqin.com/p336-3.png" alt="http status"></p>
<p>总之，当请求出错时，状态码能帮助快速定位问题，完整版本的状态可以自行去互联网搜索</p>
<h4 id="请求-响应头部"><a href="#请求-响应头部" class="headerlink" title="请求/响应头部"></a>请求/响应头部</h4><p>请求和响应头部也是分析时常用到的</p>
<p>常用的请求头部（部分）：</p>
<ul>
<li><code>Accept</code>: 接收类型，表示浏览器支持的 MIME 类型（对标服务端返回的 Content-Type）</li>
<li><code>Accept-Encoding</code>：浏览器支持的压缩类型,如 gzip 等,超出类型不能接收</li>
<li><code>Content-Type</code>：客户端发送出去实体内容的类型</li>
<li><code>Cache-Control</code>: 指定请求和响应遵循的缓存机制，如 no-cache</li>
<li><code>If-Modified-Since</code>：对应服务端的 Last-Modified，用来匹配看文件是否变动，只能精确到 1s 之内，http1.0 中</li>
<li><code>Expires</code>：缓存控制，在这个时间内不会请求，直接使用缓存，http1.0，而且是服务端时间</li>
<li><code>Max-age</code>：代表资源在本地缓存多少秒，有效时间内不会请求，而是使用缓存，http1.1 中</li>
<li><code>If-None-Match</code>：对应服务端的 ETag，用来匹配文件内容是否改变（非常精确），http1.1 中</li>
<li><code>Cookie</code>: 有 cookie 并且同域访问时会自动带上</li>
<li><code>Connection</code>: 当浏览器与服务器通信时对于长连接如何进行处理,如 keep-alive</li>
<li><code>Host</code>：请求的服务器 URL</li>
<li><code>Origin</code>：最初的请求是从哪里发起的（只会精确到端口）,Origin 比 Referer 更尊重隐私</li>
<li><code>Referer</code>：该页面的来源 URL(适用于所有类型的请求，会精确到详细页面地址，csrf 拦截常用到这个字段)</li>
<li><code>User-Agent</code>：用户客户端的一些必要信息，如 UA 头部等</li>
</ul>
<p>常用的响应头部（部分）：</p>
<ul>
<li><code>Access-Control-Allow-Headers</code>: 服务器端允许的请求 Headers</li>
<li><code>Access-Control-Allow-Methods</code>: 服务器端允许的请求方法</li>
<li><code>Access-Control-Allow-Origin</code>: 服务器端允许的请求 Origin 头部（譬如为*）</li>
<li><code>Content-Type</code>：服务端返回的实体内容的类型</li>
<li><code>Content-Length</code>：表明本次回应的数据长度</li>
<li><code>Content-Encoding</code>：表示服务器返回的数据使用了什么压缩格式</li>
<li><code>Date</code>：数据从服务器发送的时间</li>
<li><code>Cache-Control</code>：告诉浏览器或其他客户，什么环境可以安全的缓存文档</li>
<li><code>Last-Modified</code>：请求资源的最后修改时间</li>
<li><code>Expires</code>：应该在什么时候认为文档已经过期,从而不再缓存它</li>
<li><code>Max-age</code>：客户端的本地资源应该缓存多少秒，开启了 Cache-Control 后有效</li>
<li><code>ETag</code>：请求变量的实体标签的当前值</li>
<li><code>Set-Cookie</code>：设置和页面关联的 cookie，服务器通过这个头部把 cookie 传给客户端</li>
<li><code>Keep-Alive</code>：如果客户端有 keep-alive，服务端也会有响应（如 timeout=38）</li>
<li><code>Server</code>：服务器的一些相关信息</li>
</ul>
<p>一般来说，请求头部和响应头部是匹配分析的。</p>
<p>譬如，请求头部的<code>Accept</code>要和响应头部的<code>Content-Type</code>匹配，否则会报错</p>
<p>譬如，跨域请求时，请求头部的<code>Origin</code>要匹配响应头部的<code>Access-Control-Allow-Origin</code>，否则会报跨域错误</p>
<p>譬如，在使用缓存时，请求头部的<code>If-Modified-Since、If-None-Match</code>分别和响应头部的<code>Last-Modified、ETag</code>对应</p>
<h4 id="请求-响应实体"><a href="#请求-响应实体" class="headerlink" title="请求/响应实体"></a>请求/响应实体</h4><p><code>http</code>请求时，除了头部，还有消息实体，一般来说:</p>
<ul>
<li><p>请求实体中会将一些需要的参数都放入进入（用于 post 请求）如实体中可以放参数的序列化形式（a=1&amp;b=2 这种），或者直接放表单对象（Form Data 对象，上传时可以夹杂参数以及文件）等等</p>
</li>
<li><p>响应实体中就是放服务端需要传给客户端的内容，一般现在的接口请求时，实体中就是对于的信息的 json 格式，而像页面请求这种，里面就是直接放了一个 html 字符串，然后浏览器自己解析并渲染。</p>
</li>
</ul>
<h4 id="CRLF"><a href="#CRLF" class="headerlink" title="CRLF"></a>CRLF</h4><p>CRLF（Carriage-Return Line-Feed），意思是回车换行，一般作为分隔符存在</p>
<p>请求头和实体消息之间有一个 CRLF 分隔，响应头部和响应实体之间用一个 CRLF 分隔</p>
<p>一般来说（分隔符类别）：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CRLF-&gt;Windows-style</span><br><span class="line">LF-&gt;Unix Style</span><br><span class="line">CR-&gt;Mac Style</span><br></pre></td></tr></tbody></table></figure>

<p>如下图是对某请求的 http 报文结构的简要分析:</p>
<p><img src="http://cdn.flqin.com/p336-4.png" alt="http报文结构"></p>
<h3 id="cookie-以及优化"><a href="#cookie-以及优化" class="headerlink" title="cookie 以及优化"></a>cookie 以及优化</h3><p><code>cookie</code>是浏览器的一种本地存储方式，一般用来帮助客户端和服务端通信的，常用来进行身份校验，结合服务端的<code>session</code>使用。</p>
<p>场景如下（简述）：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在登陆页面，用户登陆了</span><br><span class="line">此时，服务端会生成一个session，session中有对于用户的信息（如用户名、密码等）</span><br><span class="line">然后会有一个sessionid（相当于是服务端的这个session对应的key）</span><br><span class="line">然后服务端在登录页面中写入cookie，值就是:jsessionid=xxx</span><br><span class="line">然后浏览器本地就有这个cookie了，以后访问同域名下的页面时，自动带上cookie，自动检验，在有效时间内无需二次登陆。</span><br></pre></td></tr></tbody></table></figure>

<p>上述就是<code>cookie</code>的常用场景简述（当然了，实际情况下得考虑更多因素）</p>
<p>一般来说，<code>cookie</code>是不允许存放敏感信息的（千万不要明文存储用户名、密码），因为非常不安全，如果一定要强行存储，首先，一定要在<code>cookie</code>中设置<code>httponly</code>（这样就无法通过 js 操作了），另外可以考虑<code>rsa</code>等非对称加密（因为实际上，浏览器本地也是容易被攻克的，并不安全）</p>
<p>另外，由于在同域名的资源请求时，浏览器会默认带上本地的 cookie，针对这种情况，在某些场景下是需要优化的。</p>
<p>譬如以下场景：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">客户端在域名A下有cookie（这个可以是登陆时由服务端写入的）</span><br><span class="line">然后在域名A下有一个页面，页面中有很多依赖的静态资源（都是域名A的，譬如有<span class="number">20</span>个静态资源）</span><br><span class="line">此时就有一个问题，页面加载，请求这些静态资源时，浏览器会默认带上cookie</span><br><span class="line">也就是说，这<span class="number">20</span>个静态资源的http请求，每一个都得带上cookie，而实际上静态资源并不需要cookie验证</span><br><span class="line">此时就造成了较为严重的浪费，而且也降低了访问速度（因为内容更多了）</span><br></pre></td></tr></tbody></table></figure>

<p>当然了，针对这种场景，是有优化方案的（多域名拆分）。具体做法就是：</p>
<ul>
<li>将静态资源分组，分别放到不同的域名下（如<code>static.base.com</code>）</li>
<li>而<code>page.base.com</code>（页面所在域名）下请求时，是不会带上<code>static.base.com</code>域名的<code>cookie</code>的，所以就避免了浪费</li>
</ul>
<p>说到了多域名拆分，这里再提一个问题，那就是：</p>
<ul>
<li>在移动端，如果请求的域名数过多，会降低请求速度（因为域名整套解析流程是很耗费时间的，而且移动端一般带宽都比不上 pc）</li>
<li>此时就需要用到一种优化方案：<code>dns-prefetch</code>（让浏览器空闲时提前解析 dns 域名，不过也请合理使用，勿滥用）</li>
</ul>
<p>关于 cookie 的交互，可以看下图总结:</p>
<p><img src="http://cdn.flqin.com/p336-5.png" alt="cookie交互"></p>
<h3 id="gzip-压缩"><a href="#gzip-压缩" class="headerlink" title="gzip 压缩"></a>gzip 压缩</h3><p>首先，明确<code>gzip</code>是一种压缩格式，需要浏览器支持才有效（不过一般现在浏览器都支持）， 而且<code>gzip</code>压缩效率很好（高达 70%左右）,一般是由<code>apache、tomcat</code>等<code>web</code>服务器开启</p>
<p>一般只需要在服务器上开启了<code>gzip</code>压缩，然后之后的请求就都是基于<code>gzip</code>压缩格式的，当然服务器除了<code>gzip</code>外，也还会有其它压缩格式（如 deflate，没有 gzip 高效，且不流行）</p>
<h3 id="长连接与短连接"><a href="#长连接与短连接" class="headerlink" title="长连接与短连接"></a>长连接与短连接</h3><p>首先看<code>tcp/ip</code>层面的定义：</p>
<ul>
<li>长连接：一个<code>tcp/ip</code>连接上可以连续发送多个数据包，在<code>tcp连接</code>保持期间，如果没有数据包发送，需要双方发检测包以维持此连接，一般需要自己做在线维持（类似于心跳包）</li>
<li>短连接：通信双方有数据交互时，就建立一个<code>tcp连接</code>，数据发送完成后，则断开此<code>tcp连接</code></li>
</ul>
<p>然后在 http 层面：</p>
<ul>
<li><code>http1.0</code>中，默认使用的是短连接，也就是说，浏览器没进行一次 http 操作，就建立一次连接，任务结束就中断连接，譬如每一个静态资源请求时都是一个单独的连接</li>
<li><code>http1.1</code>起，默认使用长连接，使用长连接会有这一行<code>Connection: keep-alive</code>，在长连接的情况下，当一个网页打开完成后，客户端和服务端之间用于传输<code>http</code>的<code>tcp连接</code>不会关闭，如果客户端再次访问这个服务器的页面，会继续使用这一条已经建立的连接</li>
</ul>
<p>注意： <strong>keep-alive 不会永远保持，它有一个持续时间，一般在服务器中配置（如 apache），另外长连接需要客户端和服务器都支持时才有效</strong></p>
<h3 id="http-1-1-性能瓶颈"><a href="#http-1-1-性能瓶颈" class="headerlink" title="http 1.1 性能瓶颈"></a>http 1.1 性能瓶颈</h3><ul>
<li>请求 / 响应头部（Header）未经压缩就发送，首部信息越多延迟越大。只能压缩 Body 的部分；</li>
<li>发送冗长的首部。每次互相发送相同的首部造成的浪费较多；</li>
<li>服务器是按请求的顺序响应的，如果服务器响应慢，会招致客户端一直请求不到数据，也就是队头阻塞；</li>
<li>没有请求优先级控制；</li>
<li>请求只能从客户端开始，服务器只能被动响应。</li>
</ul>
<h3 id="http-2-0"><a href="#http-2-0" class="headerlink" title="http 2.0"></a>http 2.0</h3><p><code>http2.0</code>不是<code>https</code>，它相当于是<code>http</code>的下一代规范（譬如<code>https</code>的请求可以是<code>http2.0</code>规范的）</p>
<p>然后简述下<code>http2.0</code>与<code>http1.1</code>的显著不同点：</p>
<ul>
<li><code>http1.1</code>中，每请求一个资源，都是需要开启一个<code>tcp/ip</code>连接的，所以对应的结果是，每一个资源对应一个<code>tcp/ip</code>请求，由于<code>tcp/ip</code>本身有并发数限制，所以当资源一多，速度就显著慢下来</li>
<li><code>http2.0</code>中，一个<code>tcp/ip</code>请求可以请求多个资源，也就是说，只要一次<code>tcp/ip</code>请求，就可以请求若干个资源，分割成更小的帧请求，速度明显提升。</li>
</ul>
<p>所以，如果<code>http2.0</code>全面应用，很多<code>http1.1</code>中的优化方案就无需用到了（譬如打包成精灵图，静态资源多域名拆分等）</p>
<p>然后简述下<code>http2.0</code>的一些特性：</p>
<ul>
<li><strong>多路复用</strong>（即允许同时通过单一的 HTTP/2 连接（<code>tcp/ip</code>连接）可以请求多个资源，在 HTTP/1.1 协议中 「浏览器客户端在同一时间，针对同一域名下的请求有一定数量限制。超过限制数目的请求会被阻塞」）</li>
<li><strong>首部压缩</strong>（<code>http</code>头部压缩（HPACK 算法），减少体积）</li>
<li><strong>二进制分帧</strong>（在应用层(HTTP/2)跟传输层(TCP or UDP)之间增加了一个二进制分帧层，改进传输性能，实现低延迟和高吞吐量）</li>
<li><strong>服务器端推送</strong>（也称为<strong>缓存推送</strong>，服务端可以对客户端的一个请求发出多个响应，可以主动通知客户端，当一个客户端请求资源 X，而服务器知道它很可能也需要资源 Z 的情况下，服务器可以在客户端发送请求前，主动将资源 Z 推送给客户端）</li>
<li><strong>请求优先级</strong>（如果数据流被赋予了优先级，它就会基于这个优先级来处理，由服务器决定需要多少资源来处理该请求。）</li>
</ul>
<h3 id="https"><a href="#https" class="headerlink" title="https"></a>https</h3><p><code>https</code>就是安全版本的<code>http</code>，譬如一些支付等操作基本都是基于 <code>https</code> 的，因为 <code>http</code> 请求的安全系数太低了。</p>
<p>简单来看，<code>https</code>与<code>http</code>的区别就是： 在请求前，会建立<code>ssl链接</code>，确保接下来的通信都是加密的，无法被轻易截取分析。</p>
<p>一般来说，如果要将网站升级成<code>https</code>，需要后端支持（后端需要申请<code>CA证书</code>等），然后<code>https</code>的开销也比<code>http</code>要大（因为需要额外建立安全链接以及加密等），所以一般来说<code>http2.0</code>配合<code>https</code>的体验更佳（因为<code>http2.0</code>更快了）</p>
<h4 id="https-原理"><a href="#https-原理" class="headerlink" title="https 原理"></a>https 原理</h4><p>一般来说，主要关注的就是<code>SSL/TLS</code>的握手流程：</p>
<ol>
<li><p><strong>ClientHello</strong></p>
<p>浏览器发起 <code>https</code> 请求建立 <code>SSL链接</code>（服务器的 443 端口），并向服务端发送以下信息（第一次 HTTP 请求）（明文传输）：</p>
<ul>
<li>随机数 <code>Client random</code>，后面用于生成 <code>会话对称加密密钥</code></li>
<li>客户端支持的<code>加密方法</code>，比如 RSA 加密</li>
<li>客户端支持的 <code>SSL/TLS</code> 协议版本，如 TLS 1.2 版本</li>
</ul>
</li>
<li><p><strong>SeverHello</strong></p>
<p>服务器收到客户端请求后，向客户端发出响应，向客户端发送以下信息（明文传输）：</p>
<ul>
<li>随机数 <code>Server random</code>，后面用于生成 <code>会话对称加密密钥</code></li>
<li>确认的 <code>加密算法</code>与<code>Hash算法</code></li>
<li>确认 <code>SSL/ TLS</code> 协议版本，如果浏览器不支持，则关闭加密通信</li>
<li>服务器的数字证书（证书里包含了网站地址，非对称加密的公钥，以及证书颁发机构等信息）</li>
</ul>
</li>
<li><p><strong>浏览器回应</strong></p>
<p><code>TLS</code> 来验证证书的合法性（通过浏览器或者操作系统中的 <code>CA</code> 公钥验证颁发机构是否合法，证书中包含的网址是否和正在访问的一样，过期时间等），如果证书信任则浏览器会显示一个小锁头，否则会弹出一个警告框提示证书存在问题。</p>
<p>客户端接收证书后（不管信不信任），会从数字证书中取出服务器的公钥，然后使用它加密报文，向服务器发送如下信息（第二次 HTTP 请求）：</p>
<ul>
<li>新的随机数 <code>Premaster secret</code>，该随机数会被服务器公钥加密</li>
<li>加密通信算法改变通知，表示随后的信息都将用「会话秘钥」加密通信。</li>
<li>客户端握手结束通知，表示客户端的握手阶段已经结束。这一项同时把之前所有内容的发生的数据做个摘要，用来供服务端校验。</li>
</ul>
<p>利用 <code>Client random</code>、<code>Server random</code> 和 <code>Premaster secret</code> 通过双方协商的加密算法<strong>各自</strong>生成本次通信的 <strong>会话对称加密密钥</strong>。</p>
</li>
<li><p><strong>服务器的最后回应</strong></p>
<p>服务器收到客户端的第三个随机数 <code>Premaster secret</code> 之后，通过协商的加密算法计算出本次通信的 <strong>会话对称加密密钥</strong>。使用该密钥解密浏览器发来的握手消息，并验证<code>Hash</code>是否与浏览器发来的一致。然后向客户端发生最后的信息：</p>
<ul>
<li>加密通信算法改变通知，表示随后的信息都将用<strong>会话对称加密密钥</strong>加密通信。</li>
<li>服务器握手结束通知，表示服务器的握手阶段已经结束。这一项同时把之前所有内容的发生的数据做个摘要，用来供客户端校验。</li>
</ul>
</li>
<li><p>浏览器解密并计算握手消息的 <code>HASH</code>，如果与服务端发来的 <code>HASH</code>一致，此时握手过程结束。接下来，客户端与服务器进入加密通信，就完全是使用普通的 <code>HTTP</code> 协议，只不过用<strong>会话对称加密密钥</strong>加密内容。</p>
</li>
</ol>
<p>这里放一张图（来源：阮一峰-图解 SSL/TLS 协议）</p>
<p><img src="http://cdn.flqin.com/p336-6.png" alt="图解SSL/TLS协议"></p>
<h4 id="https-加密是在传输层"><a href="#https-加密是在传输层" class="headerlink" title="https 加密是在传输层"></a>https 加密是在传输层</h4><p><code>https</code> 报文在被包装成 <code>tcp</code> 报文的时候完成加密的过程，无论是 <code>https</code> 的 <code>header</code> 域也好，<code>body</code> 域也罢都是会被加密的。</p>
<p>当使用 <code>tcpdump</code> 或者 <code>wireshark</code> 之类的 <code>tcp</code> 层工具抓包，获取是加密的内容，而如果用应用层抓包，使用 <code>Charels(Mac)、Fildder(Windows)</code> 抓包工具，那当然看到是明文的</p>
<h4 id="加密算法，信息摘要，数字签名，数字证书，CA"><a href="#加密算法，信息摘要，数字签名，数字证书，CA" class="headerlink" title="加密算法，信息摘要，数字签名，数字证书，CA"></a>加密算法，信息摘要，数字签名，数字证书，CA</h4><ul>
<li>对称加密算法：<code>AES，RC4，3DES</code>，</li>
<li>非对称加密算法：<code>RSA，DSA/DSS</code>，</li>
<li>摘要算法（哈希 <code>hash</code> 算法、散列算法）：<code>MD5，SHA1，SHA256</code>，加盐 <code>salt</code> 提升复杂度</li>
<li>信息摘要：通过信息摘要算法（HASH），将原信息摘要为一个固定长度的摘要</li>
<li>数字签名：信息摘要被私钥加密后的密文</li>
<li>数字证书：可以简单理解为 被 CA 承认且无法篡改的<strong>公钥</strong>，可用于验证网站是否可信（针对 <code>HTTPS</code>）、验证某文件是否可信（是否被篡改）等，也可以用一个证书来证明另一个证书是真实可信，最顶级的证书称为根证书。除了根证书（自己证明自己是可靠），其它证书都要依靠上一级的证书，来证明自己。</li>
<li>CA：Certificate Authority 签发证书的权威机构</li>
<li>根 CA：CA 的 CA，可以签发 CA 的证书</li>
<li>根证书：根 CA 的自签名证书，内置在操作系统和浏览器中</li>
</ul>
<h3 id="HTTPS-和-HTTP-的区别"><a href="#HTTPS-和-HTTP-的区别" class="headerlink" title="HTTPS 和 HTTP 的区别"></a>HTTPS 和 HTTP 的区别</h3><ol>
<li><code>https</code> 协议需要到 <code>ca</code> 申请证书或自制证书。</li>
<li><code>http</code> 的信息是明文传输，<code>https</code> 则是具有安全性的 <code>ssl</code> 加密。</li>
<li><code>http</code> 是直接与 <code>TCP</code> 进行数据传输，而 <code>https</code> 是经过一层 <code>SSL</code>（OSI 会话层），用的端口也不一样，前者是 <code>80</code>（需要国内备案），后者是 <code>443</code>。</li>
<li><code>http</code> 的连接很简单，是无状态的；<code>https</code> 协议是由 <code>SSL+HTTP</code> 协议构建的可进行加密传输、身份认证的网络协议，比 <code>http</code> 协议安全。</li>
<li><code>https</code> 协议握手阶段比较费时，会使页面的加载时间延长近 50%，增加 10% 到 20% 的耗电。</li>
<li><code>https</code> 连接缓存不如 <code>http</code> 高效，会增加数据开销和功耗，甚至已有的安全措施也会因此而受到影响。</li>
<li>谷歌曾在 2014 年 8 月份调整搜索引擎算法，并称“比起同等 <code>HTTP</code> 网站，采用 <code>HTTPS</code> 加密的网站在搜索结果中的排名将会更高”。</li>
</ol>
<h2 id="单独拎出来的缓存问题，http-的缓存"><a href="#单独拎出来的缓存问题，http-的缓存" class="headerlink" title="单独拎出来的缓存问题，http 的缓存"></a>单独拎出来的缓存问题，http 的缓存</h2><p>前后端的<code>http交互</code>中，使用缓存能很大程度上的提升效率，而且基本上对性能有要求的前端项目都是必用缓存的</p>
<h3 id="强缓存与弱缓存"><a href="#强缓存与弱缓存" class="headerlink" title="强缓存与弱缓存"></a>强缓存与弱缓存</h3><p>缓存可以简单的划分成两种类型：<code>强缓存（200 from cache）</code>与<code>协商缓存（304）</code></p>
<p>区别简述如下：</p>
<ul>
<li><code>强缓存（200 from cache）</code>时，浏览器如果判断本地缓存未过期，就直接使用，无需发起<code>http请求</code></li>
<li><code>协商缓存（304）</code>时，浏览器会向服务端发起<code>http请求</code>，然后服务端告诉浏览器文件未改变，让浏览器使用本地缓存</li>
</ul>
<p>对于协商缓存，使用<code>Ctrl + F5</code>强制刷新可以使得缓存无效</p>
<p>但是对于强缓存，在未过期时，必须更新资源路径才能发起新的请求（更改了路径相当于是另一个资源了，这也是前端工程化中常用到的技巧）</p>
<h3 id="缓存头部简述"><a href="#缓存头部简述" class="headerlink" title="缓存头部简述"></a>缓存头部简述</h3><p>上述提到了强缓存和协商缓存，那它们是怎么区分的呢？</p>
<p>答案是通过不同的 http 头部控制</p>
<p>先看下这几个头部：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-None-Match/E-tag、If-Modified-Since/Last-Modified、Cache-Control/Max-Age、Pragma/Expires</span><br></pre></td></tr></tbody></table></figure>

<p>这些就是缓存中常用到的头部，这里不展开。仅列举下大致使用。</p>
<p>属于强缓存控制的：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">（http1.1）Cache-Control/Max-Age （http1.0）Pragma/Expires</span><br></pre></td></tr></tbody></table></figure>

<p>注意：<code>Max-Age</code>不是一个头部，它是<code>Cache-Control</code>头部的值</p>
<p>属于协商缓存控制的：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">（http1.1）If-None-Match/E-tag （http1.0）If-Modified-Since/Last-Modified</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到，上述有提到<code>http1.1</code>和<code>http1.0</code>，这些不同的头部是属于不同<code>http</code>时期的</p>
<p>再提一点，其实 HTML 页面中也有一个<code>meta标签</code>可以控制缓存方案:<code>Pragma</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>不过，这种方案还是比较少用到，因为支持情况不佳，譬如缓存代理服务器肯定不支持，所以不推荐</p>
<h3 id="头部的区别"><a href="#头部的区别" class="headerlink" title="头部的区别"></a>头部的区别</h3><p>首先明确，<code>http</code>的发展是从<code>http1.0</code>到<code>http1.1</code></p>
<p>而在<code>http1.1</code>中，出了一些新内容，弥补了<code>http1.0</code>的不足。</p>
<h3 id="http1-0-中的缓存控制"><a href="#http1-0-中的缓存控制" class="headerlink" title="http1.0 中的缓存控制"></a>http1.0 中的缓存控制</h3><ul>
<li><strong>Pragma</strong>：严格来说，它不属于专门的缓存控制头部，但是它设置 no-cache 时可以让本地强缓存失效（属于编译控制，来实现特定的指令，主要是因为兼容 http1.0，所以以前又被大量应用）</li>
<li><strong>Expires</strong>：服务端配置的，属于强缓存，用来控制在规定的时间之前，浏览器不会发出请求，而是直接使用本地缓存，注意，Expires 一般对应服务器端时间，如 Expires：Fri, 30 Oct 1998 14:19:41</li>
<li><strong>If-Modified-Since/Last-Modified</strong>：这两个是成对出现的，属于协商缓存的内容，其中浏览器的头部是 If-Modified-Since，而服务端的是 Last-Modified，它的作用是，在发起请求时，如果 If-Modified-Since 和 Last-Modified 匹配，那么代表服务器资源并未改变，因此服务端不会返回资源实体，而是只返回头部，通知浏览器可以使用本地缓存。Last-Modified，顾名思义，指的是文件最后的修改时间，而且只能精确到 1s 以内</li>
</ul>
<h3 id="http1-1-中的缓存控制"><a href="#http1-1-中的缓存控制" class="headerlink" title="http1.1 中的缓存控制"></a>http1.1 中的缓存控制</h3><ul>
<li><strong>Cache-Control</strong>：缓存控制头部，有 no-cache、max-age 等多种取值</li>
<li><strong>Max-Age</strong>：服务端配置的，用来控制强缓存，在规定的时间之内，浏览器无需发出请求，直接使用本地缓存，注意，Max-Age 是 Cache-Control 头部的值，不是独立的头部，譬如 Cache-Control: max-age=3600，而且它值得是绝对时间，由浏览器自己计算</li>
<li><strong>If-None-Match/E-tag</strong>：这两个是成对出现的，属于协商缓存的内容，其中浏览器的头部是 If-None-Match，而服务端的是 E-tag，同样，发出请求后，如果 If-None-Match 和 E-tag 匹配，则代表内容未变，通知浏览器使用本地缓存，和 Last-Modified 不同，E-tag 更精确，它是类似于指纹一样的东西，基于 FileEtag INode Mtime Size 生成，也就是说，只要文件变，指纹就会变，而且没有 1s 精确度的限制。</li>
</ul>
<h3 id="Max-Age-相比-Expires"><a href="#Max-Age-相比-Expires" class="headerlink" title="Max-Age 相比 Expires"></a>Max-Age 相比 Expires</h3><ul>
<li><p><strong>Expires</strong>: 使用的是服务器端的时间，但是有时候会有这样一种情况-客户端时间和服务端不同步，那这样，可能就会出问题了，造成了浏览器本地的缓存无用或者一直无法过期，所以一般<code>http1.1</code>后不推荐使用<code>Expires</code></p>
</li>
<li><p><strong>Max-Age</strong>: 使用的是客户端本地时间的计算，因此不会有这个问题，因此推荐使用<code>Max-Age</code>。</p>
</li>
</ul>
<p>注意，如果同时启用了<code>Cache-Control</code>与<code>Expires</code>，<code>Cache-Control</code>优先级高。</p>
<h3 id="E-tag-相比-Last-Modified"><a href="#E-tag-相比-Last-Modified" class="headerlink" title="E-tag 相比 Last-Modified"></a>E-tag 相比 Last-Modified</h3><ul>
<li><p><strong>Last-Modified</strong>：表明服务端的文件最后何时改变的,它有一个缺陷就是只能精确到 1s，而且有的服务端的文件会周期性的改变，导致缓存失效</p>
</li>
<li><p><strong>E-tag</strong>：是一种指纹机制，代表文件相关指纹，只有文件变才会变，也只要文件变就会变，也没有精确时间的限制，只要文件一遍，立马 E-tag 就不一样了</p>
</li>
</ul>
<p>如果同时带有<code>E-tag</code>和<code>Last-Modified</code>，服务端会优先检查<code>E-tag</code></p>
<p>各大缓存头部的整体关系如下图:</p>
<p><img src="http://cdn.flqin.com/p336-7.png" alt="缓存"></p>
<h2 id="解析页面流程"><a href="#解析页面流程" class="headerlink" title="解析页面流程"></a>解析页面流程</h2><p>前面有提到<code>http交互</code>，那么接下来就是浏览器获取到<code>html</code>，然后解析，渲染</p>
<h3 id="流程简述"><a href="#流程简述" class="headerlink" title="流程简述"></a>流程简述</h3><p><code>浏览器内核</code>拿到内容后，渲染步骤大致可以分为以下几步：</p>
<ol>
<li>解析 HTML，构建 DOM 树</li>
<li>解析 CSS，生成 CSS 规则树</li>
<li>合并 DOM 树和 CSS 规则树，生成 render 树</li>
<li>布局 render 树（Layout/reflow），负责各元素尺寸、位置的计算</li>
<li>绘制 render 树（paint），绘制页面像素信息</li>
<li>浏览器会将各层的信息发送给 GPU，GPU 会将各层合成（composite），显示在屏幕上</li>
</ol>
<p>如下图：</p>
<p><img src="http://cdn.flqin.com/p336-8.png" alt="页面渲染"></p>
<h3 id="HTML-解析，构建-DOM-树"><a href="#HTML-解析，构建-DOM-树" class="headerlink" title="HTML 解析，构建 DOM 树"></a>HTML 解析，构建 DOM 树</h3><p>整个渲染步骤中，HTML 解析是第一步。</p>
<p>简单的理解，这一步的流程是这样的：<strong>浏览器解析 HTML，构建 DOM 树。</strong></p>
<p>解析 HTML 到构建出 DOM 当然过程可以简述如下：<code>Bytes → characters → tokens → nodes → DOM</code></p>
<p>譬如假设有这样一个 HTML 页面：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Critical Path<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello <span class="tag">&lt;<span class="name">span</span>&gt;</span>web performance<span class="tag">&lt;/<span class="name">span</span>&gt;</span> students!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"awesome-photo.jpg"</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>浏览器的处理如下：</p>
<p><img src="http://cdn.flqin.com/p336-9.png" alt="构建DOM树1"></p>
<p>列举其中的一些重点过程：</p>
<ul>
<li><strong>Conversion 转换</strong>：浏览器将获得的 HTML 内容（Bytes）基于他的编码转换为单个字符</li>
<li><strong>Tokenizing 分词</strong>：浏览器按照 HTML 规范标准将这些字符转换为不同的标记 token。每个 token 都有自己独特的含义以及规则集</li>
<li><strong>Lexing 词法分析</strong>：分词的结果是得到一堆的 token，此时把他们转换为对象，这些对象分别定义他们的属性和规则</li>
<li><strong>DOM 构建</strong>：因为 HTML 标记定义的就是不同标签之间的关系，这个关系就像是一个树形结构一样 例如：body 对象的父节点就是 HTML 对象，然后段落 p 对象的父节点就是 body 对象</li>
</ul>
<p>最后的 DOM 树如下：</p>
<p><img src="http://cdn.flqin.com/p336-10.png" alt="构建DOM树2"></p>
<h3 id="生成-CSS-规则树"><a href="#生成-CSS-规则树" class="headerlink" title="生成 CSS 规则树"></a>生成 CSS 规则树</h3><p>同理，CSS 规则树的生成也是类似。简述为：<code>Bytes → characters → tokens → nodes → CSSOM</code></p>
<p>譬如 style.css 内容如下：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> {</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-tag">p</span> {</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">}</span><br><span class="line"><span class="selector-tag">span</span> {</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">}</span><br><span class="line"><span class="selector-tag">p</span> <span class="selector-tag">span</span> {</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">}</span><br><span class="line"><span class="selector-tag">img</span> {</span><br><span class="line">  <span class="attribute">float</span>: right;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>那么最终的 CSSOM 树就是：</p>
<p><img src="http://cdn.flqin.com/p336-11.png" alt="CSSOM树"></p>
<h3 id="构建渲染树"><a href="#构建渲染树" class="headerlink" title="构建渲染树"></a>构建渲染树</h3><p>当<code>DOM树</code>和<code>CSSOM树</code>都有了后，就要开始构建渲染树了，一般来说，渲染树和 DOM 树相对应的，但不是严格意义上的一一对应，因为有一些不可见的<code>DOM元素</code>不会插入到渲染树中，如<code>head</code>这种不可见的标签或者<code>display: none</code>等。</p>
<p>整体来说可以看图：</p>
<p><img src="http://cdn.flqin.com/p336-12.png" alt="构建渲染树"></p>
<h3 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h3><p>有了 render 树，接下来就是开始渲染，基本流程如下：</p>
<p><img src="http://cdn.flqin.com/p336-13.jpg" alt="渲染"></p>
<p>图中重要的四个步骤就是：</p>
<ol>
<li>计算 CSS 样式</li>
<li>构建渲染树</li>
<li><strong>布局</strong>，主要定位坐标和大小，是否换行，各种<code>position,overflow,z-index</code>属性</li>
<li><strong>绘制</strong>，将图像绘制出来</li>
</ol>
<p>然后，图中的线与箭头代表通过 js 动态修改了<code>DOM</code>或<code>CSS</code>，导致了<code>重新布局（Layout）</code>或<code>渲染（Repaint）</code></p>
<p>这里<code>Layout</code>和<code>Repaint</code>的概念是有区别的：</p>
<ul>
<li><code>Layout</code>，也称为<code>Reflow(重排)</code>，即<code>回流</code>。一般意味着元素的内容、结构、位置或尺寸发生了变化，需要重新计算样式和渲染树<ul>
<li>以下会触发回流：<ul>
<li>盒子模型相关属性会触发重布局(<code>width,height,padding,margin,display,border-width,border,min-height</code>)</li>
<li>定位属性及浮动也会触发重布局(<code>top,bottom,left,right,position,float,clear</code>)</li>
<li>改变节点内部文字结构也会触发重布局(<code>text-align,overflow-y,font-weight,overflow,font-family,line-height,vertival-align,white-space,font-size</code>)</li>
<li>获取某些属性也会引发回流，很多浏览器会对回流做优化，会等到数量足够时做一次批处理回流，但是除了 render 树的直接变化，当获取一些属性时，浏览器为了获得正确的值也会触发回流，这样使得浏览器优化无效，包括：<ul>
<li><code>offset(Top/Left/Width/Height)</code></li>
<li><code>scroll(Top/Left/Width/Height)</code></li>
<li><code>cilent(Top/Left/Width/Height)</code></li>
<li><code>width,height</code></li>
<li>调用了<code>getComputedStyle()</code>或者 IE 的<code>currentStyle</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>Repaint</code>，即重绘。意味着元素发生的改变只是影响了元素的一些外观之类的时候（<code>color,border-style,border-radius,visibility,text-decoration,background,background-image,background-position,background-repeat,background-size,outline-color,outline,outline-style,outline-width,box-shadow</code>），此时只需要应用新样式绘制这个元素就可以了</li>
</ul>
<p><code>回流</code>一定伴随着<code>重绘</code>，<code>重绘</code>却可以单独出现。<code>回流</code>的成本开销要高于<code>重绘</code>，而且一个节点的<code>回流</code>往往回导致子节点以及同级节点的<code>回流</code>， 所以优化方案中一般都包括，尽量避免<code>回流</code>。</p>
<p>本身浏览器通过<code>队列化修改</code>和<code>批量显示</code>优化重排版过程。其他一般会有一些<strong>优化方案</strong>，如：</p>
<ul>
<li>减少逐项更改 dom 样式，最好一次性更改<code>style</code>，或者将样式定义为<code>class</code>并一次性更新</li>
<li>把<code>DOM</code>离线后修改<ul>
<li>使用<code>documentFragment</code> 对象在内存里操作<code>DOM</code></li>
<li>先把<code>DOM</code>给<code>display:none</code>(有一次<code>reflow</code>)，然后你想怎么改就怎么改。比如修改 100 次，然后再把他显示出来</li>
<li><code>clone</code>一个<code>DOM</code>结点到内存里，然后想怎么改就怎么改，改完后，和在线的那个的交换一下</li>
</ul>
</li>
<li>不要把<code>DOM</code>结点的属性值(<code>offset</code>等)放在一个循环里当成循环里的变量。不然这会导致大量地读写这个结点的属性,无法避免则将它们缓存到变量</li>
<li>尽可能的修改层级比较低的<code>DOM</code>。当然，改变层级比较底的<code>DOM</code>有可能会造成大面积的<code>reflow</code>，但是也可能影响范围很小</li>
<li>将复杂的元素绝对定位(<code>absolute</code>)或固定定位(<code>fixed</code>)，使得它脱离文档流，否则回流代价会很高</li>
<li>千万不要使用<code>table</code>布局。因为可能很小的一个小改动会造成整个<code>table</code>的重新布局</li>
</ul>
<p>再来看一个示例：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="built_in">document</span>.body.style;</span><br><span class="line"></span><br><span class="line">s.padding = <span class="string">'2px'</span>; <span class="comment">// 回流+重绘</span></span><br><span class="line">s.border = <span class="string">'1px solid red'</span>; <span class="comment">// 再一次 回流+重绘</span></span><br><span class="line">s.color = <span class="string">'blue'</span>; <span class="comment">// 再一次重绘</span></span><br><span class="line">s.backgroundColor = <span class="string">'#ccc'</span>; <span class="comment">// 再一次 重绘</span></span><br><span class="line">s.fontSize = <span class="string">'14px'</span>; <span class="comment">// 再一次 回流+重绘</span></span><br><span class="line"><span class="comment">// 添加node，再一次 回流+重绘</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'abc!'</span>));</span><br></pre></td></tr></tbody></table></figure>

<h3 id="了解层"><a href="#了解层" class="headerlink" title="了解层"></a>了解层</h3><p>在第 6 步：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6.</span> 浏览器会将各层的信息发送给GPU，GPU会将各层合成（composite），显示在屏幕上</span><br></pre></td></tr></tbody></table></figure>

<h4 id="什么是-composite"><a href="#什么是-composite" class="headerlink" title="什么是 composite"></a>什么是 composite</h4><p>在 <code>DOM</code> 树中每个节点都会对应一个 <code>LayoutObject</code>，当他们的 <code>LayoutObject</code> 处于相同的坐标空间时，就会形成一个 <code>RenderLayers</code> ，也就是渲染层。<code>RenderLayers</code> 来保证页面元素以正确的顺序合成，这时候就会出现层合成（<code>composite</code>），从而正确处理透明元素和重叠元素的显示。</p>
<p><code>GPU</code>中，各个<code>复合图层</code>是单独绘制的，所以互不影响，可以通过<strong>硬件加速</strong>的方式，声明一个新的<code>复合图层</code>，它会单独分配资源。复合层是独立的，所以一般做动画推荐使用硬件加速。</p>
<p>调试方式 ：</p>
<ul>
<li><code>Chrome源码调试 -&gt; More Tools -&gt; Layers</code></li>
<li><code>Chrome源码调试 -&gt; More Tools -&gt; Rendering -&gt; Layer borders</code>,黄色的就是复合图层信息</li>
</ul>
<h4 id="RenderLayers-与-GraphicsLayers"><a href="#RenderLayers-与-GraphicsLayers" class="headerlink" title="RenderLayers 与 GraphicsLayers"></a>RenderLayers 与 GraphicsLayers</h4><p><img src="http://cdn.flqin.com/p336-18.png" alt="RenderLayers 与 GraphicsLayers"></p>
<p>chrome 中：</p>
<ul>
<li><code>RenderLayers</code> 渲染层，这是负责对应 <code>DOM 子树</code></li>
<li><code>GraphicsLayers</code> 图形层，这是负责对应 <code>RenderLayers 子树</code></li>
</ul>
<p><code>RenderObjects</code> 保持了树结构，他通过向一个绘图上下文（<code>GraphicsContext</code>）发出必要的绘制调用来绘制 <code>nodes</code>。</p>
<p>每个 <code>GraphicsLayer</code> 都有一个 <code>GraphicsContext</code>，<code>GraphicsContext</code> 会负责输出该层的<code>位图</code>，<code>位图</code>是存储在共享内存中，作为纹理上传到 <code>GPU</code> 中，最后由 <code>GPU</code> 将多个位图进行合成，然后 <code>draw</code> 到屏幕上，此时，我们的页面也就展现到了屏幕上。</p>
<h4 id="影响-composite-因素"><a href="#影响-composite-因素" class="headerlink" title="影响 composite 因素"></a>影响 composite 因素</h4><p>以下情形浏览器会主动将渲染层提至合成层(硬件加速)：</p>
<ul>
<li>z-index</li>
<li>3D 或透视变换(perspective transform) CSS 属性</li>
<li>video, canvas, iframe, Flash 等元素</li>
<li>opacity 属性/过渡动画</li>
<li>position: fixed</li>
<li>will-change</li>
<li>filter</li>
<li>backface-visibility</li>
<li>元素有一个包含复合层的后代节点(换句话说，就是一个元素拥有一个子元素，该子元素在自己的层里)</li>
<li>元素有一个 z-index 较低且包含一个复合层的兄弟元素(换句话说就是该元素在复合层上面渲染)</li>
</ul>
<p>使用硬件加速时，尽可能的使用<strong>z-index</strong>，防止浏览器默认给后续的元素创建复合层渲染.因为在 webkit CSS3 中，如果这个元素添加了硬件加速，并且 index 层级比较低，<br>那么在这个元素的后面其它元素会默认变为复合层渲染，如果处理不当会极大的影响性能，即如果 a 是一个复合图层，而且 b 在 a 上面，那么 b 也会被隐式转为一个复合图层。</p>
<h4 id="复合图层的优劣"><a href="#复合图层的优劣" class="headerlink" title="复合图层的优劣"></a>复合图层的优劣</h4><ul>
<li>优：合成层的位图，会交由 <code>GPU</code> 合成，比 <code>CPU</code> 处理要快</li>
<li>优：当需要 <code>repaint</code> 时，只需要 <code>repaint</code> 本身，不会影响到其他的层</li>
<li>优：元素提升为合成层后，<code>transform</code> 和 <code>opacity</code> 才不会触发 <code>paint</code>，如果不是合成层，则其依然会触发 <code>paint</code></li>
<li>劣：大量的合成层，这样会占用很多无辜的 <code>CPU</code> 和内存资源，严重影响了页面的性能</li>
<li>劣：层爆炸，由于某些原因可能导致产生大量不在预期内的合成层，虽然有浏览器的层压缩机制，但是也有很多无法进行压缩的情况，这就可能出现层爆炸的现象</li>
</ul>
<p>如果你已经把一个元素放到一个新的合成层里，那么可以使用 Timeline 来确认这么做是否真的改进了渲染性能。别盲目提升合成层，一定要分析其实际性能表现。</p>
<p>在内存资源有限的设备上，合成层带来的性能改善，可能远远赶不上过多合成层开销给页面性能带来的负面影响。同时，由于每个渲染层的纹理都需要上传到 GPU 处理，因此我们还需要考虑 CPU 和 GPU 之间的带宽问题、以及有多大内存供 GPU 处理这些纹理的问题。</p>
<h3 id="Chrome-中的调试"><a href="#Chrome-中的调试" class="headerlink" title="Chrome 中的调试"></a>Chrome 中的调试</h3><p>Chrome 的开发者工具中，Performance 中可以看到详细的渲染过程：</p>
<p><img src="http://cdn.flqin.com/p336-14.png" alt="Chrome中的调试"></p>
<h3 id="资源外链的下载"><a href="#资源外链的下载" class="headerlink" title="资源外链的下载"></a>资源外链的下载</h3><p>上面介绍了 html 解析，渲染流程。但实际上，在解析 html 时，会遇到一些资源连接，此时就需要进行单独处理了</p>
<p>简单起见，这里将遇到的静态资源分为一下几大类（未列举所有）：</p>
<ul>
<li>CSS 样式资源</li>
<li>JS 脚本资源</li>
<li>img 图片类资源</li>
</ul>
<h4 id="遇到外链时的处理"><a href="#遇到外链时的处理" class="headerlink" title="遇到外链时的处理"></a>遇到外链时的处理</h4><p>当遇到上述的外链时，会单独开启一个下载线程去下载资源（http1.1 中是每一个资源的下载都要开启一个 http 请求，对应一个 tcp/ip 链接）</p>
<h4 id="遇到-CSS-样式资源"><a href="#遇到-CSS-样式资源" class="headerlink" title="遇到 CSS 样式资源"></a>遇到 CSS 样式资源</h4><p>CSS 资源的处理有几个特点：</p>
<ul>
<li>CSS 下载时异步，不会阻塞浏览器构建<code>DOM树</code></li>
<li>但是会阻塞<code>渲染</code>，也就是在<code>构建render</code>时，会等到 css 下载解析完毕后才进行（这点与浏览器优化有关，防止 css 规则不断改变，避免了重复的构建）</li>
<li>有例外，<code>media query</code>声明的 CSS 是不会阻塞渲染的</li>
</ul>
<h4 id="遇到-JS-脚本资源"><a href="#遇到-JS-脚本资源" class="headerlink" title="遇到 JS 脚本资源"></a>遇到 JS 脚本资源</h4><p>JS 脚本资源的处理有几个特点：</p>
<ul>
<li>阻塞浏览器的解析，也就是说发现一个外链脚本时，需等待脚本下载完成并执行后才会继续解析 <code>HTML</code></li>
<li>当解析器遇到一个脚本标签而 <code>CSSOM</code> 还没有准备好时，会发生什么情况呢？答案很简单。<code>Javascript</code> 执行将会停止，直到 <code>CSSOM</code> 就绪。</li>
<li>浏览器的优化在脚本阻塞时，也会继续下载其它资源（当然有并发上限），但是虽然脚本可以并行下载，解析过程仍然是阻塞的，也就是说必须这个脚本执行完毕后才会接下来的解析，并行下载只是一种优化而已</li>
<li><code>defer</code>与<code>async</code>，普通的脚本是会阻塞浏览器解析的，但是可以加上<code>defer</code>或<code>async</code>属性，这样脚本就变成异步了，可以等到解析完毕后再执行</li>
</ul>
<p>注意，<code>defer</code>和<code>async</code>是有区别的： <strong>defer 是延迟执行，而 async 是异步执行。</strong></p>
<p>简单的说：</p>
<ul>
<li><code>async</code>是异步执行，异步下载完毕后就会执行，不确保执行顺序，一定在<code>onload</code>前，但不确定在<code>DOMContentLoaded</code>事件的前或后</li>
<li><code>defer</code>是延迟执行，在浏览器看起来的效果像是将脚本放在了 body 后面一样（虽然按规范应该是在<code>DOMContentLoaded</code>事件前，但实际上不同浏览器的优化效果不一样，也有可能在它后面）</li>
</ul>
<h4 id="遇到-img-图片类资源"><a href="#遇到-img-图片类资源" class="headerlink" title="遇到 img 图片类资源"></a>遇到 img 图片类资源</h4><p>遇到图片等资源时，直接就是异步下载，不会阻塞解析，下载完毕后直接用图片替换原有 src 的地方</p>
<h3 id="loaded-和-domcontentloaded"><a href="#loaded-和-domcontentloaded" class="headerlink" title="loaded 和 domcontentloaded"></a>loaded 和 domcontentloaded</h3><p>简单的对比：</p>
<ul>
<li><code>DOMContentLoaded</code> 事件触发时，仅当<code>DOM加载</code>完成，不包括样式表，图片(譬如如果有 async 加载的脚本就不一定完成)</li>
<li><code>load</code> 事件触发时，页面上所有的 DOM，样式表，脚本，图片都已经加载完成了</li>
</ul>
<h2 id="CSS-的可视化格式模型"><a href="#CSS-的可视化格式模型" class="headerlink" title="CSS 的可视化格式模型"></a>CSS 的可视化格式模型</h2><p>前面提到了整体的渲染概念，但实际上文档树中的元素是按什么渲染规则渲染的，是可以进一步展开的</p>
<p>先了解：</p>
<ul>
<li>CSS 中规定每一个元素都有自己的盒子模型（相当于规定了这个元素如何显示）</li>
<li>然后可视化格式模型则是把这些盒子按照规则摆放到页面上，也就是如何布局及相互作用</li>
</ul>
<p>说到底： <strong>CSS 的可视化格式模型就是规定了浏览器在页面中如何处理文档树</strong></p>
<p>关键字：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">包含块（Containing Block）</span><br><span class="line">控制框（Controlling Box）</span><br><span class="line">盒模型</span><br><span class="line">BFC（Block Formatting Context）</span><br><span class="line">IFC（Inline Formatting Context）</span><br><span class="line">定位体系</span><br><span class="line">浮动等</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>另外，CSS 有三种定位机制：<code>普通流</code>，<code>浮动</code>，<code>绝对定位</code>，如无特别提及，下文中都是针对普通流中的</p>
<h3 id="包含块（Containing-Block）"><a href="#包含块（Containing-Block）" class="headerlink" title="包含块（Containing Block）"></a>包含块（Containing Block）</h3><p>一个元素的<code>box</code>的定位和尺寸，会与某一矩形框有关，这个框就称之为<code>包含块</code>。</p>
<p>元素会为它的子孙元素创建<code>包含块</code>，但是，并不是说元素的包含块就是它的父元素，元素的包含块与它的祖先元素的样式等有关系。</p>
<p>譬如：</p>
<ul>
<li>根元素是最顶端的元素，它没有父节点，它的包含块就是<code>初始包含块</code></li>
<li><code>static</code>和<code>relative</code>的包含块由它最近的<code>块级</code>、<code>单元格</code>或者<code>行内块祖先元素</code>的内容框（<code>content</code>）创建</li>
<li><code>fixed</code>的包含块是当前可视窗口</li>
<li><code>absolute的</code>包含块由它最近的<code>position</code>属性为<code>absolute</code>、<code>relative</code>或者<code>fixed</code>的祖先元素创建<ul>
<li>如果其祖先元素是行内元素，则包含块取决于其祖先元素的<code>direction</code>特性</li>
<li>如果祖先元素不是行内元素，那么包含块的区域应该是祖先元素的内边距边界</li>
</ul>
</li>
</ul>
<h3 id="控制框（Controlling-Box）"><a href="#控制框（Controlling-Box）" class="headerlink" title="控制框（Controlling Box）"></a>控制框（Controlling Box）</h3><p>块级元素和块框以及行内元素和行框的相关概念</p>
<h4 id="块框"><a href="#块框" class="headerlink" title="块框"></a>块框</h4><ul>
<li>块级元素会生成一个块框（<code>Block Box</code>），块框会占据一整行，用来包含子 box 和生成的内容</li>
<li>块框同时也是一个块包含框（<code>Containing Box</code>），里面要么只包含块框，要么只包含行内框（不能混杂），如果块框内部有块级元素也有行内元素，那么行内元素会被匿名块框包围</li>
</ul>
<p>关于<strong>匿名块框</strong>的生成，示例：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  Some text</span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>More text<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>div</code>生成了一个块框，包含了另一个块框<code>p</code>以及文本内容<code>Some text</code>，此时<code>Some text</code>文本会被强制加到一个匿名的块框里面，被<code>div</code>生成的块框包含（其实这个就是 IFC 中提到的行框，包含这些行内框的这一行匿名块形成的框，行框和行内框不同）</p>
<p>换句话说:<br><strong>如果一个块框在其中包含另外一个块框，那么我们强迫它只能包含块框，因此其它文本内容生成出来的都是匿名块框（而不是匿名行内框）</strong></p>
<h4 id="行内框"><a href="#行内框" class="headerlink" title="行内框"></a>行内框</h4><ul>
<li>一个行内元素生成一个行内框</li>
<li>行内元素能排在一行，允许左右有其它元素</li>
</ul>
<p>关于匿名行内框的生成，示例：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Some <span class="tag">&lt;<span class="name">em</span>&gt;</span>emphasized<span class="tag">&lt;/<span class="name">em</span>&gt;</span> text<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>P 元素生成一个块框，其中有几个行内框（如 EM），以及文本 Some ， text，此时会专门为这些文本生成匿名行内框</p>
<h4 id="display-属性的影响"><a href="#display-属性的影响" class="headerlink" title="display 属性的影响"></a>display 属性的影响</h4><p>display 的几个属性也可以影响不同框的生成：</p>
<ul>
<li>block，元素生成一个<code>块框</code></li>
<li>inline，元素产生一个或多个的<code>行内框</code></li>
<li>inline-block，元素产生一个行<code>内级块框</code>，行内块框的内部会被当作块块来格式化，而此元素本身会被当作行内级框来格式化（这也是为什么会产生 BFC）</li>
<li>none，不生成框，不再格式化结构中，当然了，另一个 visibility: hidden 则会产生一个不可见的框</li>
</ul>
<p>总结：</p>
<ul>
<li>如果一个框里，有一个块级元素，那么这个框里的内容都会被当作<code>块框</code>来进行格式化，因为只要出现了块级元素，就会将里面的内容分块几块，每一块独占一行（出现行内可以用匿名块框解决）</li>
<li>如果一个框里，没有任何块级元素，那么这个框里的内容会被当成<code>行内框</code>来格式化，因为里面的内容是按照顺序成行的排列</li>
</ul>
<h3 id="盒模型"><a href="#盒模型" class="headerlink" title="盒模型"></a>盒模型</h3><p><code>CSS</code>盒模型本质上是一个盒子，封装周围的<code>HTML</code>元素，它包括：外边距（<code>margin</code>）、边框（b<code>order</code>）、内边距（<code>padding</code>）、实际内容（<code>content</code>）四个属性。</p>
<h4 id="标准盒子模型"><a href="#标准盒子模型" class="headerlink" title="标准盒子模型"></a>标准盒子模型</h4><p><img src="http://cdn.flqin.com/p336-19.jpg" alt="标准盒子模型"></p>
<p><code>padding</code>和<code>border</code>不被包含在定义的<code>width</code>和<code>height</code>之内。对象的实际宽度等于设置的<code>width</code>值和<code>border</code>、<code>padding</code>之和，即 <code>Element width = width + border + padding</code></p>
<h4 id="IE-盒子模型-怪异盒模型"><a href="#IE-盒子模型-怪异盒模型" class="headerlink" title="IE 盒子模型(怪异盒模型)"></a>IE 盒子模型(怪异盒模型)</h4><p><img src="http://cdn.flqin.com/p336-20.jpg" alt="IE盒子模型"></p>
<p><code>padding</code>和<code>border</code>被包含在定义的<code>width</code>和<code>height</code>之内。对象的实际宽度就等于设置的<code>width</code>值，即使定义有<code>border</code>和<code>padding</code>也不会改变对象的实际宽度，即 <code>Element width = width</code></p>
<h4 id="box-sizing"><a href="#box-sizing" class="headerlink" title="box-sizing"></a>box-sizing</h4><p><code>box-sizing</code> 用于指定盒子模型种类</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">box-sizing</span>: <span class="selector-tag">content-box</span>; <span class="comment">/*默认值，对应标准盒子模型  */</span></span><br><span class="line"><span class="selector-tag">box-sizing</span>: <span class="selector-tag">border-box</span>; <span class="comment">/* 对应IE盒子模型 */</span></span><br><span class="line"><span class="selector-tag">box-sizing</span>: <span class="selector-tag">inherit</span>; <span class="comment">/* 规定应从父元素继承 box-sizing 属性 */</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="BFC-amp-IFC"><a href="#BFC-amp-IFC" class="headerlink" title="BFC &amp; IFC"></a>BFC &amp; IFC</h3><p>篇幅太长，详情跳转此处<a href="https://blog.flqin.com/224.html">BFC 等 Formatting Contexts 浅析</a></p>
<h2 id="JS-引擎解析过程"><a href="#JS-引擎解析过程" class="headerlink" title="JS 引擎解析过程"></a>JS 引擎解析过程</h2><p>前面有提到遇到 JS 脚本时，会等到它的执行，实际上是需要引擎解析的，这里展开描述（介绍主干流程）</p>
<h3 id="JS-的解释阶段"><a href="#JS-的解释阶段" class="headerlink" title="JS 的解释阶段"></a>JS 的解释阶段</h3><p>首先得明确： <strong>JS 是解释型语言，所以它无需提前编译，而是由解释器实时运行</strong></p>
<p>引擎对 JS 的处理过程可以简述如下：</p>
<ol>
<li>读取代码，进行词法分析（Lexical analysis），然后将代码分解成词元（token）</li>
<li>对词元进行语法分析（parsing），然后将代码整理成语法树（syntax tree）</li>
<li>使用翻译器（translator），将代码转为字节码（bytecode）</li>
<li>使用字节码解释器（bytecode interpreter），将字节码转为机器码</li>
</ol>
<p>最终计算机执行的就是<code>机器码</code>。</p>
<p>为了提高运行速度，现代浏览器一般采用即时编译（JIT-Just In Time compiler），即字节码只在运行时编译，用到哪一行就编译哪一行，并且把编译结果缓存（inline cache），这样整个程序的运行速度能得到显著提升。而且，不同浏览器策略可能还不同，有的浏览器就省略了字节码的翻译步骤，直接转为机器码（如 chrome 的 v8）</p>
<p>总结起来可以认为是： <strong>核心的<code>JIT</code>编译器将源码编译成机器码运行。</strong></p>
<h3 id="JS-的预处理阶段"><a href="#JS-的预处理阶段" class="headerlink" title="JS 的预处理阶段"></a>JS 的预处理阶段</h3><p>上述将的是解释器的整体过程，这里再提下在正式执行 JS 前，还会有一个<code>预处理阶段</code> （譬如变量提升，分号补全等）</p>
<p><code>预处理阶段</code>会做一些事情，确保 JS 可以正确执行，这里仅提部分：</p>
<h4 id="分号补全"><a href="#分号补全" class="headerlink" title="分号补全"></a>分号补全</h4><p>JS 执行是需要分号的，但为什么以下语句却可以正常运行呢？</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>原因就是 JS 解释器有一个<code>Semicolon Insertion</code>规则，它会按照一定规则，在适当的位置补充分号</p>
<p>譬如列举几条自动加分号的规则：</p>
<ul>
<li>当有换行符（包括含有换行符的多行注释），并且下一个 token 没法跟前面的语法匹配时，会自动补分号。</li>
<li>当有}时，如果缺少分号，会补分号。</li>
<li>程序源代码结束时，如果缺少分号，会补分号。</li>
</ul>
<p>于是，上述的代码就变成了</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>所以可以正常运行。</p>
<p>当然了，这里有一个经典的例子：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">  {</span><br><span class="line">    a: <span class="string">'a'</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>由于分号补全机制，所以它变成了：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">  {</span><br><span class="line">    a: <span class="string">'a'</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>所以运行后是<code>undefined</code></p>
<h4 id="变量提升"><a href="#变量提升" class="headerlink" title="变量提升"></a>变量提升</h4><p>一般包括<code>函数提升</code>和<code>变量提升</code></p>
<p>譬如：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span>;</span><br><span class="line">b();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> a;</span><br></pre></td></tr></tbody></table></figure>

<p>经过变量提升后，就变成：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> a;</span><br><span class="line">a = <span class="number">1</span>;</span><br><span class="line">b();</span><br></pre></td></tr></tbody></table></figure>

<p>这里没有展开，其实展开也可以牵涉到很多内容的，譬如可以提下变量声明，<a href="https://goddyzhao.tumblr.com/post/11273713920/functions" target="_blank" rel="noopener">函数声明</a>，形参，实参的优先级顺序，以及 es6 中 let 有关的<a href="https://blog.flqin.com/349.html">临时死区</a>等.</p>
<h3 id="JS-的执行阶段"><a href="#JS-的执行阶段" class="headerlink" title="JS 的执行阶段"></a>JS 的执行阶段</h3><p>相关概念中文文档<a href="https://goddyzhao.tumblr.com/JavaScript-Internal" target="_blank" rel="noopener">翻译查阅</a></p>
<p>解释器解释完语法规则后，就开始执行，然后整个执行流程中大致包含以下概念：</p>
<ul>
<li>执行上下文，执行堆栈概念（如全局上下文，当前活动上下文）</li>
<li>VO（变量对象）和 AO（活动对象）</li>
<li>作用域链</li>
<li>this 机制等</li>
</ul>
<p>这些概念如果深入讲解的话内容过多，因此这里仅提及部分特性</p>
<h4 id="执行上下文简单解释"><a href="#执行上下文简单解释" class="headerlink" title="执行上下文简单解释"></a>执行上下文简单解释</h4><ul>
<li>JS 有<code>执行上下文</code></li>
<li>浏览器首次载入脚本，它将创建<code>全局执行上下文</code>，并压入<code>执行栈</code>栈顶（不可被弹出）</li>
<li>然后每进入其它作用域就创建对应的执行上下文并把它压入执行栈的<code>顶部</code></li>
<li>一旦对应的上下文执行完毕，就从栈顶弹出，并将上下文控制权交给当前的栈</li>
<li>这样依次执行（最终都会回到全局执行上下文）</li>
</ul>
<p>譬如，如果程序执行完毕，被弹出执行栈，然后有没有被引用（没有形成闭包），那么这个函数中用到的内存就会被垃圾处理器自动回收</p>
<p><img src="http://cdn.flqin.com/p336-15.png" alt="执行上下文"></p>
<p>然后执行上下文与 VO，作用域链，this 的关系是：</p>
<p>每一个执行上下文，都有三个重要属性：</p>
<ul>
<li>变量对象(<code>Variable object</code>-<code>VO</code>)</li>
<li>作用域链(<code>Scope chain</code>)</li>
<li><code>this</code></li>
</ul>
<p><img src="http://cdn.flqin.com/p336-21.png" alt="execution context"></p>
<h4 id="VO-与-AO"><a href="#VO-与-AO" class="headerlink" title="VO 与 AO"></a>VO 与 AO</h4><p><code>VO</code>是执行上下文的属性（抽象概念），但是<strong>只有全局上下文的变量对象允许通过<code>VO</code>的属性名称来间接访问（因为在全局上下文里，全局对象自身就是变量对象）</strong></p>
<p><code>AO（activation object)</code> 活动对象，当函数被调用者激活，<code>AO</code>就被创建了</p>
<p>可以理解为：</p>
<ul>
<li>在函数上下文中：<code>VO === AO</code></li>
<li>在全局上下文中：<code>VO === this === global</code></li>
</ul>
<p>总的来说，<code>VO</code>中会存放一些变量信息（如声明的变量，函数，arguments 参数等等）</p>
<h4 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a>作用域链</h4><p>它是执行上下文中的一个属性，原理和原型链很相似，作用很重要。</p>
<p>譬如流程简述：</p>
<ul>
<li>在函数上下文中，查找一个变量<code>foo</code></li>
<li>如果函数的<code>VO</code>中找到了，就直接使用</li>
<li>否则去它的父级作用域链中（<strong>parent</strong>）找</li>
<li>如果父级中没找到，继续往上找</li>
<li>直到全局上下文中也没找到就报错</li>
</ul>
<h4 id="this-指针"><a href="#this-指针" class="headerlink" title="this 指针"></a>this 指针</h4><p>这也是 JS 的核心知识之一，由于内容过多，这里就不展开，仅提及部分,更多<a href="https://blog.flqin.com/240.html">this 介绍查询</a></p>
<p>注意：<strong>this 是执行上下文环境的一个属性，而不是某个变量对象的属性</strong></p>
<p>因此:</p>
<ul>
<li><code>this</code>是没有一个类似搜寻变量的过程</li>
<li>当代码中使用了<code>this</code>，这个 <code>this</code>的值就直接从执行的上下文中获取了，而不会从作用域链中搜寻</li>
<li><code>this</code>的值只取决中进入上下文时的情况</li>
</ul>
<p>所以经典的例子：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> baz = <span class="number">200</span>;</span><br><span class="line"><span class="keyword">var</span> bar = {</span><br><span class="line">  baz: <span class="number">100</span>,</span><br><span class="line">  foo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.baz);</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line"><span class="keyword">var</span> foo = bar.foo;</span><br><span class="line"><span class="comment">// 进入环境：global</span></span><br><span class="line">foo(); <span class="comment">// 200，严格模式中会报错，Cannot read property 'baz' of undefined</span></span><br><span class="line"><span class="comment">// 进入环境：global bar</span></span><br><span class="line">bar.foo(); <span class="comment">// 100</span></span><br></pre></td></tr></tbody></table></figure>

<p>就要明白了上面<code>this</code>的介绍，上述例子很好理解.</p>
<h3 id="回收机制"><a href="#回收机制" class="headerlink" title="回收机制"></a>回收机制</h3><p>JS 有垃圾处理器，所以无需手动回收内存，而是由垃圾处理器自动处理。</p>
<p>一般来说，垃圾处理器有自己的回收策略。譬如对于那些执行完毕的函数，如果没有<code>外部引用</code>（被引用的话会形成闭包），则会回收。（当然一般会把回收动作切割到不同的时间段执行，防止影响性能）</p>
<p>常用的两种垃圾回收规则是：</p>
<ul>
<li>标记清除</li>
<li>引用计数</li>
</ul>
<p><code>Javascript</code>引擎基础<code>GC</code>方案是（simple GC）：<code>mark and sweep（标记清除）</code>，简单解释如下：</p>
<ul>
<li>遍历所有可访问的对象。</li>
<li>回收已不可访问的对象。</li>
</ul>
<p>譬如：（出自 javascript 高程）</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">当变量进入环境时，例如，在函数中声明一个变量，就将这个变量标记为“进入环境”。</span><br><span class="line">从逻辑上讲，永远不能释放进入环境的变量所占用的内存，因为只要执行流进入相应的环境，就可能会用到它们。</span><br><span class="line">而当变量离开环境时，则将其标记为“离开环境”。</span><br><span class="line">垃圾回收器在运行的时候会给存储在内存中的所有变量都加上标记（当然，可以使用任何标记方式）。</span><br><span class="line">然后，它会去掉环境中的变量以及被环境中的变量引用的变量的标记（闭包，也就是说在环境中的以及相关引用的变量会被去除标记）。</span><br><span class="line">而在此之后再被加上标记的变量将被视为准备删除的变量，原因是环境中的变量已经无法访问到这些变量了。</span><br><span class="line">最后，垃圾回收器完成内存清除工作，销毁那些带标记的值并回收它们所占用的内存空间。</span><br></pre></td></tr></tbody></table></figure>

<p>关于引用计数，简单点理解：<strong>跟踪记录每个值被引用的次数，当一个值被引用时，次数+1，减持时-1，下次垃圾回收器会回收次数为 0 的值的内存（当然了，容易出循环引用的 bug）</strong></p>
<h4 id="GC-的缺陷"><a href="#GC-的缺陷" class="headerlink" title="GC 的缺陷"></a>GC 的缺陷</h4><p>和其他语言一样，javascript 的<code>GC策略</code>也无法避免一个问题： <strong>GC 时，停止响应其他操作</strong>，这是为了安全考虑。而 Javascript 的<code>GC</code>在 100ms 甚至以上。</p>
<p>对一般的应用还好，但对于 JS 游戏，动画对连贯性要求比较高的应用，就麻烦了。这就是引擎需要优化的点： <strong>避免 GC 造成的长时间停止响应。</strong></p>
<h4 id="GC-优化策略"><a href="#GC-优化策略" class="headerlink" title="GC 优化策略"></a>GC 优化策略</h4><p>这里介绍常用到的：<strong>分代回收（Generation GC）</strong></p>
<p>目的是通过区分“临时”与“持久”对象:</p>
<ul>
<li>多回收“临时对象”区（<code>young generation</code>）</li>
<li>少回收“持久对象”区（<code>tenured generation</code>）</li>
<li>减少每次需遍历的对象，从而减少每次 GC 的耗时。</li>
</ul>
<p>像 node v8 引擎就是采用的分代回收。</p>
<p>更多 JavaScript 垃圾回收<a href="https://blog.flqin.com/259.html">查阅</a></p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="可以提到跨域"><a href="#可以提到跨域" class="headerlink" title="可以提到跨域"></a>可以提到跨域</h3><p>譬如发出网络请求时，会用 AJAX，如果接口跨域，就会遇到跨域问题</p>
<p>可以参考：</p>
<p><a href="https://segmentfault.com/a/1190000012469713" target="_blank" rel="noopener">ajax 跨域，这应该是最全的解决方案了</a></p>
<h3 id="可以提到-web-安全"><a href="#可以提到-web-安全" class="headerlink" title="可以提到 web 安全"></a>可以提到 web 安全</h3><p>譬如浏览器在解析 HTML 时，有 XSSAuditor，可以延伸到 web 安全相关领域</p>
<p>可以参考：</p>
<p><a href="https://segmentfault.com/a/1190000012693772" target="_blank" rel="noopener">AJAX 请求真的不安全么？谈谈 Web 安全与 AJAX 的关系。</a></p>
<h3 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h3><ul>
<li>如可以提到 viewport 概念，讲讲物理像素，逻辑像素，CSS 像素等概念<a href="https://blog.flqin.com/218.html">查阅</a></li>
<li>如熟悉 Hybrid 开发的话可以提及一下 Hybrid 相关内容以及优化。</li>
</ul>

      
    </div>

    

    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">---- 本文结束，感谢您的阅读 ----</div>
    
</div>

      
    </div>
    

    
      
    
    
      <div>
        <div id="reward-container">
  <div></div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.png" alt="Korey 微信支付">
        <p>微信支付</p>
      </div>
    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/333.html" rel="next" title="（转载）深入理解“连等赋值”问题">
                <i class="fa fa-chevron-left"></i> （转载）深入理解“连等赋值”问题
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/340.html" rel="prev" title="（转载）cookie浅析">
                （转载）cookie浅析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Korey">
            
              <p class="site-author-name" itemprop="name">Korey</p>
              <div class="site-description motion-element" itemprop="description">热衷于记录、分享前端开发技术</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">94</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/zhaoky" title="GitHub → https://github.com/zhaoky" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:keyu.zhao@foxmail.com" title="E-Mail → mailto:keyu.zhao@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://juejin.im/user/57c91b3b165abd0068db89c2" title="掘金 → https://juejin.im/user/57c91b3b165abd0068db89c2" rel="noopener" target="_blank"><i class="fa fa-fw fa-chain-broken"></i>掘金</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://www.zhihu.com/people/fe_korey" title="知乎 → http://www.zhihu.com/people/fe_korey" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>知乎</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#大纲"><span class="nav-number">1.</span> <span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对知识体系进行一次预评级"><span class="nav-number">2.</span> <span class="nav-text">对知识体系进行一次预评级</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#level1"><span class="nav-number">2.1.</span> <span class="nav-text">level1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level2"><span class="nav-number">2.2.</span> <span class="nav-text">level2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level3"><span class="nav-number">2.3.</span> <span class="nav-text">level3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level4"><span class="nav-number">2.4.</span> <span class="nav-text">level4</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么说知识体系如此重要"><span class="nav-number">3.</span> <span class="nav-text">为什么说知识体系如此重要</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前端向知识的重点"><span class="nav-number">3.1.</span> <span class="nav-text">前端向知识的重点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#梳理主干流程"><span class="nav-number">4.</span> <span class="nav-text">梳理主干流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从浏览器接收-url-到开启网络请求线程"><span class="nav-number">5.</span> <span class="nav-text">从浏览器接收 url 到开启网络请求线程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#多进程的浏览器"><span class="nav-number">5.1.</span> <span class="nav-text">多进程的浏览器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多线程的浏览器内核"><span class="nav-number">5.2.</span> <span class="nav-text">多线程的浏览器内核</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解析-URL"><span class="nav-number">5.3.</span> <span class="nav-text">解析 URL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络请求都是单独的线程"><span class="nav-number">5.4.</span> <span class="nav-text">网络请求都是单独的线程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开启网络线程到发出一个完整的-http-请求"><span class="nav-number">6.</span> <span class="nav-text">开启网络线程到发出一个完整的 http 请求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS-查询得到-IP"><span class="nav-number">6.1.</span> <span class="nav-text">DNS 查询得到 IP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tcp-ip-请求"><span class="nav-number">6.2.</span> <span class="nav-text">tcp/ip 请求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP-与-TCP-IP-区别"><span class="nav-number">6.2.1.</span> <span class="nav-text">HTTP 与 TCP/IP 区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#名词解释"><span class="nav-number">6.2.2.</span> <span class="nav-text">名词解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三次握手的步骤"><span class="nav-number">6.2.3.</span> <span class="nav-text">三次握手的步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#四次挥手的步骤"><span class="nav-number">6.2.4.</span> <span class="nav-text">四次挥手的步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tcp-ip-的并发限制"><span class="nav-number">6.2.5.</span> <span class="nav-text">tcp/ip 的并发限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-和-post-的区别"><span class="nav-number">6.2.6.</span> <span class="nav-text">get 和 post 的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP-UDP-的区别"><span class="nav-number">6.2.7.</span> <span class="nav-text">TCP/UDP 的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP-可靠性的六大手段"><span class="nav-number">6.2.8.</span> <span class="nav-text">TCP 可靠性的六大手段</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#七层因特网协议栈（ISO）"><span class="nav-number">6.3.</span> <span class="nav-text">七层因特网协议栈（ISO）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从服务器接收到请求到对应后台接收到请求"><span class="nav-number">7.</span> <span class="nav-text">从服务器接收到请求到对应后台接收到请求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#负载均衡"><span class="nav-number">7.1.</span> <span class="nav-text">负载均衡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后台的处理"><span class="nav-number">7.2.</span> <span class="nav-text">后台的处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#后台和前台的-http-交互"><span class="nav-number">8.</span> <span class="nav-text">后台和前台的 http 交互</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#http-特性"><span class="nav-number">8.1.</span> <span class="nav-text">http 特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http-工作流程"><span class="nav-number">8.2.</span> <span class="nav-text">http 工作流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http-报文结构"><span class="nav-number">8.3.</span> <span class="nav-text">http 报文结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#通用头部"><span class="nav-number">8.3.1.</span> <span class="nav-text">通用头部</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#请求-响应头部"><span class="nav-number">8.3.2.</span> <span class="nav-text">请求/响应头部</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#请求-响应实体"><span class="nav-number">8.3.3.</span> <span class="nav-text">请求/响应实体</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CRLF"><span class="nav-number">8.3.4.</span> <span class="nav-text">CRLF</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cookie-以及优化"><span class="nav-number">8.4.</span> <span class="nav-text">cookie 以及优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gzip-压缩"><span class="nav-number">8.5.</span> <span class="nav-text">gzip 压缩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#长连接与短连接"><span class="nav-number">8.6.</span> <span class="nav-text">长连接与短连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http-1-1-性能瓶颈"><span class="nav-number">8.7.</span> <span class="nav-text">http 1.1 性能瓶颈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http-2-0"><span class="nav-number">8.8.</span> <span class="nav-text">http 2.0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#https"><span class="nav-number">8.9.</span> <span class="nav-text">https</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#https-原理"><span class="nav-number">8.9.1.</span> <span class="nav-text">https 原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#https-加密是在传输层"><span class="nav-number">8.9.2.</span> <span class="nav-text">https 加密是在传输层</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加密算法，信息摘要，数字签名，数字证书，CA"><span class="nav-number">8.9.3.</span> <span class="nav-text">加密算法，信息摘要，数字签名，数字证书，CA</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTPS-和-HTTP-的区别"><span class="nav-number">8.10.</span> <span class="nav-text">HTTPS 和 HTTP 的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单独拎出来的缓存问题，http-的缓存"><span class="nav-number">9.</span> <span class="nav-text">单独拎出来的缓存问题，http 的缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#强缓存与弱缓存"><span class="nav-number">9.1.</span> <span class="nav-text">强缓存与弱缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存头部简述"><span class="nav-number">9.2.</span> <span class="nav-text">缓存头部简述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#头部的区别"><span class="nav-number">9.3.</span> <span class="nav-text">头部的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http1-0-中的缓存控制"><span class="nav-number">9.4.</span> <span class="nav-text">http1.0 中的缓存控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http1-1-中的缓存控制"><span class="nav-number">9.5.</span> <span class="nav-text">http1.1 中的缓存控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Max-Age-相比-Expires"><span class="nav-number">9.6.</span> <span class="nav-text">Max-Age 相比 Expires</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#E-tag-相比-Last-Modified"><span class="nav-number">9.7.</span> <span class="nav-text">E-tag 相比 Last-Modified</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解析页面流程"><span class="nav-number">10.</span> <span class="nav-text">解析页面流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#流程简述"><span class="nav-number">10.1.</span> <span class="nav-text">流程简述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTML-解析，构建-DOM-树"><span class="nav-number">10.2.</span> <span class="nav-text">HTML 解析，构建 DOM 树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成-CSS-规则树"><span class="nav-number">10.3.</span> <span class="nav-text">生成 CSS 规则树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构建渲染树"><span class="nav-number">10.4.</span> <span class="nav-text">构建渲染树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#渲染"><span class="nav-number">10.5.</span> <span class="nav-text">渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#了解层"><span class="nav-number">10.6.</span> <span class="nav-text">了解层</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#什么是-composite"><span class="nav-number">10.6.1.</span> <span class="nav-text">什么是 composite</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RenderLayers-与-GraphicsLayers"><span class="nav-number">10.6.2.</span> <span class="nav-text">RenderLayers 与 GraphicsLayers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#影响-composite-因素"><span class="nav-number">10.6.3.</span> <span class="nav-text">影响 composite 因素</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#复合图层的优劣"><span class="nav-number">10.6.4.</span> <span class="nav-text">复合图层的优劣</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chrome-中的调试"><span class="nav-number">10.7.</span> <span class="nav-text">Chrome 中的调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#资源外链的下载"><span class="nav-number">10.8.</span> <span class="nav-text">资源外链的下载</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#遇到外链时的处理"><span class="nav-number">10.8.1.</span> <span class="nav-text">遇到外链时的处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#遇到-CSS-样式资源"><span class="nav-number">10.8.2.</span> <span class="nav-text">遇到 CSS 样式资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#遇到-JS-脚本资源"><span class="nav-number">10.8.3.</span> <span class="nav-text">遇到 JS 脚本资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#遇到-img-图片类资源"><span class="nav-number">10.8.4.</span> <span class="nav-text">遇到 img 图片类资源</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loaded-和-domcontentloaded"><span class="nav-number">10.9.</span> <span class="nav-text">loaded 和 domcontentloaded</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSS-的可视化格式模型"><span class="nav-number">11.</span> <span class="nav-text">CSS 的可视化格式模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#包含块（Containing-Block）"><span class="nav-number">11.1.</span> <span class="nav-text">包含块（Containing Block）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#控制框（Controlling-Box）"><span class="nav-number">11.2.</span> <span class="nav-text">控制框（Controlling Box）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#块框"><span class="nav-number">11.2.1.</span> <span class="nav-text">块框</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#行内框"><span class="nav-number">11.2.2.</span> <span class="nav-text">行内框</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#display-属性的影响"><span class="nav-number">11.2.3.</span> <span class="nav-text">display 属性的影响</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#盒模型"><span class="nav-number">11.3.</span> <span class="nav-text">盒模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#标准盒子模型"><span class="nav-number">11.3.1.</span> <span class="nav-text">标准盒子模型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IE-盒子模型-怪异盒模型"><span class="nav-number">11.3.2.</span> <span class="nav-text">IE 盒子模型(怪异盒模型)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#box-sizing"><span class="nav-number">11.3.3.</span> <span class="nav-text">box-sizing</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BFC-amp-IFC"><span class="nav-number">11.4.</span> <span class="nav-text">BFC &amp; IFC</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JS-引擎解析过程"><span class="nav-number">12.</span> <span class="nav-text">JS 引擎解析过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JS-的解释阶段"><span class="nav-number">12.1.</span> <span class="nav-text">JS 的解释阶段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS-的预处理阶段"><span class="nav-number">12.2.</span> <span class="nav-text">JS 的预处理阶段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#分号补全"><span class="nav-number">12.2.1.</span> <span class="nav-text">分号补全</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#变量提升"><span class="nav-number">12.2.2.</span> <span class="nav-text">变量提升</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS-的执行阶段"><span class="nav-number">12.3.</span> <span class="nav-text">JS 的执行阶段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#执行上下文简单解释"><span class="nav-number">12.3.1.</span> <span class="nav-text">执行上下文简单解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VO-与-AO"><span class="nav-number">12.3.2.</span> <span class="nav-text">VO 与 AO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#作用域链"><span class="nav-number">12.3.3.</span> <span class="nav-text">作用域链</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#this-指针"><span class="nav-number">12.3.4.</span> <span class="nav-text">this 指针</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#回收机制"><span class="nav-number">12.4.</span> <span class="nav-text">回收机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GC-的缺陷"><span class="nav-number">12.4.1.</span> <span class="nav-text">GC 的缺陷</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GC-优化策略"><span class="nav-number">12.4.2.</span> <span class="nav-text">GC 优化策略</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其它"><span class="nav-number">13.</span> <span class="nav-text">其它</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#可以提到跨域"><span class="nav-number">13.1.</span> <span class="nav-text">可以提到跨域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可以提到-web-安全"><span class="nav-number">13.2.</span> <span class="nav-text">可以提到 web 安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更多"><span class="nav-number">13.3.</span> <span class="nav-text">更多</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">© 2015 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Korey zhao</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">542k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">8:13</span>
  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  














  



  
    
    
  
  











  



  
  

  
  

  
  

  
  

  
  


  


  

  



  
  


  

  



  
  




  


  


  
  
  


  

  

  


  


  
  





  

  

  

  

  

  
  


  

  

  

  

  

  

  

  

<script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script>

<script type="text/javascript" src="/bundle.js"></script><script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
;

    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  ;

    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  ;
L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"superSample":2,"width":125,"height":150,"position":"left","hOffset":30,"vOffset":-5},"mobile":{"show":false,"scale":0.05},"react":{"opacityDefault":1,"opacityOnHover":0.2},"log":false});</script></body></html>