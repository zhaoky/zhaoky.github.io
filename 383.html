<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#3eaf7c">




  
  
    
    
  
  















  
  
  







  






  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">


  <link rel="mask-icon" href="/images/apple-touch-icon.png" color="#3eaf7c">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="以 前言及总流程概览 里的 demo 为例， 前七章分析了打包过程，现在来分析它打包后的文件。 demo12345//src/a.jsimport &amp;#123; add &amp;#125; from 'Src/b';import('./c.js').then((m) =&amp;gt; m.sub(2, 1));const a = 1;add(3, 2 + a);  12345678//src/b.jsimpo">
<meta name="keywords" content="前端,前端开发,css,html,js,css3,前端开发博客,fe,技术文档">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack 4 源码主流程分析（十二）：打包后文件解析">
<meta property="og:url" content="https://blog.flqin.com/383.html">
<meta property="og:site_name" content="前端轻语">
<meta property="og:description" content="以 前言及总流程概览 里的 demo 为例， 前七章分析了打包过程，现在来分析它打包后的文件。 demo12345//src/a.jsimport &amp;#123; add &amp;#125; from 'Src/b';import('./c.js').then((m) =&amp;gt; m.sub(2, 1));const a = 1;add(3, 2 + a);  12345678//src/b.jsimpo">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-09-11T10:11:51.069Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="webpack 4 源码主流程分析（十二）：打包后文件解析">
<meta name="twitter:description" content="以 前言及总流程概览 里的 demo 为例， 前七章分析了打包过程，现在来分析它打包后的文件。 demo12345//src/a.jsimport &amp;#123; add &amp;#125; from 'Src/b';import('./c.js').then((m) =&amp;gt; m.sub(2, 1));const a = 1;add(3, 2 + a);  12345678//src/b.jsimpo">





  
  
  <link rel="canonical" href="https://blog.flqin.com/383">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>webpack 4 源码主流程分析（十二）：打包后文件解析 | 前端轻语</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c8dec20f0d0449c8ece3c0dbab4e8f31";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <style>/* normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
html {
  line-height: 1.15; /* 1 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
main {
  display: block;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
hr {
  box-sizing: content-box; /* 1 */
  height: 0; /* 1 */
  overflow: visible; /* 2 */
}
pre {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
a {
  background-color: transparent;
}
abbr[title] {
  border-bottom: none; /* 1 */
  text-decoration: underline; /* 2 */
  text-decoration: underline dotted; /* 2 */
}
b,
strong {
  font-weight: bolder;
}
code,
kbd,
samp {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
button,
input,
optgroup,
select,
textarea {
  font-family: inherit; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}
button,
input {
/* 1 */
  overflow: visible;
}
button,
select {
/* 1 */
  text-transform: none;
}
button,
[type="button"],
[type="reset"],
[type="submit"] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type="button"]::-moz-focus-inner,
[type="reset"]::-moz-focus-inner,
[type="submit"]::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
button:-moz-focusring,
[type="button"]:-moz-focusring,
[type="reset"]:-moz-focusring,
[type="submit"]:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  padding: 0.35em 0.75em 0.625em;
}
legend {
  box-sizing: border-box; /* 1 */
  color: inherit; /* 2 */
  display: table; /* 1 */
  max-width: 100%; /* 1 */
  padding: 0; /* 3 */
  white-space: normal; /* 1 */
}
progress {
  vertical-align: baseline;
}
textarea {
  overflow: auto;
}
[type="checkbox"],
[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
[type="number"]::-webkit-inner-spin-button,
[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  outline-offset: -2px; /* 2 */
}
[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  -webkit-appearance: button; /* 1 */
  font: inherit; /* 2 */
}
details {
  display: block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none;
}
::selection {
  background: #262a30;
  color: #fff;
}
body {
  position: relative;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 14px;
  line-height: 2;
  color: #555;
  background: #f5f7f9;
}
@media (max-width: 991px) {
  body {
    padding-right: 0 !important;
  }
}
@media (min-width: 1200px) {
  body {
    font-size: 16px;
  }
}
h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 20px 0 15px;
  padding: 0;
  font-weight: bold;
  line-height: 1.5;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
}
h1 {
  font-size: 22px;
}
h1 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h1 {
    font-size: 18px;
  }
  h1 code {
    font-size: 1em;
  }
}
h2 {
  font-size: 20px;
}
h2 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h2 {
    font-size: 16px;
  }
  h2 code {
    font-size: 1em;
  }
}
h3 {
  font-size: 18px;
}
h3 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h3 {
    font-size: 14px;
  }
  h3 code {
    font-size: 1em;
  }
}
h4 {
  font-size: 16px;
}
h4 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h4 {
    font-size: 12px;
  }
  h4 code {
    font-size: 1em;
  }
}
h5 {
  font-size: 14px;
}
h5 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h5 {
    font-size: 10px;
  }
  h5 code {
    font-size: 1em;
  }
}
h6 {
  font-size: 12px;
}
h6 code {
  font-size: 1em;
}
@media (max-width: 767px) {
  h6 {
    font-size: 8px;
  }
  h6 code {
    font-size: 1em;
  }
}
p {
  margin: 0 0 20px 0;
}
a,
span.exturl {
  overflow-wrap: break-word;
  word-wrap: break-word;
  background-color: transparent;
  color: #555;
  text-decoration: none;
  outline: none;
  border-bottom: 1px solid #999;
  cursor: pointer;
}
a:hover,
span.exturl:hover {
  color: #3eaf7c;
  border-bottom-color: #3eaf7c;
}
video {
  max-width: 100%;
  display: block;
  margin-left: auto;
  margin-right: auto;
}
img {
  display: block;
  margin: auto;
  max-width: 100%;
  height: auto;
}
hr {
  margin: 40px 0;
  height: 3px;
  border: none;
  background-color: #ddd;
  background-image: repeating-linear-gradient(-45deg, #fff, #fff 4px, transparent 4px, transparent 8px);
}
blockquote {
  margin: 0;
  padding: 0 15px;
  color: #666;
  border-left: 4px solid #ddd;
}
blockquote cite::before {
  content: "-";
  padding: 0 5px;
}
dt {
  font-weight: 700;
}
dd {
  margin: 0;
  padding: 0;
}
kbd {
  border: 1px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  background-color: #f9f9f9;
  font-family: inherit;
  background-image: linear-gradient(top, #eee, #fff, #eee);
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
.text-left {
  text-align: left;
}
.text-center {
  text-align: center;
}
.text-right {
  text-align: right;
}
.text-justify {
  text-align: justify;
}
.text-nowrap {
  white-space: nowrap;
}
.text-lowercase {
  text-transform: lowercase;
}
.text-uppercase {
  text-transform: uppercase;
}
.text-capitalize {
  text-transform: capitalize;
}
.center-block {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
.clearfix:before,
.clearfix:after {
  content: " ";
  display: table;
}
.clearfix:after {
  clear: both;
}
.pullquote {
  width: 45%;
}
.pullquote.left {
  float: left;
  margin-left: 5px;
  margin-right: 10px;
}
.pullquote.right {
  float: right;
  margin-left: 10px;
  margin-right: 5px;
}
.affix {
  position: fixed;
}
.translation {
  margin-top: -20px;
  font-size: 14px;
  color: #999;
}
.scrollbar-measure {
  width: 100px;
  height: 100px;
  overflow: scroll;
  position: absolute;
  top: -9999px;
}
.use-motion .motion-element {
  opacity: 0;
}
.table-container {
  margin: 20px 0;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}
.highlight .table-container {
  margin: 0px;
}
table {
  width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  font-size: 14px;
}
table > tbody > tr:nth-of-type(odd) {
  background-color: #f9f9f9;
}
table > tbody > tr:hover {
  background-color: #f5f5f5;
}
caption,
th,
td {
  padding: 8px;
  text-align: left;
  vertical-align: middle;
  font-weight: normal;
}
th,
td {
  border: 1px solid #ddd;
  border-bottom: 3px solid #ddd;
}
th {
  padding-bottom: 10px;
  font-weight: 700;
}
td {
  border-bottom-width: 1px;
}
html,
body {
  height: 100%;
}
.container {
  position: relative;
}
.header-inner {
  margin: 0 auto;
  padding: 100px 0 70px;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .container .header-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .container .header-inner {
    width: 73%;
  }
}
.main-inner {
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .container .main-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .container .main-inner {
    width: 73%;
  }
}
.footer {
  padding: 20px 0;
}
.footer-inner {
  box-sizing: border-box;
  margin: 0px auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .container .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .container .footer-inner {
    width: 73%;
  }
}
pre,
.highlight {
  overflow: auto;
  margin: 20px 0;
  padding: 0;
  font-size: 14px;
  color: #4d4d4c;
  background: #f7f7f7;
  line-height: 1.6;
}
pre,
code {
  font-family: consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace;
}
code {
  overflow-wrap: break-word;
  word-wrap: break-word;
  padding: 2px 4px;
  color: #555;
  background: #eee;
  border-radius: 3px;
  font-size: 14px;
}
pre {
  padding: 10px;
}
pre code {
  padding: 0;
  color: #4d4d4c;
  background: none;
  text-shadow: none;
}
.highlight {
  border-radius: 1px;
}
.highlight pre {
  border: none;
  margin: 0;
  padding: 10px 0;
}
.highlight table {
  margin: 0;
  width: auto;
  border: none;
}
.highlight td {
  border: none;
  padding: 0;
}
.highlight figcaption {
  font-size: 1em;
  color: #4d4d4c;
  line-height: 1em;
  margin-bottom: 1em;
  margin: 0em;
  padding: 0.5em;
  background: #eee;
  border-bottom: 1px solid #e9e9e9;
}
.highlight figcaption:before,
.highlight figcaption:after {
  content: " ";
  display: table;
}
.highlight figcaption:after {
  clear: both;
}
.highlight figcaption a {
  float: right;
  color: #4d4d4c;
}
.highlight figcaption a:hover {
  border-bottom-color: #4d4d4c;
}
.highlight .gutter pre {
  padding-left: 10px;
  padding-right: 10px;
  color: #869194;
  text-align: right;
  background-color: #eff2f3;
}
.highlight .code pre {
  width: 100%;
  padding-left: 10px;
  padding-right: 10px;
  background-color: #f7f7f7;
}
.highlight .line {
  height: 20px;
}
.gutter {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.gist table {
  width: auto;
}
.gist table td {
  border: none;
}
pre .deletion {
  background: #fdd;
}
pre .addition {
  background: #dfd;
}
pre .meta {
  color: #8959a8;
}
pre .comment {
  color: #8e908c;
}
pre .variable,
pre .attribute,
pre .tag,
pre .name,
pre .regexp,
pre .ruby .constant,
pre .xml .tag .title,
pre .xml .pi,
pre .xml .doctype,
pre .html .doctype,
pre .css .id,
pre .css .class,
pre .css .pseudo {
  color: #c82829;
}
pre .number,
pre .preprocessor,
pre .built_in,
pre .builtin-name,
pre .literal,
pre .params,
pre .constant,
pre .command {
  color: #f5871f;
}
pre .ruby .class .title,
pre .css .rules .attribute,
pre .string,
pre .symbol,
pre .value,
pre .inheritance,
pre .header,
pre .ruby .symbol,
pre .xml .cdata,
pre .special,
pre .formula {
  color: #718c00;
}
pre .title,
pre .css .hexcolor {
  color: #3e999f;
}
pre .function,
pre .python .decorator,
pre .python .title,
pre .ruby .function .title,
pre .ruby .title .keyword,
pre .perl .sub,
pre .javascript .title,
pre .coffeescript .title {
  color: #4271ae;
}
pre .keyword,
pre .javascript .function {
  color: #8959a8;
}
.posts-expand .post-body img.full-image {
  border: none;
}
.blockquote-center,
.page-home .post-type-quote blockquote,
.page-post-detail .post-type-quote blockquote {
  position: relative;
  margin: 40px 0;
  padding: 0;
  border-left: none;
  text-align: center;
}
.blockquote-center::before,
.page-home .post-type-quote blockquote::before,
.page-post-detail .post-type-quote blockquote::before,
.blockquote-center::after,
.page-home .post-type-quote blockquote::after,
.page-post-detail .post-type-quote blockquote::after {
  position: absolute;
  content: ' ';
  display: block;
  width: 100%;
  height: 24px;
  opacity: 0.2;
  background-repeat: no-repeat;
  background-position: 0 -6px;
  background-size: 22px 22px;
}
.blockquote-center::before,
.page-home .post-type-quote blockquote::before,
.page-post-detail .post-type-quote blockquote::before {
  top: -20px;
  background-image: url("../images/quote-l.svg");
  border-top: 1px solid #ccc;
}
.blockquote-center::after,
.page-home .post-type-quote blockquote::after,
.page-post-detail .post-type-quote blockquote::after {
  bottom: -20px;
  background-image: url("../images/quote-r.svg");
  border-bottom: 1px solid #ccc;
  background-position: 100% 8px;
}
.blockquote-center p,
.page-home .post-type-quote blockquote p,
.page-post-detail .post-type-quote blockquote p,
.blockquote-center div,
.page-home .post-type-quote blockquote div,
.page-post-detail .post-type-quote blockquote div {
  text-align: center;
}
.post .post-body .group-picture img {
  box-sizing: border-box;
  padding: 0 3px;
  border: none;
}
.post .group-picture-row {
  overflow: hidden;
  margin-top: 6px;
}
.post .group-picture-row:first-child {
  margin-top: 0;
}
.post .group-picture-column {
  float: left;
}
.page-post-detail .post-body .group-picture-column {
  float: none;
  margin-top: 10px;
  width: auto !important;
}
.page-post-detail .post-body .group-picture-column img {
  margin: 0 auto;
}
.page-archive .group-picture-container {
  overflow: hidden;
}
.page-archive .group-picture-row {
  float: left;
}
.page-archive .group-picture-row:first-child {
  margin-top: 6px;
}
.page-archive .group-picture-column {
  max-width: 150px;
  max-height: 150px;
}
.post-body .label {
  display: inline;
  padding: 0 2px;
}
.post-body .label.default {
  background-color: #f0f0f0;
}
.post-body .label.primary {
  background-color: #efe6f7;
}
.post-body .label.info {
  background-color: #e5f2f8;
}
.post-body .label.success {
  background-color: #e7f4e9;
}
.post-body .label.warning {
  background-color: #fcf6e1;
}
.post-body .label.danger {
  background-color: #fae8eb;
}
.post-body .note {
  position: relative;
  padding: 15px;
  margin-bottom: 20px;
  border: 1px solid #eee;
  border-left-width: 5px;
  border-radius: 3px;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  margin-top: 0;
  margin-bottom: 0;
  border-bottom: initial;
  padding-top: 0 !important;
}
.post-body .note p:first-child,
.post-body .note ul:first-child,
.post-body .note ol:first-child,
.post-body .note table:first-child,
.post-body .note pre:first-child,
.post-body .note blockquote:first-child {
  margin-top: 0;
}
.post-body .note p:last-child,
.post-body .note ul:last-child,
.post-body .note ol:last-child,
.post-body .note table:last-child,
.post-body .note pre:last-child,
.post-body .note blockquote:last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  border-left-color: #777;
}
.post-body .note.default h2,
.post-body .note.default h3,
.post-body .note.default h4,
.post-body .note.default h5,
.post-body .note.default h6 {
  color: #777;
}
.post-body .note.primary {
  border-left-color: #6f42c1;
}
.post-body .note.primary h2,
.post-body .note.primary h3,
.post-body .note.primary h4,
.post-body .note.primary h5,
.post-body .note.primary h6 {
  color: #6f42c1;
}
.post-body .note.info {
  border-left-color: #428bca;
}
.post-body .note.info h2,
.post-body .note.info h3,
.post-body .note.info h4,
.post-body .note.info h5,
.post-body .note.info h6 {
  color: #428bca;
}
.post-body .note.success {
  border-left-color: #5cb85c;
}
.post-body .note.success h2,
.post-body .note.success h3,
.post-body .note.success h4,
.post-body .note.success h5,
.post-body .note.success h6 {
  color: #5cb85c;
}
.post-body .note.warning {
  border-left-color: #f0ad4e;
}
.post-body .note.warning h2,
.post-body .note.warning h3,
.post-body .note.warning h4,
.post-body .note.warning h5,
.post-body .note.warning h6 {
  color: #f0ad4e;
}
.post-body .note.danger {
  border-left-color: #d9534f;
}
.post-body .note.danger h2,
.post-body .note.danger h3,
.post-body .note.danger h4,
.post-body .note.danger h5,
.post-body .note.danger h6 {
  color: #d9534f;
}
.post-body .tabs {
  position: relative;
  display: block;
  margin-bottom: 20px;
  padding-top: 10px;
}
.post-body .tabs ul.nav-tabs {
  margin: 0;
  padding: 0;
  display: flex;
  flex-wrap: wrap;
  margin-bottom: -1px;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab {
  flex-grow: 1;
  list-style-type: none;
  border-top: 3px solid transparent;
  border-right: 1px solid transparent;
  border-bottom: 1px solid #ddd;
  border-left: 1px solid transparent;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab {
    border-top: 1px solid transparent;
    border-right: 1px solid transparent;
    border-bottom: 1px solid transparent;
    border-left: 3px solid transparent;
  }
}
.post-body .tabs ul.nav-tabs li.tab a {
  text-align: center;
  outline: 0;
  border-bottom: initial;
  display: block;
  line-height: 1.8em;
  padding: 0.25em 0.75em;
  transition-duration: 0.2s;
  transition-timing-function: ease-out;
  transition-delay: 0s;
}
.post-body .tabs ul.nav-tabs li.tab a i {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active {
  border-top: 3px solid #fc6423;
  border-right: 1px solid #ddd;
  border-bottom: 1px solid transparent;
  border-left: 1px solid #ddd;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active {
    border-top: 1px solid #ddd;
    border-right: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    border-left: 3px solid #fc6423;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a {
  cursor: default;
  color: #555;
}
.post-body .tabs .tab-content .tab-pane {
  border: 1px solid #ddd;
  padding: 20px 20px 0 20px;
}
.post-body .tabs .tab-content .tab-pane:not(.active) {
  display: none;
}
.post-body .tabs .tab-content .tab-pane.active {
  display: block;
}
.btn {
  display: inline-block;
  padding: 0 20px;
  font-size: 14px;
  color: #555;
  background: #fff;
  border: 2px solid #555;
  text-decoration: none;
  border-radius: 2px;
  transition-property: background-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  line-height: 2;
}
.btn:hover {
  border-color: #3eaf7c;
  color: #fff;
  background: #3eaf7c;
}
.btn +.btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  width: 1.285714285714286em;
  text-align: left;
}
.btn-bar {
  display: block;
  width: 22px;
  height: 2px;
  background: #555;
  border-radius: 1px;
}
.btn-bar+.btn-bar {
  margin-top: 4px;
}
.pagination {
  margin: 120px 0 40px;
  text-align: center;
  border-top: 1px solid #eee;
}
.page-number-basic,
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  position: relative;
  top: -1px;
  margin: 0 10px;
  padding: 0 11px;
}
@media (max-width: 767px) {
  .page-number-basic,
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition-property: border-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: #3eaf7c;
}
.pagination .space {
  padding: 0;
  margin: 0;
}
.pagination .prev {
  margin-left: 0;
}
.pagination .next {
  margin-right: 0;
}
.pagination .page-number.current {
  color: #fff;
  background: #ccc;
  border-top-color: #ccc;
}
@media (max-width: 767px) {
  .pagination {
    border-top: none;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    margin-bottom: 10px;
    border-top: 0;
    border-bottom: 1px solid #eee;
    padding: 0 10px;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: #3eaf7c;
  }
}
.comments {
  margin: 60px 20px 0;
}
.back-to-top {
  box-sizing: border-box;
  position: fixed;
  bottom: -100px;
  right: 30px;
  z-index: 1050;
  padding: 0 6px;
  width: 24px;
  background: #3eaf7c;
  font-size: 12px;
  opacity: 0.6;
  color: #fff;
  cursor: pointer;
  text-align: center;
  transition-property: bottom;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.back-to-top.back-to-top-on {
  bottom: 30px;
}
@media (max-width: 991px) {
  .back-to-top {
    opacity: 0.8;
    right: 20px;
  }
}
.header {
  background: transparent;
}
.header-inner {
  position: relative;
}
.headband {
  height: 3px;
  background: #3eaf7c;
}
.site-meta {
  margin: 0;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.brand {
  position: relative;
  display: inline-block;
  padding: 0 40px;
  color: #fff;
  background: #3eaf7c;
  border-bottom: none;
}
.brand:hover {
  color: #fff;
}
.logo {
  display: inline-block;
  margin-right: 5px;
  line-height: 36px;
  vertical-align: top;
}
.site-title {
  display: inline-block;
  vertical-align: top;
  line-height: 36px;
  font-size: 20px;
  font-weight: normal;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
}
.site-subtitle {
  margin-top: 10px;
  font-size: 13px;
  color: #ddd;
}
.use-motion .brand {
  opacity: 0;
}
.use-motion .logo,
.use-motion .site-title,
.use-motion .site-subtitle,
.use-motion .custom-logo-image {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle {
  display: none;
  position: absolute;
  top: 10px;
  left: 10px;
}
@media (max-width: 767px) {
  .site-nav-toggle {
    display: block;
  }
}
.site-nav-toggle button {
  margin-top: 2px;
  padding: 9px 10px;
  background: transparent;
  border: none;
}
@media (max-width: 767px) {
  .site-nav {
    display: none;
    margin: 0 -10px;
    padding: 0 10px;
    clear: both;
    border-top: 1px solid #ddd;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: block !important;
  }
}
@media (min-width: 992px) {
  .site-nav {
    display: block !important;
  }
}
.menu {
  margin-top: 20px;
  padding-left: 0;
  text-align: center;
}
.menu .menu-item {
  display: inline-block;
  margin: 0 10px;
  list-style: none;
}
@media (max-width: 767px) {
  .menu .menu-item {
    margin-top: 10px;
  }
}
.menu .menu-item a,
.menu .menu-item span.exturl {
  display: block;
  font-size: 13px;
  line-height: inherit;
  border-bottom: 1px solid transparent;
  transition-property: border-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.menu .menu-item a:hover,
.menu .menu-item span.exturl:hover {
  border-bottom-color: #3eaf7c;
}
.menu .menu-item .fa {
  margin-right: 5px;
}
.use-motion .menu-item {
  opacity: 0;
}
.github-corner :hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out;
}
.github-corner > svg {
  fill: #3eaf7c;
  color: #fff;
  position: absolute;
  top: 0;
  border: 0;
  right: 0;
}
@media (max-width: 991px) {
  .github-corner > svg {
    fill: #fff;
    color: #3eaf7c;
  }
  .github-corner .github-corner:hover .octo-arm {
    animation: none;
  }
  .github-corner .github-corner .octo-arm {
    animation: octocat-wave 560ms ease-in-out;
  }
}
@-moz-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@-webkit-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@-o-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
.post-body {
  overflow-wrap: break-word;
  word-wrap: break-word;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
}
.post-body span.exturl .fa {
  font-size: 14px;
  margin-left: 4px;
}
.post-body .fancybox img {
  display: block !important;
  margin: 0 auto;
  cursor: pointer;
  cursor: zoom-in;
}
.post-body .image-caption,
.post-body .figure .caption {
  margin: -20px auto 15px;
  text-align: center;
  font-size: 14px;
  color: #999;
  font-weight: bold;
  line-height: 1;
}
.post-sticky-flag {
  display: inline-block;
  font-size: 16px;
  transform: rotate(30deg);
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  opacity: 0;
}
.use-motion .post-header {
  opacity: 0;
}
.use-motion .post-body {
  opacity: 0;
}
.use-motion .collection-title {
  opacity: 0;
}
.posts-expand {
  padding-top: 40px;
}
@media (max-width: 767px) {
  .posts-expand {
    margin: 0 20px;
  }
  .post-body pre .gutter pre {
    padding-right: 10px;
  }
  .post-body .highlight {
    margin-left: 0px;
    margin-right: 0px;
    padding: 0;
  }
  .post-body .highlight .gutter pre {
    padding-right: 10px;
  }
}
@media (min-width: 992px) {
  .posts-expand .post-body {
    text-align: justify;
  }
}
@media (max-width: 991px) {
  .posts-expand .post-body {
    text-align: justify;
  }
}
.posts-expand .post-body h2,
.posts-expand .post-body h3,
.posts-expand .post-body h4,
.posts-expand .post-body h5,
.posts-expand .post-body h6 {
  padding-top: 10px;
}
.posts-expand .post-body h2 .header-anchor,
.posts-expand .post-body h3 .header-anchor,
.posts-expand .post-body h4 .header-anchor,
.posts-expand .post-body h5 .header-anchor,
.posts-expand .post-body h6 .header-anchor {
  float: right;
  margin-left: 10px;
  color: #ccc;
  border-bottom-style: none;
  visibility: hidden;
}
.posts-expand .post-body h2 .header-anchor:hover,
.posts-expand .post-body h3 .header-anchor:hover,
.posts-expand .post-body h4 .header-anchor:hover,
.posts-expand .post-body h5 .header-anchor:hover,
.posts-expand .post-body h6 .header-anchor:hover {
  color: inherit;
}
.posts-expand .post-body h2:hover .header-anchor,
.posts-expand .post-body h3:hover .header-anchor,
.posts-expand .post-body h4:hover .header-anchor,
.posts-expand .post-body h5:hover .header-anchor,
.posts-expand .post-body h6:hover .header-anchor {
  visibility: visible;
}
.posts-expand .post-body img {
  box-sizing: border-box;
  margin: 0 auto 25px;
  padding: 3px;
  border: 1px solid #ddd;
}
@media (max-width: 767px) {
  .posts-collapse {
    margin: 0 20px;
  }
  .posts-collapse .post-title,
  .posts-collapse .post-meta {
    display: block;
    width: auto;
    text-align: left;
  }
}
.posts-collapse {
  position: relative;
  z-index: 1010;
  margin-left: 55px;
}
.posts-collapse::after {
  content: " ";
  position: absolute;
  top: 20px;
  left: 0;
  margin-left: -2px;
  width: 4px;
  height: 100%;
  background: #f5f5f5;
  z-index: -1;
}
@media (max-width: 767px) {
  .posts-collapse {
    margin: 0 20px;
  }
}
.posts-collapse .collection-title {
  position: relative;
  margin: 60px 0;
}
.posts-collapse .collection-title h1,
.posts-collapse .collection-title h2 {
  margin-left: 20px;
}
.posts-collapse .collection-title small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .collection-title::before {
  content: " ";
  position: absolute;
  left: 0;
  top: 50%;
  margin-left: -4px;
  margin-top: -4px;
  width: 8px;
  height: 8px;
  background: #bbb;
  border-radius: 50%;
}
.posts-collapse .post {
  margin: 10px 0;
}
.posts-collapse h3 {
  margin: 10px 0 15px;
}
.posts-collapse .post-header {
  position: relative;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  transition-property: border;
  border-bottom: 1px dashed #ccc;
}
.posts-collapse .post-header::before {
  content: " ";
  position: absolute;
  left: 0;
  top: 12px;
  width: 6px;
  height: 6px;
  margin-left: -4px;
  background: #bbb;
  border-radius: 50%;
  border: 1px solid #fff;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  transition-property: background;
}
.posts-collapse .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-header:hover::before {
  background: #3eaf7c;
}
.posts-collapse .post-meta {
  position: absolute;
  font-size: 12px;
  left: 20px;
  top: 5px;
}
.posts-collapse .post-comments-count {
  display: none;
}
.posts-collapse .post-title {
  margin-left: 60px;
  font-size: 16px;
  font-weight: normal;
  line-height: inherit;
}
.posts-collapse .post-title::after {
  margin-left: 3px;
  opacity: 0.6;
}
.posts-collapse .post-title a,
.posts-collapse .post-title span.exturl {
  color: #666;
  border-bottom: none;
}
.page-home .post-type-quote .post-header,
.page-post-detail .post-type-quote .post-header,
.page-home .post-type-quote .post-tags,
.page-post-detail .post-type-quote .post-tags {
  display: none;
}
.posts-expand .post-title {
  overflow-wrap: break-word;
  word-wrap: break-word;
  text-align: center;
  font-weight: 400;
}
.posts-expand .post-title-link {
  display: inline-block;
  position: relative;
  color: #555;
  border-bottom: none;
  line-height: 1.2;
  vertical-align: top;
}
.posts-expand .post-title-link::before {
  content: "";
  position: absolute;
  width: 100%;
  height: 2px;
  bottom: 0;
  left: 0;
  background-color: #000;
  visibility: hidden;
  transform: scaleX(0);
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.posts-expand .post-title-link:hover::before {
  visibility: visible;
  transform: scaleX(1);
}
.posts-expand .post-title-link .fa {
  font-size: 20px;
  margin-left: 5px;
}
.posts-expand .post-meta {
  margin: 3px 0 60px 0;
  color: #999;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 12px;
  text-align: center;
}
.posts-expand .post-meta .post-category-list {
  display: inline-block;
  margin: 0;
  padding: 3px;
}
.posts-expand .post-meta .post-category-list-link {
  color: #999;
}
.posts-expand .post-meta .post-description {
  font-size: 14px;
  margin-top: 2px;
}
.posts-expand .post-meta time {
  border-bottom: 1px dashed #999;
  cursor: help;
}
.post-meta-divider {
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .post-meta-item-icon {
    display: inline-block;
  }
}
@media (max-width: 767px) {
  .post-meta-item-icon {
    display: inline-block;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
@media (max-width: 767px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-button {
  margin-top: 40px;
}
.posts-expand .post-tags {
  margin-top: 40px;
  text-align: center;
}
.posts-expand .post-tags a {
  display: inline-block;
  margin-right: 10px;
  font-size: 13px;
}
.post-nav {
  display: table;
  margin-top: 15px;
  width: 100%;
  border-top: 1px solid #eee;
}
.post-nav-divider {
  display: table-cell;
  width: 10%;
}
.post-nav-item {
  display: table-cell;
  padding: 10px 0 0 0;
  width: 45%;
  vertical-align: top;
}
.post-nav-item a {
  position: relative;
  display: block;
  line-height: 25px;
  font-size: 14px;
  color: #555;
  border-bottom: none;
}
.post-nav-item a:hover {
  color: #3eaf7c;
  border-bottom: none;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  font-size: 12px;
  margin-right: 5px;
}
.post-nav-next a {
  padding-left: 5px;
}
.post-nav-prev {
  text-align: right;
}
.post-nav-prev a {
  padding-right: 5px;
}
.post-nav-prev .fa {
  margin-left: 5px;
}
.posts-expand .post-eof {
  margin: 80px auto 60px;
  width: 8%;
  height: 1px;
  background: #ccc;
  text-align: center;
}
.post:last-child .post-eof {
  display: none;
}
.post-gallery {
  display: table;
  table-layout: fixed;
  width: 100%;
  border-collapse: separate;
}
.post-gallery-row {
  display: table-row;
}
.post-gallery .post-gallery-img {
  display: table-cell;
  text-align: center;
  vertical-align: middle;
  border: none;
}
.post-gallery .post-gallery-img img {
  max-width: 100%;
  max-height: 100%;
  border: none;
}
.fancybox-close,
.fancybox-close:hover {
  border: none;
}
#reward-container {
  padding: 10px 0;
  margin: 20px auto;
  width: 90%;
  text-align: center;
}
#reward-button {
  cursor: pointer;
  border: 0;
  outline: 0;
  display: inline-block;
  vertical-align: text-top;
  margin: 0;
  padding: 0 15px;
  border-radius: 5px;
  height: 32px;
  line-height: 32px;
  font-size: 16px;
  color: #fff;
  background: #f44336;
  letter-spacing: normal;
  text-transform: none;
  text-indent: 0px;
  text-shadow: none;
}
#reward-button span:hover {
  background: #f7877f;
}
#qr {
  padding-top: 20px;
}
#qr a {
  border: 0;
}
#qr img {
  width: 180px;
  max-width: 100%;
  display: inline-block;
  margin: 0.8em 2em 0 2em;
}
#qr p {
  text-align: center;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.reading-progress-bar {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 9999;
  display: block;
  width: 0;
  height: 2px;
  background: #37c6c0;
}
.sidebar {
  position: fixed;
  right: 0;
  top: 0;
  bottom: 0;
  width: 0;
  z-index: 1040;
  box-shadow: inset 0 2px 6px #000;
  background: #3eaf7c;
}
.sidebar a,
.sidebar span.exturl {
  color: #999;
  border-bottom-color: #555;
}
.sidebar a:hover,
.sidebar span.exturl:hover {
  color: #eee;
  border-bottom-color: #eee;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-inner {
  position: relative;
  padding: 20px 10px;
  color: #999;
  text-align: center;
}
.cc-license {
  margin-top: 10px;
  text-align: center;
}
.cc-license .cc-opacity {
  opacity: 0.7;
  border-bottom: none;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
.sidebar-toggle {
  position: fixed;
  right: 30px;
  bottom: 45px;
  width: 14px;
  height: 14px;
  padding: 5px;
  background: #3eaf7c;
  line-height: 0;
  z-index: 1050;
  cursor: pointer;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    opacity: 0.8;
    right: 20px;
    display: none;
  }
}
.sidebar-toggle-line {
  position: relative;
  display: inline-block;
  vertical-align: top;
  height: 2px;
  width: 100%;
  background: #fff;
  margin-top: 3px;
}
.sidebar-toggle-line:first-child {
  margin-top: 0;
}
.site-author-image {
  display: block;
  margin: 0 auto;
  padding: 2px;
  max-width: 120px;
  height: auto;
  border: 1px solid #eee;
  opacity: 0.9;
  transition: box-shadow 0.5s linear;
}
.site-author-image:hover {
  box-shadow: 0 0 0.46875rem #1faeff;
}
.site-author-image {
  border-radius: 100%;
}
.site-author-name {
  margin: 0;
  text-align: center;
  color: #3eaf7c;
  font-weight: 600;
}
.site-description {
  margin-top: 0;
  text-align: center;
  font-size: 13px;
  color: #999;
}
.links-of-author {
  margin-top: 20px;
}
.links-of-author a,
.links-of-author span.exturl {
  display: inline-block;
  vertical-align: middle;
  margin-right: 10px;
  margin-bottom: 10px;
  border-bottom-color: #555;
  font-size: 13px;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.links-of-author a:before,
.links-of-author span.exturl:before {
  display: inline-block;
  vertical-align: middle;
  margin-right: 3px;
  content: " ";
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: #b8d6b8;
}
.feed-link,
.chat {
  margin-top: 10px;
}
.feed-link a,
.chat a {
  display: inline-block;
  padding: 0 15px;
  color: #fc6423;
  border: 1px solid #fc6423 !important;
  border-radius: 4px;
}
.feed-link a i,
.chat a i {
  color: #fc6423;
  font-size: 14px;
}
.feed-link a:hover,
.chat a:hover {
  color: #fff;
  background: #fc6423;
}
.feed-link a:hover i,
.chat a:hover i {
  color: #fff;
}
.links-of-blogroll {
  margin-top: 10px;
  font-size: 13px;
}
.links-of-blogroll-title {
  margin-top: 0;
  font-size: 14px;
  font-weight: 600;
}
.links-of-blogroll-list {
  margin: 0;
  padding: 0;
  list-style: none;
}
.links-of-blogroll-item {
  padding: 2px 10px;
}
.links-of-blogroll-item a,
.links-of-blogroll-item span.exturl {
  max-width: 280px;
  box-sizing: border-box;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.sidebar-nav {
  margin: 0 0 20px;
  padding-left: 0;
}
.sidebar-nav li {
  display: inline-block;
  cursor: pointer;
  border-bottom: 1px solid transparent;
  font-size: 14px;
  color: #555;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.page-post-detail .sidebar-nav-toc {
  padding: 0 5px;
}
.page-post-detail .sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav .sidebar-nav-active {
  color: #fc6423;
  border-bottom-color: #fc6423;
}
.sidebar-nav .sidebar-nav-active:hover {
  color: #fc6423;
}
.sidebar-panel {
  display: none;
}
.sidebar-panel-active {
  display: block;
}
.site-state {
  display: flex;
  justify-content: center;
  overflow: hidden;
  line-height: 1.4;
  white-space: nowrap;
  text-align: center;
  margin-top: 10px;
}
.site-state-item {
  padding: 0 15px;
  border-left: 1px solid #eee;
}
.site-state-item:first-child {
  border-left: none;
}
.site-state-item a {
  border-bottom: none;
}
.site-state-item-count {
  display: block;
  text-align: center;
  color: inherit;
  font-weight: 600;
  font-size: 16px;
}
.site-state-item-name {
  font-size: 13px;
  color: #999;
}
.post-toc-empty {
  font-size: 14px;
  color: #666;
}
.post-toc-wrap {
  overflow: hidden;
}
.post-toc {
  overflow: auto;
}
.post-toc ol {
  margin: 0;
  padding: 0 2px 5px 10px;
  text-align: left;
  list-style: none;
  font-size: 14px;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  transition-property: all;
  color: #666;
  border-bottom-color: #ccc;
}
.post-toc ol a:hover {
  color: #000;
  border-bottom-color: #000;
}
.post-toc .nav-item {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  line-height: 1.8;
}
.post-toc .nav .nav-child {
  display: none;
}
.post-toc .nav .active > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child > .nav-item {
  display: block;
}
.post-toc .nav .active > a {
  color: #fc6423;
  border-bottom-color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.footer {
  font-size: 14px;
  color: #999;
}
.footer img {
  border: none;
}
.footer-inner {
  text-align: center;
}
.with-love {
  display: inline-block;
  margin: 0 5px;
  color: #808080;
}
.powered-by,
.theme-info {
  display: inline-block;
}
@-moz-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-webkit-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-o-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
.local-search-pop-overlay {
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 2080;
  background-color: rgba(0,0,0,0.3);
}
.local-search-popup {
  display: none;
  position: fixed;
  top: 10%;
  left: 50%;
  margin-left: -350px;
  width: 700px;
  height: 80%;
  padding: 0;
  background: #fff;
  color: #333;
  z-index: 9999;
  border-radius: 5px;
}
@media (max-width: 767px) {
  .local-search-popup {
    padding: 0;
    top: 0;
    left: 0;
    margin: 0;
    width: 100%;
    height: 100%;
    border-radius: 0;
  }
}
.local-search-popup ul.search-result-list {
  padding: 0;
  margin: 0 5px;
}
.local-search-popup p.search-result {
  border-bottom: 1px dashed #ccc;
  padding: 5px 0;
}
.local-search-popup a.search-result-title {
  font-weight: bold;
  font-size: 16px;
}
.local-search-popup .search-keyword {
  border-bottom: 1px dashed #f00;
  font-weight: bold;
  color: #f00;
}
.local-search-popup .local-search-header {
  padding: 5px;
  height: 36px;
  background: #f5f5f5;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
}
.local-search-popup #local-search-result {
  overflow: auto;
  position: relative;
  padding: 5px 25px;
  height: calc(100% - 55px);
}
.local-search-popup .local-search-input-wrapper {
  display: inline-block;
  width: calc(100% - 90px);
  height: 36px;
  line-height: 36px;
  padding: 0 5px;
}
.local-search-popup .local-search-input-wrapper input {
  padding: 8px 0;
  height: 20px;
  display: block;
  width: 100%;
  outline: none;
  border: none;
  background: transparent;
  vertical-align: middle;
}
.local-search-popup .search-icon,
.local-search-popup .popup-btn-close {
  display: inline-block;
  font-size: 18px;
  color: #999;
  height: 36px;
  width: 18px;
  padding-left: 10px;
  padding-right: 10px;
}
.local-search-popup .search-icon {
  float: left;
}
.local-search-popup .popup-btn-close {
  border-left: 1px solid #eee;
  float: right;
  cursor: pointer;
}
.local-search-popup #no-result {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  color: #ccc;
}
.page-archive .archive-page-counter {
  position: relative;
  top: 3px;
  left: 20px;
}
@media (max-width: 767px) {
  .page-archive .archive-page-counter {
    top: 5px;
  }
}
.page-archive .posts-collapse .archive-move-on {
  position: absolute;
  top: 11px;
  left: 0;
  margin-left: -6px;
  width: 10px;
  height: 10px;
  opacity: 0.5;
  background: #555;
  border: 1px solid #fff;
  border-radius: 50%;
}
.page-archive .fa-external-link {
  font-size: 15px;
  margin-left: 5px;
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  margin: 0;
  padding: 0;
  list-style: none;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  color: #bbb;
}
.category-all-page .category-list-count:before {
  display: inline;
  content: " (";
}
.category-all-page .category-list-count:after {
  display: inline;
  content: ") ";
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
#event-list {
  padding-left: 30px;
}
#event-list hr {
  margin: 20px 0 45px 0 !important;
  background: #222;
}
#event-list hr:after {
  display: inline-block;
  content: 'NOW';
  background: #222;
  color: #fff;
  font-weight: bold;
  text-align: right;
  padding: 0 5px;
}
#event-list li.event {
  margin: 20px 0px;
  background: #f9f9f9;
  padding-left: 10px;
  min-height: 40px;
}
#event-list li.event h2.event-summary {
  margin: 0;
  padding-bottom: 3px;
}
#event-list li.event h2.event-summary:before {
  display: inline-block;
  font-family: FontAwesome;
  font-size: 8px;
  content: '\f111';
  vertical-align: middle;
  margin-right: 25px;
  color: #bbb;
}
#event-list li.event span.event-relative-time {
  display: inline-block;
  font-size: 12px;
  font-weight: 400;
  padding-left: 12px;
  color: #bbb;
}
#event-list li.event span.event-details {
  display: block;
  color: #bbb;
  margin-left: 56px;
  padding-top: 3px;
  padding-bottom: 6px;
  text-indent: -24px;
  line-height: 18px;
}
#event-list li.event span.event-details:before {
  text-indent: 0;
  display: inline-block;
  width: 14px;
  font-family: FontAwesome;
  text-align: center;
  margin-right: 9px;
  color: #bbb;
}
#event-list li.event span.event-details.event-location:before {
  content: '\f041';
}
#event-list li.event span.event-details.event-duration:before {
  content: '\f017';
}
#event-list li.event-past {
  background: #fcfcfc;
  padding: 15px 0 15px 10px;
}
#event-list li.event-past > * {
  opacity: 0.9;
}
#event-list li.event-past h2.event-summary {
  color: #bbb;
}
#event-list li.event-past h2.event-summary:before {
  color: #dfdfdf;
}
#event-list li.event-now {
  background: #222;
  color: #fff;
  padding: 15px 0 15px 10px;
}
#event-list li.event-now h2.event-summary:before {
  transform: scale(1.2);
  color: #fff;
  animation: dot-flash 1s alternate infinite ease-in-out;
}
#event-list li.event-now * {
  color: #fff !important;
}
#event-list li.event-future {
  background: #222;
  color: #fff;
  padding: 15px 0 15px 10px;
}
#event-list li.event-future h2.event-summary:before {
  transform: scale(1.2);
  color: #fff;
  animation: dot-flash 1s alternate infinite ease-in-out;
}
#event-list li.event-future * {
  color: #fff !important;
}
@-moz-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    transform: scale(1);
  }
}
@-webkit-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    transform: scale(1);
  }
}
@-o-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    transform: scale(1);
  }
}
@keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    transform: scale(1);
  }
}
.page-post-detail .sidebar-toggle-line {
  background: #fc6423;
}
.page-post-detail .comments {
  overflow: hidden;
}
ul.breadcrumb {
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
  font-size: 12px;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li+li:before {
  padding: 0.5em;
  font-weight: normal;
  content: "/\00a0";
}
ul.breadcrumb li+li:last-child {
  font-weight: bold;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.tag-cloud a:hover {
  color: #3eaf7c !important;
}
.header {
  position: relative;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header {
    width: 73%;
  }
}
@media (max-width: 991px) {
  .header {
    width: auto;
  }
}
.header-inner {
  position: absolute;
  top: 0;
  overflow: hidden;
  padding: 0;
  width: 240px;
  background: #fff;
  box-shadow: initial;
  border-radius: initial;
}
@media (min-width: 1200px) {
  .container .header-inner {
    width: 240px;
  }
}
@media (max-width: 991px) {
  .header-inner {
    position: relative;
    width: auto;
    border-radius: initial;
  }
}
.main:before,
.main:after {
  content: " ";
  display: table;
}
.main:after {
  clear: both;
}
@media (max-width: 991px) {
  .container .main-inner {
    width: auto;
  }
}
.content-wrap {
  float: right;
  box-sizing: border-box;
  padding: 40px;
  width: calc(100% - 252px);
  background: #fff;
  min-height: 700px;
  box-shadow: initial;
  border-radius: initial;
}
@media (min-width: 768px) and (max-width: 991px) {
  .content-wrap {
    width: 100%;
    padding: 20px;
    border-radius: initial;
  }
}
@media (max-width: 767px) {
  .content-wrap {
    width: 100%;
    padding: 20px;
    min-height: auto;
    border-radius: initial;
  }
}
.sidebar {
  position: static;
  float: left;
  margin-left: -100%;
  width: 240px;
  background: #f5f7f9;
  box-shadow: none;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-toggle {
  display: none;
}
.footer-inner {
  padding-left: 260px;
}
@media (max-width: 991px) {
  .footer-inner {
    width: auto;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}
.sidebar-position-right .header-inner {
  right: 0;
}
.sidebar-position-right .content-wrap {
  float: left;
}
.sidebar-position-right .sidebar {
  float: right;
}
.sidebar-position-right .footer-inner {
  padding-left: 0;
  padding-right: 260px;
}
.site-brand-wrapper {
  position: relative;
}
.site-meta {
  padding: 20px 0;
  color: #fff;
  background: #3eaf7c;
}
@media (max-width: 991px) {
  .site-meta {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.brand {
  padding: 0;
  background: none;
}
.brand:hover {
  color: #fff;
}
.site-subtitle {
  margin: 10px 10px 0;
  font-weight: initial;
}
.custom-logo-image {
  margin-top: 20px;
}
@media (max-width: 991px) {
  .custom-logo-image {
    display: none;
  }
}
.site-search form {
  display: none;
}
.site-nav {
  border-top: none;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: none !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-on {
    display: block !important;
  }
}
.menu-item-active a,
.menu .menu-item a:hover,
.menu .menu-item span.exturl:hover {
  background: #f9f9f9;
  border-bottom-color: #fff;
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a,
.menu .menu-item span.exturl {
  position: relative;
  box-sizing: border-box;
  padding: 5px 20px;
  text-align: left;
  line-height: inherit;
  transition-property: background-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
@media (hover: none) {
  .menu .menu-item a:hover,
  .menu .menu-item span.exturl:hover {
    background: none;
  }
}
.menu .menu-item .badge {
  display: inline-block;
  padding: 2px 5px;
  font-weight: 700;
  line-height: 1;
  color: #fff;
  text-align: center;
  white-space: nowrap;
  vertical-align: middle;
  background-color: #ccc;
  border-radius: 10px;
  float: right;
  margin: 0.35em 0 0 0;
  text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
}
.menu .menu-item br {
  display: none;
}
.btn-bar {
  background-color: #fff;
}
.site-nav-toggle {
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle {
    display: block;
  }
}
.sub-menu {
  margin: 0;
  padding: 6px 0;
  background: #fff !important;
  border-bottom: 1px solid #ddd;
}
.sub-menu .menu-item {
  display: inline-block !important;
}
.sub-menu .menu-item a,
.sub-menu .menu-item span.exturl {
  padding: initial !important;
  margin: 5px 10px;
}
.sub-menu .menu-item a:hover,
.sub-menu .menu-item span.exturl:hover {
  background: initial !important;
  color: #fc6423;
}
.sub-menu .menu-item-active a {
  background: #fff !important;
  color: #fc6423;
  border-bottom-color: #fc6423;
}
.sub-menu .menu-item-active a:hover {
  background: #fff !important;
  border-bottom-color: #fc6423;
}
.use-motion .sidebar .motion-element {
  opacity: 1;
}
.sidebar {
  right: auto;
  bottom: auto;
  -webkit-transform: none;
}
.sidebar a,
.sidebar span.exturl {
  color: #555;
}
.sidebar a:hover,
.sidebar span.exturl:hover {
  color: #3eaf7c;
  border-bottom-color: #3eaf7c;
}
.sidebar-inner {
  box-sizing: border-box;
  width: 240px;
  color: #555;
  background: #fff;
  box-shadow: initial;
  border-radius: initial;
  opacity: 0;
}
.sidebar-inner.affix {
  position: fixed;
  top: 12px;
}
.sidebar-inner.affix-bottom {
  position: absolute;
}
.site-overview {
  text-align: left;
}
.site-author:before,
.site-author:after {
  content: " ";
  display: table;
}
.site-author:after {
  clear: both;
}
.site-state-item {
  padding: 0 10px;
}
.feed-link,
.chat {
  border-top: 1px dotted #ccc;
  border-bottom: 1px dotted #ccc;
  text-align: center;
}
.feed-link a,
.chat a {
  display: block;
  color: #fc6423;
  border: none !important;
}
.feed-link a:hover,
.chat a:hover {
  background: none;
  color: #e34603;
}
.feed-link a:hover i,
.chat a:hover i {
  color: #e34603;
}
.links-of-author {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.links-of-author span.exturl {
  font-size: 13px;
}
.links-of-author-item {
  margin: 5px 0 0;
  width: 50%;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  max-width: 216px;
  box-sizing: border-box;
  display: inline-block;
  margin-right: 0;
  margin-bottom: 0;
  padding: 0 5px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.links-of-author-item a:before,
.links-of-author-item span.exturl:before {
  display: none;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  border-bottom: none;
  text-decoration: underline;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  display: block;
  text-decoration: none;
}
.links-of-author-item a:hover,
.links-of-author-item span.exturl:hover {
  border-radius: 4px;
  background: #eee;
}
.links-of-author-item .fa {
  margin-right: 2px;
  font-size: 16px;
}
.links-of-author-item .fa-globe {
  font-size: 15px;
}
.links-of-blogroll {
  text-align: center;
  padding: 3px 0 0;
}
.links-of-blogroll-item {
  padding: 0;
}
.links-of-blogroll-inline:before,
.links-of-blogroll-inline:after {
  content: " ";
  display: table;
}
.links-of-blogroll-inline:after {
  clear: both;
}
.links-of-blogroll-inline .links-of-blogroll-item {
  margin: 5px 0 0;
  width: 50%;
  display: inline-block;
  width: unset;
}
.links-of-blogroll-inline .links-of-blogroll-item a,
.links-of-blogroll-inline .links-of-blogroll-item span.exturl {
  max-width: 216px;
  box-sizing: border-box;
  display: inline-block;
  margin-right: 0;
  margin-bottom: 0;
  padding: 0 5px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
</style><noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">前端轻语</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">奋力搬砖中 ٩(•̤̀ᵕ•̤́๑)ᵒᵏᵎᵎᵎᵎ</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-list-ol"></i> <br>分类<span class="badge">5</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">94</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-map">

    
    
    
      
    

    
      
    

    <a href="/map/" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>前端知识图谱</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/zhaoky" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.flqin.com/383.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Korey">
      <meta itemprop="description" content="热衷于记录、分享前端开发技术">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端轻语">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">webpack 4 源码主流程分析（十二）：打包后文件解析

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-12-24 16:38:20" itemprop="dateCreated datePublished" datetime="2019-12-24T16:38:20+00:00">2019-12-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-11 10:11:51" itemprop="dateModified" datetime="2020-09-11T10:11:51+00:00">2020-09-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/FE-Builds-package-tools-module-test-optimization/" itemprop="url" rel="index"><span itemprop="name">FE Builds (package tools, module, test, optimization...)</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">17k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 ≈</span>
                
                <span title="阅读时长">15 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>以 <code>前言及总流程概览</code> 里的 <code>demo</code> 为例， 前七章分析了打包过程，现在来分析它打包后的文件。</p>
<h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/a.js</span></span><br><span class="line"><span class="keyword">import</span> { add } <span class="keyword">from</span> <span class="string">'Src/b'</span>;</span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./c.js'</span>).then(<span class="function">(<span class="params">m</span>) =&gt;</span> m.sub(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line"><span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line">add(<span class="number">3</span>, <span class="number">2</span> + a);</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/b.js</span></span><br><span class="line"><span class="keyword">import</span> { mul } <span class="keyword">from</span> <span class="string">'@fe_korey/test-loader?number=20!Src/e'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> a + b + mul(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addddd</span>(<span class="params">a, b</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> a + b * b;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/c.js</span></span><br><span class="line"><span class="keyword">import</span> { mul } <span class="keyword">from</span> <span class="string">'Src/d'</span>;</span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./b.js'</span>).then(<span class="function">(<span class="params">m</span>) =&gt;</span> m.add(<span class="number">200</span>, <span class="number">100</span>)); <span class="comment">//require.ensure() 是 webpack 特有的，已经被 import() 取代。</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">sub</span>(<span class="params">a, b</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> a - b + mul(<span class="number">100</span>, <span class="number">50</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/d.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mul</span>(<span class="params">a, b</span>) </span>{</span><br><span class="line">  <span class="keyword">const</span> d = <span class="number">10000</span>;</span><br><span class="line">  <span class="keyword">return</span> a * b + d;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  entry: {</span><br><span class="line">    bundle: <span class="string">'./src/a.js'</span>,</span><br><span class="line">  },</span><br><span class="line">  devtool: <span class="string">'none'</span>,</span><br><span class="line">  output: {</span><br><span class="line">    path: __dirname + <span class="string">'/dist'</span>,</span><br><span class="line">    filename: <span class="string">'[name].[chunkhash:4].js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[name].[chunkhash:8].js'</span>,</span><br><span class="line">  },</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  resolve: {</span><br><span class="line">    alias: {</span><br><span class="line">      Src: path.resolve(__dirname, <span class="string">'src/'</span>),</span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">  <span class="built_in">module</span>: {</span><br><span class="line">    rules: [</span><br><span class="line">      {</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          {</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          },</span><br><span class="line">        ],</span><br><span class="line">      },</span><br><span class="line">    ],</span><br><span class="line">  },</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//babel.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  presets: [<span class="string">'@babel/env'</span>],</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p><code>@fe_korey/test-loader</code> 是一个测试 <code>loader</code>，该 <code>loader</code> 作用为代码里的字符串 <code>10000</code> 替换为传入的 <code>number</code>。</p>
<h2 id="打包结果文件"><a href="#打包结果文件" class="headerlink" title="打包结果文件"></a>打包结果文件</h2><p>根据项目配置及同步异步的关系，打包后一共生成两个文件：</p>
<ul>
<li><code>bundle.xxxx.js</code></li>
</ul>
<p>总代码：见 <a href="https://github.com/zhaoky/webpack-demo/tree/master/dist" target="_blank" rel="noopener">github</a></p>
<p>入口文件，该文件名根据配置：<code>entry</code> 及 <code>output.filename</code> 生成，里面包含 <code>webpack runtime</code> 代码和同步模块代码。</p>
<p>如若配置了 <code>html-webpack-plugin</code>，那么在生成的 <code>html</code> 里将只会引入此 <code>js</code> 文件。</p>
<ul>
<li><code>0.xxxxxxxx.js</code></li>
</ul>
<p>总代码：见 <a href="https://github.com/zhaoky/webpack-demo/tree/master/distt" target="_blank" rel="noopener">github</a></p>
<p>非入口文件，本例为异步 <code>chunk</code> 文件，该文件名根据配置： <code>output.chunkFilename</code>生成，里面包含异步模块代码。</p>
<h2 id="代码执行流程"><a href="#代码执行流程" class="headerlink" title="代码执行流程"></a>代码执行流程</h2><p>根据代码执行顺序来分析，<code>html</code> 文件只需引入了<code>bundle.xxxx.js</code>文件，则从该文件开始执行，如果有其他 <code>import</code> 后，会先跳到对应的 <code>module</code> 进行处理，即<strong>先序深度优先</strong>遍历算法递归该依赖树。</p>
<h3 id="bundle-主体结构"><a href="#bundle-主体结构" class="headerlink" title="bundle 主体结构"></a>bundle 主体结构</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>{</span><br><span class="line">  <span class="comment">//runtime代码</span></span><br><span class="line">})({</span><br><span class="line">  <span class="string">'./node_modules/@fe_korey/test-loader/loader.js?number=20!./src/d.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>{</span><br><span class="line">    <span class="comment">//...模块代码d</span></span><br><span class="line">  },</span><br><span class="line">  <span class="string">'./src/a.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>{</span><br><span class="line">    <span class="comment">//...模块代码a</span></span><br><span class="line">  },</span><br><span class="line">  <span class="string">'./src/b.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>{</span><br><span class="line">    <span class="comment">//...模块代码b</span></span><br><span class="line">  },</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>主体结构为一个自执行函数，函数体为 <code>runtime</code> 函数，参数为 <code>modules</code> 对象，各模块以 <code>key-value</code> 的形式一起存在该 <code>modules</code> 对象里。当前 <code>key</code> 为模块的路径，<code>value</code> 为包裹模块代码的一个函数。</p>
<h3 id="runtime-函数"><a href="#runtime-函数" class="headerlink" title="runtime 函数"></a>runtime 函数</h3><p><code>runtime</code> 指的是 <code>webpack</code> 的运行环境(具体作用就是模块解析, 加载) 和 模块信息清单（表现在 <code>jsonpScriptSrc</code> 方法里）。</p>
<p>配置项 <code>optimization.runtimeChunk</code> 可以设置 <code>webpack</code> 将 <code>runtime</code> 这部分代码单独打包。</p>
<h4 id="runtime-函数主体结构"><a href="#runtime-函数主体结构" class="headerlink" title="runtime 函数主体结构"></a>runtime 函数主体结构</h4><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">modules</span>)</span>{</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">webpackJsonpCallback</span>(<span class="params">data</span>)</span>{</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 设置 script src  __webpack_require__.p 即为 output.publicPath 配置</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">jsonpScriptSrc</span>(<span class="params">chunkId</span>)</span>{</span><br><span class="line">    <span class="keyword">return</span> __webpack_require__.p + <span class="string">""</span> + ({}[chunkId]||chunkId) + <span class="string">"."</span> + {<span class="string">"0"</span>:<span class="string">"d680ffbe"</span>}[chunkId] + <span class="string">".js"</span></span><br><span class="line">  }</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>)</span>{</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">var</span> installedModules = {};</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> installedChunks = {<span class="string">"bundle"</span>: <span class="number">0</span>};</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义一堆挂载在__webpack_require__上的属性</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// jsonp 初始化</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="string">"./src/a.js"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="开始执行"><a href="#开始执行" class="headerlink" title="开始执行"></a>开始执行</h3><p>代码开始执行：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> installedModules = {};</span><br></pre></td></tr></tbody></table></figure>

<p>初始化 <code>installedModules</code>，保存所有创建过的 <code>module</code>，用于缓存判断。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// undefined：chunk未加载, null: chunk通过prefetch/preload提前获取过</span></span><br><span class="line"><span class="comment">// Promise：chunk正在加载, 0：chunk加载完毕</span></span><br><span class="line"><span class="comment">// 数组: 结构为 [resolve Function, reject Function, Promise] 的数组, 代表 chunk 在处于加载中</span></span><br><span class="line"><span class="keyword">var</span> installedChunks = {</span><br><span class="line">  bundle: <span class="number">0</span>,</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p><code>installedChunks</code> 以 <code>key-value</code> 的形式，用于收集保存所有的 <code>chunk</code>，这里 <code>bundle</code> 就是指的当前 <code>chunk</code>，自然是已经加载好了的。</p>
<h3 id="webpack-require-属性"><a href="#webpack-require-属性" class="headerlink" title="__webpack_require__ 属性"></a><code>__webpack_require__</code> 属性</h3><p>然后定义了一堆 <code>__webpack_require__</code> 的属性：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步处理</span></span><br><span class="line">__webpack_require__.e = <span class="function"><span class="keyword">function</span> <span class="title">requireEnsure</span>(<span class="params">chunkId</span>) </span>{</span><br><span class="line">  <span class="comment">//后文单独分析</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 即为传入的modules：各模块组成的对象</span></span><br><span class="line">__webpack_require__.m = modules;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 即为installedModules：已经缓存的对象</span></span><br><span class="line">__webpack_require__.c = installedModules;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在exports对象上添加属性，即 增加导出</span></span><br><span class="line">__webpack_require__.d = <span class="function"><span class="keyword">function</span> (<span class="params">exports, name, getter</span>) </span>{</span><br><span class="line">  <span class="keyword">if</span> (!__webpack_require__.o(exports, name)) {</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(exports, name, { <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">get</span>: getter });</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在exports对象上添加 __esModule 属性，用于标识 es6 模块</span></span><br><span class="line">__webpack_require__.r = <span class="function"><span class="keyword">function</span> (<span class="params">exports</span>) </span>{</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">Symbol</span> !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">Symbol</span>.toStringTag) {</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(exports, <span class="built_in">Symbol</span>.toStringTag, { <span class="attr">value</span>: <span class="string">'Module'</span> });</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(exports, <span class="string">'__esModule'</span>, { <span class="attr">value</span>: <span class="literal">true</span> });</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个伪命名空间对象</span></span><br><span class="line">__webpack_require__.t = <span class="function"><span class="keyword">function</span> (<span class="params">value, mode</span>) </span>{</span><br><span class="line">  <span class="comment">//没用上，解释暂时略过</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到 getDefaultExport，即通过 __esModule 属性判断是否是 es6 来确定对应的默认导出方法</span></span><br><span class="line">__webpack_require__.n = <span class="function"><span class="keyword">function</span> (<span class="params">module</span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> getter =</span><br><span class="line">    <span class="built_in">module</span> &amp;&amp; <span class="built_in">module</span>.__esModule</span><br><span class="line">      ? <span class="function"><span class="keyword">function</span> <span class="title">getDefault</span>(<span class="params"></span>) </span>{</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">module</span>[<span class="string">'default'</span>];</span><br><span class="line">        }</span><br><span class="line">      : <span class="function"><span class="keyword">function</span> <span class="title">getModuleExports</span>(<span class="params"></span>) </span>{</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">module</span>;</span><br><span class="line">        };</span><br><span class="line">  __webpack_require__.d(getter, <span class="string">'a'</span>, getter);</span><br><span class="line">  <span class="keyword">return</span> getter;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 hasOwnProperty，即判断对象上是否有某一属性</span></span><br><span class="line">__webpack_require__.o = <span class="function"><span class="keyword">function</span> (<span class="params">object, property</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(object, property);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 即为 publicPath，在output.publicPath配置而来</span></span><br><span class="line">__webpack_require__.p = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理</span></span><br><span class="line">__webpack_require__.oe = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.error(err);</span><br><span class="line">  <span class="keyword">throw</span> err;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>每个属性的作用已经写在注释上面。</p>
<h3 id="jsonp-初始化"><a href="#jsonp-初始化" class="headerlink" title="jsonp 初始化"></a><code>jsonp</code> 初始化</h3><p>然后执行 <code>jsonp</code> 初始化:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonpArray = (<span class="built_in">window</span>[<span class="string">'webpackJsonp'</span>] = <span class="built_in">window</span>[<span class="string">'webpackJsonp'</span>] || []); <span class="comment">//初始化 window['webpackJsonp']对象</span></span><br><span class="line"><span class="keyword">var</span> oldJsonpFunction = jsonpArray.push.bind(jsonpArray); <span class="comment">// 暂存 push 方法</span></span><br><span class="line">jsonpArray.push = webpackJsonpCallback; <span class="comment">//重写 jsonpArray 的 push 方法为 webpackJsonpCallback</span></span><br><span class="line">jsonpArray = jsonpArray.slice(); <span class="comment">//拷贝 jsonpArray（不带 push 方法）</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]); <span class="comment">//若入口文件加载前，chunks文件先加载了，遍历 jsonpArray 用 webpackJsonpCallback 执行</span></span><br><span class="line"><span class="keyword">var</span> parentJsonpFunction = oldJsonpFunction; <span class="comment">//旧的 push 方法存入 parentJsonpFunction</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>jsonp</code> 初始化的主要作用就是给 <code>window['webpackJsonp']</code> 重写了 <code>push</code> 方法为 <code>webpackJsonpCallback</code> 。接着执行：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> __webpack_require__((__webpack_require__.s = <span class="string">'./src/a.js'</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>由入口文件 <code>a</code> 开始，传入 <code>moduleID : "./src/a.js"</code>，执行方法 <code>__webpack_require__</code>。</p>
<h3 id="webpack-require"><a href="#webpack-require" class="headerlink" title="__webpack_require__"></a><code>__webpack_require__</code></h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>{</span><br><span class="line">  <span class="comment">// 判断该module是否已经被缓存到installedModules，如果有，则直接返回它的导出exports</span></span><br><span class="line">  <span class="keyword">if</span> (installedModules[moduleId]) {</span><br><span class="line">    <span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 定义module并缓存</span></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">module</span> = (installedModules[moduleId] = {</span><br><span class="line">    i: moduleId,</span><br><span class="line">    l: <span class="literal">false</span>,</span><br><span class="line">    exports: {},</span><br><span class="line">  });</span><br><span class="line">  <span class="comment">// 执行module代码</span></span><br><span class="line">  modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 标志module已经读取完成</span></span><br><span class="line">  <span class="built_in">module</span>.l = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>__webpack_require__</code> 方法的主要作用就是创建缓存 <code>module</code> 后，执行该 <code>module</code> 的代码。其中 <code>modules</code> 即为上文所解释的各模块组成的对象。</p>
<h3 id="执行各同步模块代码"><a href="#执行各同步模块代码" class="headerlink" title="执行各同步模块代码"></a>执行各同步模块代码</h3><p><code>modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);</code> 执行模块 <code>a</code> 的代码。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模块 a</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line">__webpack_require__.r(__webpack_exports__);</span><br><span class="line"><span class="keyword">var</span> Src_b__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(<span class="string">'./src/b.js'</span>);</span><br><span class="line"></span><br><span class="line">__webpack_require__</span><br><span class="line">  .e(<span class="number">0</span>)</span><br><span class="line">  .then(__webpack_require__.bind(<span class="literal">null</span>, <span class="string">'./src/c.js'</span>))</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">m</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> m.sub(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">  });</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">Object</span>(Src_b__WEBPACK_IMPORTED_MODULE_0__[<span class="string">'add'</span>])(<span class="number">3</span>, <span class="number">2</span> + a);</span><br></pre></td></tr></tbody></table></figure>

<p>代码里 <code>__webpack_require__('./src/b.js')</code> 会去执行模块 <code>b</code> 的代码：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模块 b</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line">__webpack_require__.r(__webpack_exports__);</span><br><span class="line">__webpack_require__.d(__webpack_exports__, <span class="string">'add'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> add;</span><br><span class="line">});</span><br><span class="line">__webpack_require__.d(__webpack_exports__, <span class="string">'addddd'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> addddd;</span><br><span class="line">});</span><br><span class="line"><span class="keyword">var</span> _fe_korey_test_loader_number_20_Src_d__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(<span class="string">'./node_modules/@fe_korey/test-loader/loader.js?number=20!./src/d.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> a + b + <span class="built_in">Object</span>(_fe_korey_test_loader_number_20_Src_d__WEBPACK_IMPORTED_MODULE_0__[<span class="string">'mul'</span>])(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addddd</span>(<span class="params">a, b</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> a + b * b;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>代码里在导出了两个方法后，去执行模块 <code>d</code> 的代码：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模块 d</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line">__webpack_require__.r(__webpack_exports__);</span><br><span class="line">__webpack_require__.d(__webpack_exports__, <span class="string">'mul'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> mul;</span><br><span class="line">});</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mul</span>(<span class="params">a, b</span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> d = <span class="number">20</span>;</span><br><span class="line">  <span class="keyword">return</span> a * b + d;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>模块 <code>d</code> 代码导出了 <code>mul</code>。</p>
<h3 id="import-的处理"><a href="#import-的处理" class="headerlink" title="import() 的处理"></a>import() 的处理</h3><p>各自模块执行完后，回到模块 <code>a</code> 里执行：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__webpack_require__</span><br><span class="line">  .e(<span class="number">0</span>)</span><br><span class="line">  .then(__webpack_require__.bind(<span class="literal">null</span>, <span class="string">'./src/c.js'</span>))</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">m</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> m.sub(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">  });</span><br></pre></td></tr></tbody></table></figure>

<p>该打包后的代码为<strong>动态加载</strong>，源代码为：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">'./c.js'</span>).then(<span class="function">(<span class="params">m</span>) =&gt;</span> m.sub(<span class="number">2</span>, <span class="number">1</span>));</span><br></pre></td></tr></tbody></table></figure>

<h4 id="webpack-require-e"><a href="#webpack-require-e" class="headerlink" title="__webpack_require__.e"></a><code>__webpack_require__.e</code></h4><p><code>__webpack_require__.e</code> 实现异步加载模块，方法为：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// promise队列，等待多个异步 chunk都加载完成才执行回调</span></span><br><span class="line"><span class="keyword">var</span> promises = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先判断是否加载过该 chunk</span></span><br><span class="line"><span class="keyword">var</span> installedChunkData = installedChunks[chunkId];</span><br><span class="line"><span class="keyword">if</span> (installedChunkData !== <span class="number">0</span>) {</span><br><span class="line">  <span class="comment">// 0 means "already installed".</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// a Promise means "currently loading". 目标 chunk 正在加载，则将 promise push到 promises 数组</span></span><br><span class="line">  <span class="keyword">if</span> (installedChunkData) {</span><br><span class="line">    promises.push(installedChunkData[<span class="number">2</span>]);</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// 新建一个Promise去异步加载目标chunk</span></span><br><span class="line">    <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>{</span><br><span class="line">      installedChunkData = installedChunks[chunkId] = [resolve, reject]; <span class="comment">//这里设置 installedChunks[chunkId]</span></span><br><span class="line">    });</span><br><span class="line">    promises.push((installedChunkData[<span class="number">2</span>] = promise)); <span class="comment">// installedChunks[chunkId]  = [resolve, reject, promise]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    <span class="keyword">var</span> onScriptComplete;</span><br><span class="line"></span><br><span class="line">    script.charset = <span class="string">'utf-8'</span>;</span><br><span class="line">    script.timeout = <span class="number">120</span>;</span><br><span class="line">    <span class="keyword">if</span> (__webpack_require__.nc) {</span><br><span class="line">      script.setAttribute(<span class="string">'nonce'</span>, __webpack_require__.nc);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 设置src</span></span><br><span class="line">    script.src = jsonpScriptSrc(chunkId);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">    <span class="comment">// 设置加载完成或错误的回调</span></span><br><span class="line">    onScriptComplete = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>{</span><br><span class="line">      <span class="comment">// avoid mem leaks in IE.</span></span><br><span class="line">      script.onerror = script.onload = <span class="literal">null</span>;</span><br><span class="line">      clearTimeout(timeout);</span><br><span class="line">      <span class="keyword">var</span> chunk = installedChunks[chunkId];</span><br><span class="line">      <span class="keyword">if</span> (chunk !== <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">if</span> (chunk) {</span><br><span class="line">          <span class="keyword">var</span> errorType = event &amp;&amp; (event.type === <span class="string">'load'</span> ? <span class="string">'missing'</span> : event.type);</span><br><span class="line">          <span class="keyword">var</span> realSrc = event &amp;&amp; event.target &amp;&amp; event.target.src;</span><br><span class="line">          error.message = <span class="string">'Loading chunk '</span> + chunkId + <span class="string">' failed.\n('</span> + errorType + <span class="string">': '</span> + realSrc + <span class="string">')'</span>;</span><br><span class="line">          error.name = <span class="string">'ChunkLoadError'</span>;</span><br><span class="line">          error.type = errorType;</span><br><span class="line">          error.request = realSrc;</span><br><span class="line">          chunk[<span class="number">1</span>](error);</span><br><span class="line">        }</span><br><span class="line">        installedChunks[chunkId] = <span class="literal">undefined</span>;</span><br><span class="line">      }</span><br><span class="line">    };</span><br><span class="line">    <span class="comment">// 设置超时处理</span></span><br><span class="line">    <span class="keyword">var</span> timeout = setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">      onScriptComplete({ <span class="attr">type</span>: <span class="string">'timeout'</span>, <span class="attr">target</span>: script });</span><br><span class="line">    }, <span class="number">120000</span>);</span><br><span class="line">    <span class="comment">//script标签的onload事件都是在外部js文件被加载完成并执行完成后（异步不算）才被触发</span></span><br><span class="line">    script.onerror = script.onload = onScriptComplete;</span><br><span class="line">    <span class="comment">// script标签加入文档</span></span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(script);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Promise</span>.all(promises);</span><br></pre></td></tr></tbody></table></figure>

<p>参数 <code>0</code> 为 <code>chunkId</code>，在方法 <code>__webpack_require__.e</code> 里，主要功能就是模拟 <code>jsonp</code> 去异步加载目标 <code>chunk</code> 文件 <code>0</code>，返回一个 <code>promise</code> 对象。</p>
<p>然后加载异步文件 <code>0.e3296d88.js</code> 并执行。</p>
<h3 id="加载非入口文件0-e3296d88-js"><a href="#加载非入口文件0-e3296d88-js" class="headerlink" title="加载非入口文件0.e3296d88.js"></a>加载非入口文件<code>0.e3296d88.js</code></h3><h4 id="非入口文件主体结构"><a href="#非入口文件主体结构" class="headerlink" title="非入口文件主体结构"></a>非入口文件主体结构</h4><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">window</span>[<span class="string">'webpackJsonp'</span>] = <span class="built_in">window</span>[<span class="string">'webpackJsonp'</span>] || []).push([</span><br><span class="line">  [<span class="number">0</span>],</span><br><span class="line">  {</span><br><span class="line">    <span class="string">'./src/c.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>{</span><br><span class="line">      <span class="comment">//模块 c</span></span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="string">'./src/d.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>{</span><br><span class="line">      <span class="comment">//模块 d</span></span><br><span class="line">    },</span><br><span class="line">  },</span><br><span class="line">]);</span><br></pre></td></tr></tbody></table></figure>

<p>在模块加载后，就会立即执行的 <code>window['webpackJsonp'].push()</code> 。由 <code>jsonp</code> 初始化可知， 即执行 <code>bundle</code> 文件里的 <code>webpackJsonpCallback</code> 方法。</p>
<h4 id="webpackJsonpCallback"><a href="#webpackJsonpCallback" class="headerlink" title="webpackJsonpCallback"></a>webpackJsonpCallback</h4><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">webpackJsonpCallback</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> chunkIds = data[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">var</span> moreModules = data[<span class="number">1</span>]; <span class="comment">//异步 chunk 的各模块组成的对象</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> moduleId,</span><br><span class="line">    chunkId,</span><br><span class="line">    i = <span class="number">0</span>,</span><br><span class="line">    resolves = [];</span><br><span class="line">  <span class="comment">// 这里收集 resolve 并将所有 chunkIds 标记为已加载</span></span><br><span class="line">  <span class="keyword">for</span> (; i &lt; chunkIds.length; i++) {</span><br><span class="line">    chunkId = chunkIds[i];</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(installedChunks, chunkId) &amp;&amp; installedChunks[chunkId]) {</span><br><span class="line">      resolves.push(installedChunks[chunkId][<span class="number">0</span>]); <span class="comment">//将 resolve push 到 resolves 数组中</span></span><br><span class="line">    }</span><br><span class="line">    installedChunks[chunkId] = <span class="number">0</span>; <span class="comment">//标记为已加载</span></span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 遍历各模块组成的对象，将每个模块都加到 modules</span></span><br><span class="line">  <span class="keyword">for</span> (moduleId <span class="keyword">in</span> moreModules) {</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(moreModules, moduleId)) {</span><br><span class="line">      modules[moduleId] = moreModules[moduleId];</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 执行保存的旧 push 方法，可能是 array.push (即 push 到 window.webpackJsonp)，也可能是前一个并行执行了 runtime 的 bundle 的 webpackJsonpCallback，即递归执行 webpackJsonpCallback，如多入口同时 import 同一个 module 的情况。</span></span><br><span class="line">  <span class="keyword">if</span> (parentJsonpFunction) parentJsonpFunction(data);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//循环触发 resolve 回调</span></span><br><span class="line">  <span class="keyword">while</span> (resolves.length) {</span><br><span class="line">    resolves.shift()();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>webpackJsonpCallback</code> 方法主要将异步的 <code>chunk</code> 里的所有模块都加到 <code>modules</code> 后，改变 <code>installedChunks[chunkId]</code> 的状态为 <code>0</code>（即已加载），然后执行之前创建的 <code>promise</code> 的 <code>resolve()</code>。</p>
<h4 id="执行-resolve-的回调-then-方法"><a href="#执行-resolve-的回调-then-方法" class="headerlink" title="执行 resolve 的回调 then 方法"></a>执行 resolve 的回调 then 方法</h4><p>回到模块 <code>a</code> 根据 <code>promise</code> 的定义，执行 <code>promises</code> 队列里所有的 <code>resolve</code> 后，然后去执行对应的 <code>then</code> 方法：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">then(__webpack_require__.bind(<span class="literal">null</span>, <span class="string">'./src/c.js'</span>));</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></tbody></table></figure>

<p>即执行模块 <code>c</code>：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line">__webpack_require__.r(__webpack_exports__);</span><br><span class="line">__webpack_require__.d(__webpack_exports__, <span class="string">'sub'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> sub;</span><br><span class="line">});</span><br><span class="line"><span class="keyword">var</span> Src_d__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(<span class="string">'./src/d.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve()</span><br><span class="line">  .then(__webpack_require__.bind(<span class="literal">null</span>, <span class="string">'./src/b.js'</span>))</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">m</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> m.add(<span class="number">200</span>, <span class="number">100</span>);</span><br><span class="line">  });</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sub</span>(<span class="params">a, b</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> a - b + <span class="built_in">Object</span>(Src_d__WEBPACK_IMPORTED_MODULE_0__[<span class="string">'mul'</span>])(<span class="number">100</span>, <span class="number">50</span>);</span><br><span class="line">}</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'c'</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>模块 <code>c</code> 里引入了模块 <code>d</code>，这里的模块 <code>d</code> 与前文的模块 <code>d</code> 虽然是一样的，但由于用的 <code>loader</code> 不一样，所以会认为是两个不同的模块，故会再次加载，互不影响。这里模块 <code>d</code> 不在累述。</p>
<p>然后执行：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve()</span><br><span class="line">  .then(__webpack_require__.bind(<span class="literal">null</span>, <span class="string">'./src/b.js'</span>))</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">m</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> m.add(<span class="number">200</span>, <span class="number">100</span>);</span><br><span class="line">  });</span><br></pre></td></tr></tbody></table></figure>

<p><code>Promise.resolve</code> 方法允许调用时不带参数，直接返回一个<code>resolved</code> 状态的 <code>Promise</code> 对象。即执行 then 方法，即 <code>__webpack_require__.bind(null, './src/b.js')</code>。然后在 <code>__webpack_require__</code> 方法里判断缓存有模块 <code>b</code>，则直接返回模块 <code>b</code> 对应的 <code>exports</code>。到此异步加载完成。</p>
<p>根据微任务队列的先后顺序，先执行模块 <code>a</code> 的第二个 <code>then</code> 回调，然后执行模块 <code>c</code> 的第二个 <code>then</code> 回调，都执行完成后，执行加载完成回调 <code>onScriptComplete</code>。到此代码运行完成。</p>
<h2 id="异步加载小结"><a href="#异步加载小结" class="headerlink" title="异步加载小结"></a>异步加载小结</h2><p>再次梳理下异步加载的关键思路：</p>
<ol>
<li>通过 <code>__webpack_require__</code> 加载运行入口 <code>module</code></li>
<li>模块代码里遇到 import()即执行 <code>__webpack_require__.e</code> 加载异步 <code>chunk</code></li>
<li><code>__webpack_require__.e</code> 使用模拟 <code>jsonp</code> 的方式及创建 <code>script</code> 标签来加载异步 <code>chunk</code>，并为每个 <code>chunk</code> 创建一个 <code>promise</code></li>
<li>等到异步 <code>chunk</code> 被加载后，会执行 <code>window['webpackJsonp'].push</code>，即 <code>webpackJsonpCallback</code> 方法</li>
<li><code>webpackJsonpCallback</code> 里将异步 <code>chunk</code> 里的 <code>module</code> 加入到 <code>modules</code>， 并触发前面创建 <code>promise</code> 的 <code>resolve</code> 回调，然后执行其 <code>then</code> 方法即 <code>__webpack_require__</code> 去加载新的 <code>module</code>。</li>
</ol>
<h2 id="扩展-使用-splitChunks-切割后的文件解析"><a href="#扩展-使用-splitChunks-切割后的文件解析" class="headerlink" title="扩展 使用 splitChunks 切割后的文件解析"></a>扩展 使用 splitChunks 切割后的文件解析</h2><p>demo</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">import</span> { mul } <span class="keyword">from</span> <span class="string">'./d'</span>;</span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">import</span> { mul } <span class="keyword">from</span> <span class="string">'./d'</span>;</span><br><span class="line"><span class="comment">// d.js为普通同步文件</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">{</span><br><span class="line">  <span class="attr">"entry"</span>: {</span><br><span class="line">    <span class="attr">"bundle1"</span>: <span class="string">"./src/e.js"</span>,</span><br><span class="line">    <span class="attr">"bundle2"</span>: <span class="string">"./src/f.js"</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"plugins"</span>: [new HtmlWebpackPlugin()],</span><br><span class="line">  //...</span><br><span class="line">  "optimization": {</span><br><span class="line">    "splitChunks": {</span><br><span class="line">      "chunks": "all",</span><br><span class="line">      "minSize": 0, //当模块小于这个值时，就不拆</span><br><span class="line">      "maxSize": 0, //当模块大于这个值时，尝试拆分</span><br><span class="line">      "minChunks": 1, //重复一次就打包</span><br><span class="line">      "name": true, //是否以cacheGroups中的filename作为文件名</span><br><span class="line">      "automaticNameDelimiter": "~", //打包的chunk名字连接符</span><br><span class="line">      "cacheGroups": {</span><br><span class="line">        "default": {</span><br><span class="line">          "chunks": "all",</span><br><span class="line">          "minChunks": 2,</span><br><span class="line">          "priority": -10</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>引入插件 <code>HtmlWebpackPlugin</code> 辅助分析。</p>
<p>打包后代码见 <a href="https://github.com/zhaoky/webpack-demo/tree/master/dist" target="_blank" rel="noopener">github</a>，以下只做关键点记录:</p>
<ul>
<li>html 会引入每个入口 <code>bundle</code> 生成的 <code>js</code> 和公共部分的 <code>js</code>：</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"default~bundle1~bundle2.183bf5f4.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"bundle1.10ad.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"bundle2.c333.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>在 <code>jsonp</code> 初始化阶段，执行：</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);</span><br></pre></td></tr></tbody></table></figure>

<p>和在 <code>webpackJsonpCallback</code> 方法里执行：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (parentJsonpFunction) parentJsonpFunction(data);</span><br></pre></td></tr></tbody></table></figure>

<p>可以保证无论页面先加载入口文件还是非入口文件，都可以将依赖 <code>module</code> 同步到各自的 <code>chunk</code> 里。</p>
<ul>
<li>两个入口文件 <code>bundle1.xxxx.js bundle2.xxxx.js</code> 的 <code>runtime</code> 代码里会多出一个新的变量 <code>deferredModules</code>：</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deferredModules = [];</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">deferredModules.push([<span class="string">'./src/e.js'</span>, <span class="string">'default~bundle1~bundle2'</span>]);</span><br><span class="line"><span class="keyword">return</span> checkDeferredModules();</span><br></pre></td></tr></tbody></table></figure>

<p>该变量为一个数组，第一个变量是需要加载的 <code>module</code>，后面的变量就是要加载本 <code>module</code> 所需的其他依赖 <code>module</code>。然后在 <code>runtime</code> 的末尾执行：<code>return checkDeferredModules();</code></p>
<ul>
<li><code>checkDeferredModules</code></li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkDeferredModules</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> result;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; deferredModules.length; i++) {</span><br><span class="line">    <span class="keyword">var</span> deferredModule = deferredModules[i];</span><br><span class="line">    <span class="keyword">var</span> fulfilled = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">1</span>; j &lt; deferredModule.length; j++) {</span><br><span class="line">      <span class="keyword">var</span> depId = deferredModule[j];</span><br><span class="line">      <span class="keyword">if</span> (installedChunks[depId] !== <span class="number">0</span>) fulfilled = <span class="literal">false</span>; <span class="comment">//判断依赖模块有没有加载过</span></span><br><span class="line">    <span class="keyword">if</span> (fulfilled) {</span><br><span class="line">      deferredModules.splice(i--, <span class="number">1</span>);</span><br><span class="line">      result = __webpack_require__((__webpack_require__.s = deferredModule[<span class="number">0</span>])); <span class="comment">//如果所有依赖模块都加载了（即modules里有依赖模块），则就可以读取目标的module了</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>该方法主要检查依赖的 <code>module</code> 是否加载过，若都加载了则加载目标 <code>module</code>。</p>
<ul>
<li><code>webpackJsonpCallback</code> 格外代码</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">deferredModules.push.apply(deferredModules, executeModules || []);</span><br><span class="line"><span class="keyword">return</span> checkDeferredModules();</span><br></pre></td></tr></tbody></table></figure>

<p>该方法增加了这两句代码，用于在调用 <code>webpackJsonpCallback</code> 时（即 <code>window["webpackJsonp"].push</code> 或 <code>webpackJsonpCallback(jsonpArray[i])</code>），有其他依赖的时候可以再去调用 <code>checkDeferredModules</code> 进行依赖检查。</p>
<h2 id="splitChunks-切割后加载小结"><a href="#splitChunks-切割后加载小结" class="headerlink" title="splitChunks 切割后加载小结"></a>splitChunks 切割后加载小结</h2><p>再次梳理下 <code>splitChunks</code> 切割后的关键思路：</p>
<ol>
<li>根据 <code>script</code> 标签先后顺序，<code>html</code> 先加载公共依赖 <code>default~bundle1~bundle2.xx.js</code>，即在 <code>window["webpackJsonp"]</code> 里 <code>push</code> 了该 <code>module</code>。</li>
<li><code>html</code> 加载 <code>bundle1.js</code>，在 <code>jsonp</code> 初始化里调用 <code>webpackJsonpCallback(jsonpArray[i])</code> 将公共依赖模块加到 <code>modules</code> 里并改变其状态为已加载后，调用 <code>checkDeferredModules()</code>，但 <code>deferredModules</code> 为空，所以没有任何操作。</li>
<li>然后回到 <code>runtime</code> 里继续执行，将当前 <code>module</code> 和依赖 <code>module</code> <code>push</code> 到 <code>deferredModules</code> 里，再次调用 <code>checkDeferredModules</code>，此时判断各依赖模块状态均为已加载后，加载当期 <code>module</code>。</li>
<li><code>html</code> 加载 <code>bundle2</code> 文件，此后逻辑跟 <code>bundle1</code> 一致。</li>
</ol>

      
    </div>

    

    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">---- 本文结束，感谢您的阅读 ----</div>
    
</div>

      
    </div>
    

    
      
    
    
      <div>
        <div id="reward-container">
  <div></div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.png" alt="Korey 微信支付">
        <p>微信支付</p>
      </div>
    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/382.html" rel="next" title="webpack 4 源码主流程分析（十一）：文件的生成">
                <i class="fa fa-chevron-left"></i> webpack 4 源码主流程分析（十一）：文件的生成
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/384.html" rel="prev" title="webpack 4 源码主流程分析（十三）：watch">
                webpack 4 源码主流程分析（十三）：watch <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Korey">
            
              <p class="site-author-name" itemprop="name">Korey</p>
              <div class="site-description motion-element" itemprop="description">热衷于记录、分享前端开发技术</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">94</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/zhaoky" title="GitHub → https://github.com/zhaoky" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:keyu.zhao@foxmail.com" title="E-Mail → mailto:keyu.zhao@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://juejin.im/user/57c91b3b165abd0068db89c2" title="掘金 → https://juejin.im/user/57c91b3b165abd0068db89c2" rel="noopener" target="_blank"><i class="fa fa-fw fa-chain-broken"></i>掘金</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://www.zhihu.com/people/fe_korey" title="知乎 → http://www.zhihu.com/people/fe_korey" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>知乎</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#demo"><span class="nav-number">1.</span> <span class="nav-text">demo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打包结果文件"><span class="nav-number">2.</span> <span class="nav-text">打包结果文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码执行流程"><span class="nav-number">3.</span> <span class="nav-text">代码执行流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#bundle-主体结构"><span class="nav-number">3.1.</span> <span class="nav-text">bundle 主体结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#runtime-函数"><span class="nav-number">3.2.</span> <span class="nav-text">runtime 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#runtime-函数主体结构"><span class="nav-number">3.2.1.</span> <span class="nav-text">runtime 函数主体结构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开始执行"><span class="nav-number">3.3.</span> <span class="nav-text">开始执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack-require-属性"><span class="nav-number">3.4.</span> <span class="nav-text">__webpack_require__ 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jsonp-初始化"><span class="nav-number">3.5.</span> <span class="nav-text">jsonp 初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack-require"><span class="nav-number">3.6.</span> <span class="nav-text">__webpack_require__</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行各同步模块代码"><span class="nav-number">3.7.</span> <span class="nav-text">执行各同步模块代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#import-的处理"><span class="nav-number">3.8.</span> <span class="nav-text">import() 的处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#webpack-require-e"><span class="nav-number">3.8.1.</span> <span class="nav-text">__webpack_require__.e</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加载非入口文件0-e3296d88-js"><span class="nav-number">3.9.</span> <span class="nav-text">加载非入口文件0.e3296d88.js</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#非入口文件主体结构"><span class="nav-number">3.9.1.</span> <span class="nav-text">非入口文件主体结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#webpackJsonpCallback"><span class="nav-number">3.9.2.</span> <span class="nav-text">webpackJsonpCallback</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#执行-resolve-的回调-then-方法"><span class="nav-number">3.9.3.</span> <span class="nav-text">执行 resolve 的回调 then 方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异步加载小结"><span class="nav-number">4.</span> <span class="nav-text">异步加载小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#扩展-使用-splitChunks-切割后的文件解析"><span class="nav-number">5.</span> <span class="nav-text">扩展 使用 splitChunks 切割后的文件解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#splitChunks-切割后加载小结"><span class="nav-number">6.</span> <span class="nav-text">splitChunks 切割后加载小结</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">© 2015 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Korey zhao</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">542k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">8:13</span>
  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  














  



  
    
    
  
  











  



  
  

  
  

  
  

  
  

  
  


  


  

  



  
  


  

  



  
  




  


  


  
  
  


  

  

  


  


  
  





  

  

  

  

  

  
  


  

  

  

  

  

  

  

  

<script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script>

<script type="text/javascript" src="/bundle.js"></script><script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
;

    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  ;

    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  ;
L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"superSample":2,"width":125,"height":150,"position":"left","hOffset":30,"vOffset":-5},"mobile":{"show":false,"scale":0.05},"react":{"opacityDefault":1,"opacityOnHover":0.2},"log":false});</script></body></html>